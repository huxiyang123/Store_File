<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0033)http://www.iteye.com/topic/103804 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" dir="ltr"><style type="text/css" id="202350000"></style><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/expansion_embed.js"></script><script async="" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/analytics.js"></script><script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/hm.js"></script>
    
    <title>正确理解ThreadLocal - 设计模式 - Java - ITeye论坛</title>
    <meta name="description" content="首先，ThreadLocal 不是用来解决共享对象的多线程访问问题的，一般情况下，通过ThreadLocal.set() 到线程中的对象是该线程自己使用的对象，其他线程是不需要访问的，也访问不到的。各个线程中访问的是不同的对象。 另外，说ThreadLocal使得各线程能够保持各自独立的一个对象，并不是通过ThreadLocal.set()来实现的，而是通过每个线程中的new 对象 的操作来创建的对 ...">
    <meta name="keywords" content="设计模式 Java">
    <link rel="shortcut icon" href="http://www.iteye.com/images/favicon.ico" type="image/x-icon">
    <link href="http://www.iteye.com/rss/board/Java" rel="alternate" title="ITeye论坛" type="application/rss+xml">
    <link rel="search" type="application/opensearchdescription+xml" href="http://www.iteye.com/open_search.xml" title="ITeye">
    <link href="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/forum.css" media="screen" rel="stylesheet" type="text/css">
    <script async="" type="text/javascript" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/gpt.js"></script><script type="text/javascript" async="" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/ga.js"></script><script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/application.js" type="text/javascript"></script>
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-535605-1']);
  _gaq.push(['_setDomainName', 'iteye.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


      <link href="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/SyntaxHighlighter.css" media="screen" rel="stylesheet" type="text/css">
  <script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/shCoreCommon.js" type="text/javascript"></script>
<script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/hotkey.js" type="text/javascript"></script>
  <script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/code_favorites.js" type="text/javascript"></script>
          <script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/dragdrop.js" type="text/javascript"></script>
          <style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/pubads_impl_78.js" async=""></script><script type="text/javascript" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/osd.js"></script></head>
  <body>
    <div id="page">
      <div id="header">
        <div class="clearfix"><div id="user_nav">
      <a href="http://www.iteye.com/login" class="welcome" title="登录">您还未登录 !</a>
    <a href="http://www.iteye.com/login">登录</a>
    <a href="http://www.iteye.com/signup" class="nobg">注册</a>
  </div>
</div>
        <div class="clearfix">
          <div id="branding">
            <a href="http://www.iteye.com/"><img alt="ITeye-最棒的软件开发交流社区" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/logo.gif" title="ITeye-最棒的软件开发交流社区"></a>
          </div>
          <div id="gg"><script type="text/javascript" ads-src="http://csdnim.qtmojo.com/main/s?user=iteye|forums|banner4&amp;db=csdnim&amp;border=0&amp;local=yes&amp;js=ie" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/AllyesDeliver.min.js" charset="gbk" id="allyes_ins_1d9b4ca1f" ads-outputs="0" ads-tid="17bdfeb4e_0"></script><div id="17bdfeb4e_0" style="padding:0;margin:0;border:0;"><script type="text/javascript" data-belong="allyes" src="http://csdnim.qtmojo.com/main/s?user=iteye|forums|banner4&db=csdnim&border=0&local=yes&js=ie"></script><script type="text/javascript">
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<div id="div-gpt-ad-1432093383823-0">
<script type="text/javascript">
googletag.cmd.push(function() {
googletag.defineSlot('/8456/IDG.CN_B2B_iteye.com', [728, 90], 'div-gpt-ad-1432093383823-0').addService(googletag.pubads()).setTargeting("pos","ATF3");
googletag.pubads().enableSingleRequest();
if (self != top) {
         googletag.pubads().set("page_url", document.referrer);
         }
googletag.enableServices();
googletag.display('div-gpt-ad-1432093383823-0');
});
</script>
<div id="google_ads_iframe_/8456/IDG.CN_B2B_iteye.com_0__container__" style="border: 0pt none; display: inline-block; width: 728px; height: 90px;"><iframe frameborder="0" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/container(1).htm" id="google_ads_iframe_/8456/IDG.CN_B2B_iteye.com_0" name="1-0-2;78925;&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;UTF-8&quot;&gt;&lt;style&gt;a.rh-ms-mute-undo {color:#0000ff;}body,table,div,ul,li{margin:0;padding:0}body{font-family:Arial,arial,sans-serif;}&lt;/style&gt;&lt;script&gt;(function(){var d=this;var f=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},g=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var h;a:{var p=d.navigator;if(p){var q=p.userAgent;if(q){h=q;break a}}h=&quot;&quot;}var r=function(a){return-1!=h.indexOf(a)};var t=r(&quot;Opera&quot;)||r(&quot;OPR&quot;),u=r(&quot;Trident&quot;)||r(&quot;MSIE&quot;),v=r(&quot;Edge&quot;),w=r(&quot;Gecko&quot;)&amp;&amp;!(-1!=h.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!r(&quot;Edge&quot;))&amp;&amp;!(r(&quot;Trident&quot;)||r(&quot;MSIE&quot;))&amp;&amp;!r(&quot;Edge&quot;),x=-1!=h.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!r(&quot;Edge&quot;),y=function(){var a=h;if(w)return/rv\:([^\);]+)(\)|;)/.exec(a);if(v)return/Edge\/([\d\.]+)/.exec(a);if(u)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(x)return/WebKit\/(\S+)/.exec(a)},z=function(){var a=d.document;return a?a.documentMode:void 0},A=function(){if(t&amp;&amp;d.opera){var a;var b=d.opera.version;try{a=b()}catch(c){a=b}return a}a=&quot;&quot;;(b=y())&amp;&amp;(a=b?b[1]:&quot;&quot;);return u&amp;&amp;(b=z(),b&gt;parseFloat(a))?String(b):a}(),B={},C=function(a){if(!B[a]){for(var b=0,c=f(String(A)).split(&quot;.&quot;),e=f(String(a)).split(&quot;.&quot;),m=Math.max(c.length,e.length),n=0;0==b&amp;&amp;n&lt;m;n++){var H=c[n]||&quot;&quot;,I=e[n]||&quot;&quot;,J=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),K=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var k=J.exec(H)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],l=K.exec(I)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==k[0].length&amp;&amp;0==l[0].length)break;b=g(0==k[1].length?0:parseInt(k[1],10),0==l[1].length?0:parseInt(l[1],10))||g(0==k[2].length,0==l[2].length)||g(k[2],l[2])}while(0==b)}B[a]=0&lt;=b}},D=d.document,E=D&amp;&amp;u?z()||(&quot;CSS1Compat&quot;==D.compatMode?parseInt(A,10):5):void 0;var F;if(!(F=!w&amp;&amp;!u)){var G;if(G=u)G=9&lt;=E;F=G}F||w&amp;&amp;C(&quot;1.9.1&quot;);u&amp;&amp;C(&quot;9&quot;);var L={};window.ss=function(a){void 0!==L[a]?L[a]++:L[a]=1;var b=document.getElementById(a),c=L[a];if(window.css)css(a,&quot;nm&quot;,c,void 0,void 0);else if(b){a=b.href;var e=a.indexOf(&quot;&amp;nm=&quot;);if(0&gt;e)c=a+&quot;&amp;nm=&quot;+c;else var e=e+4,m=a.indexOf(&quot;&amp;&quot;,e),c=0&lt;=m?a.substring(0,e)+c+a.substring(m):a.substring(0,e)+c;b.href=2E3&lt;c.length?a:c}};}).call(this);function su(id) {var a = document.getElementById(id);var b = (new Date()).getTime();if (a &amp;&amp; a.myt &amp;&amp; b) {var t = b - a.myt;if (window.css) {css(id,&#39;clkt&#39;,t);return;}var bi = a.href.indexOf(&quot;&amp;clkt=&quot;);if (bi &gt; 0) {var c = a.href.substring(0, bi+6); var d = a.href.substring(bi+6, a.href.length);var ei = d.indexOf(&quot;&amp;&quot;);var r = &#39;&#39;;if (ei &gt;= 0)r = d.substring(ei, d.length);a.href = c + t + r; } else {a.href += &quot;&amp;clkt=&quot; + t;}}}(function(){var c=this;var e=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},f=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var g;a:{var p=c.navigator;if(p){var q=p.userAgent;if(q){g=q;break a}}g=&quot;&quot;}var r=function(a){return-1!=g.indexOf(a)};var t=r(&quot;Opera&quot;)||r(&quot;OPR&quot;),u=r(&quot;Trident&quot;)||r(&quot;MSIE&quot;),v=r(&quot;Edge&quot;),w=r(&quot;Gecko&quot;)&amp;&amp;!(-1!=g.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!r(&quot;Edge&quot;))&amp;&amp;!(r(&quot;Trident&quot;)||r(&quot;MSIE&quot;))&amp;&amp;!r(&quot;Edge&quot;),x=-1!=g.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!r(&quot;Edge&quot;),y=function(){var a=g;if(w)return/rv\:([^\);]+)(\)|;)/.exec(a);if(v)return/Edge\/([\d\.]+)/.exec(a);if(u)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(x)return/WebKit\/(\S+)/.exec(a)},z=function(){var a=c.document;return a?a.documentMode:void 0},A=function(){if(t&amp;&amp;c.opera){var a;var b=c.opera.version;try{a=b()}catch(d){a=b}return a}a=&quot;&quot;;(b=y())&amp;&amp;(a=b?b[1]:&quot;&quot;);return u&amp;&amp;(b=z(),b&gt;parseFloat(a))?String(b):a}(),B={},C=function(a){if(!B[a]){for(var b=0,d=e(String(A)).split(&quot;.&quot;),h=e(String(a)).split(&quot;.&quot;),m=Math.max(d.length,h.length),n=0;0==b&amp;&amp;n&lt;m;n++){var I=d[n]||&quot;&quot;,J=h[n]||&quot;&quot;,K=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),L=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var k=K.exec(I)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],l=L.exec(J)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==k[0].length&amp;&amp;0==l[0].length)break;b=f(0==k[1].length?0:parseInt(k[1],10),0==l[1].length?0:parseInt(l[1],10))||f(0==k[2].length,0==l[2].length)||f(k[2],l[2])}while(0==b)}B[a]=0&lt;=b}},D=c.document,E=D&amp;&amp;u?z()||(&quot;CSS1Compat&quot;==D.compatMode?parseInt(A,10):5):void 0;var F;if(!(F=!w&amp;&amp;!u)){var G;if(G=u)G=9&lt;=E;F=G}F||w&amp;&amp;C(&quot;1.9.1&quot;);u&amp;&amp;C(&quot;9&quot;);var H={},M=function(a,b){void 0!==H[a]||(H[a]=[]);var d=H[a][b];d||(H[a][b]=!0);if(!d)if(d=document.getElementById(a),window.css)css(a,&quot;nb&quot;,b,!0,void 0);else if(d){var h=d.href,m=h+(&quot;&amp;nb=&quot;+b);d.href=2E3&lt;m.length?h:m}};window.cla=function(a,b){if(0&gt;b||parseInt(b,10)!==b)b=17;M(a,b)};window.cll=function(a,b){M(a,b||1)};window.clb=function(a){M(a,2)};window.clh=function(a,b){M(a,b||0)};}).call(this);(function(){var e=this;var g=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},h=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var k;a:{var p=e.navigator;if(p){var q=p.userAgent;if(q){k=q;break a}}k=&quot;&quot;}var r=function(a){return-1!=k.indexOf(a)};var t=r(&quot;Opera&quot;)||r(&quot;OPR&quot;),u=r(&quot;Trident&quot;)||r(&quot;MSIE&quot;),v=r(&quot;Edge&quot;),w=r(&quot;Gecko&quot;)&amp;&amp;!(-1!=k.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!r(&quot;Edge&quot;))&amp;&amp;!(r(&quot;Trident&quot;)||r(&quot;MSIE&quot;))&amp;&amp;!r(&quot;Edge&quot;),x=-1!=k.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!r(&quot;Edge&quot;),y=function(){var a=k;if(w)return/rv\:([^\);]+)(\)|;)/.exec(a);if(v)return/Edge\/([\d\.]+)/.exec(a);if(u)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(x)return/WebKit\/(\S+)/.exec(a)},z=function(){var a=e.document;return a?a.documentMode:void 0},A=function(){if(t&amp;&amp;e.opera){var a;var b=e.opera.version;try{a=b()}catch(c){a=b}return a}a=&quot;&quot;;(b=y())&amp;&amp;(a=b?b[1]:&quot;&quot;);return u&amp;&amp;(b=z(),b&gt;parseFloat(a))?String(b):a}(),B={},C=function(a){if(!B[a]){for(var b=0,c=g(String(A)).split(&quot;.&quot;),d=g(String(a)).split(&quot;.&quot;),f=Math.max(c.length,d.length),n=0;0==b&amp;&amp;n&lt;f;n++){var I=c[n]||&quot;&quot;,J=d[n]||&quot;&quot;,K=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),L=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var l=K.exec(I)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],m=L.exec(J)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==l[0].length&amp;&amp;0==m[0].length)break;b=h(0==l[1].length?0:parseInt(l[1],10),0==m[1].length?0:parseInt(m[1],10))||h(0==l[2].length,0==m[2].length)||h(l[2],m[2])}while(0==b)}B[a]=0&lt;=b}},D=e.document,E=D&amp;&amp;u?z()||(&quot;CSS1Compat&quot;==D.compatMode?parseInt(A,10):5):void 0;var F;if(!(F=!w&amp;&amp;!u)){var G;if(G=u)G=9&lt;=E;F=G}F||w&amp;&amp;C(&quot;1.9.1&quot;);u&amp;&amp;C(&quot;9&quot;);var H=function(a,b,c,d){if(window.css)css(b,c,d,void 0,void 0);else if(a){b=a.href;var f=&quot;&amp;&quot;+c+&quot;=&quot;;c=b.indexOf(f);0&gt;c?d=b+f+d:(c+=f.length,f=b.indexOf(&quot;&amp;&quot;,c),d=0&lt;=f?b.substring(0,c)+d+b.substring(f):b.substring(0,c)+d);a.href=2E3&lt;d.length?b:d}};var M=null,N=function(a){M=a};document.addEventListener&amp;&amp;document.addEventListener(&quot;mousedown&quot;,N,!0);window.xy=function(a,b,c){c=c||b;if((a=a||M)&amp;&amp;b&amp;&amp;c){var d=Math.round(a.clientY-c.offsetTop),f=b.id;H(b,f,&quot;nx&quot;,Math.round(a.clientX-c.offsetLeft));H(b,f,&quot;ny&quot;,d)}};}).call(this);(function(){var d=this;var f=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},g=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var h;a:{var p=d.navigator;if(p){var q=p.userAgent;if(q){h=q;break a}}h=&quot;&quot;}var r=function(a){return-1!=h.indexOf(a)};var t=r(&quot;Opera&quot;)||r(&quot;OPR&quot;),u=r(&quot;Trident&quot;)||r(&quot;MSIE&quot;),v=r(&quot;Edge&quot;),w=r(&quot;Gecko&quot;)&amp;&amp;!(-1!=h.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!r(&quot;Edge&quot;))&amp;&amp;!(r(&quot;Trident&quot;)||r(&quot;MSIE&quot;))&amp;&amp;!r(&quot;Edge&quot;),x=-1!=h.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!r(&quot;Edge&quot;),y=function(){var a=h;if(w)return/rv\:([^\);]+)(\)|;)/.exec(a);if(v)return/Edge\/([\d\.]+)/.exec(a);if(u)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(x)return/WebKit\/(\S+)/.exec(a)},z=function(){var a=d.document;return a?a.documentMode:void 0},A=function(){if(t&amp;&amp;d.opera){var a;var b=d.opera.version;try{a=b()}catch(c){a=b}return a}a=&quot;&quot;;(b=y())&amp;&amp;(a=b?b[1]:&quot;&quot;);return u&amp;&amp;(b=z(),b&gt;parseFloat(a))?String(b):a}(),B={},C=function(a){if(!B[a]){for(var b=0,c=f(String(A)).split(&quot;.&quot;),e=f(String(a)).split(&quot;.&quot;),m=Math.max(c.length,e.length),n=0;0==b&amp;&amp;n&lt;m;n++){var H=c[n]||&quot;&quot;,I=e[n]||&quot;&quot;,J=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),K=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var k=J.exec(H)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],l=K.exec(I)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==k[0].length&amp;&amp;0==l[0].length)break;b=g(0==k[1].length?0:parseInt(k[1],10),0==l[1].length?0:parseInt(l[1],10))||g(0==k[2].length,0==l[2].length)||g(k[2],l[2])}while(0==b)}B[a]=0&lt;=b}},D=d.document,E=D&amp;&amp;u?z()||(&quot;CSS1Compat&quot;==D.compatMode?parseInt(A,10):5):void 0;var F;if(!(F=!w&amp;&amp;!u)){var G;if(G=u)G=9&lt;=E;F=G}F||w&amp;&amp;C(&quot;1.9.1&quot;);u&amp;&amp;C(&quot;9&quot;);var L=[0,2,1],M=null;document.addEventListener&amp;&amp;document.addEventListener(&quot;mousedown&quot;,function(a){M=a},!0);window.mb=function(a){if(a){var b;if(b=window.event||M){var c;(c=b.which?1&lt;&lt;L[b.which-1]:b.button)&amp;&amp;b.shiftKey&amp;&amp;(c|=8);c&amp;&amp;b.altKey&amp;&amp;(c|=16);c&amp;&amp;b.ctrlKey&amp;&amp;(c|=32);b=c}else b=null;if(b)if(c=b,window.css)css(a.id,&quot;mb&quot;,c,void 0,void 0);else if(a){b=a.href;var e=b.indexOf(&quot;&amp;mb=&quot;);if(0&gt;e)c=b+&quot;&amp;mb=&quot;+c;else{var e=e+4,m=b.indexOf(&quot;&amp;&quot;,e);c=0&lt;=m?b.substring(0,e)+c+b.substring(m):b.substring(0,e)+c}a.href=2E3&lt;c.length?b:c}}};}).call(this);(function(){var c=this;var e=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},f=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var m;a:{var n=c.navigator;if(n){var p=n.userAgent;if(p){m=p;break a}}m=&quot;&quot;};var q=-1!=m.indexOf(&quot;Opera&quot;)||-1!=m.indexOf(&quot;OPR&quot;),r=-1!=m.indexOf(&quot;Trident&quot;)||-1!=m.indexOf(&quot;MSIE&quot;),t=-1!=m.indexOf(&quot;Edge&quot;),u=-1!=m.indexOf(&quot;Gecko&quot;)&amp;&amp;!(-1!=m.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;-1==m.indexOf(&quot;Edge&quot;))&amp;&amp;!(-1!=m.indexOf(&quot;Trident&quot;)||-1!=m.indexOf(&quot;MSIE&quot;))&amp;&amp;-1==m.indexOf(&quot;Edge&quot;),v=-1!=m.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;-1==m.indexOf(&quot;Edge&quot;),w=function(){var a=m;if(u)return/rv\:([^\);]+)(\)|;)/.exec(a);if(t)return/Edge\/([\d\.]+)/.exec(a);if(r)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(v)return/WebKit\/(\S+)/.exec(a)},x=function(){var a=c.document;return a?a.documentMode:void 0},y=function(){if(q&amp;&amp;c.opera){var a;var b=c.opera.version;try{a=b()}catch(g){a=b}return a}a=&quot;&quot;;(b=w())&amp;&amp;(a=b?b[1]:&quot;&quot;);return r&amp;&amp;(b=x(),b&gt;parseFloat(a))?String(b):a}(),z={},A=function(a){if(!z[a]){for(var b=0,g=e(String(y)).split(&quot;.&quot;),d=e(String(a)).split(&quot;.&quot;),I=Math.max(g.length,d.length),l=0;0==b&amp;&amp;l&lt;I;l++){var J=g[l]||&quot;&quot;,K=d[l]||&quot;&quot;,L=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),M=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var h=L.exec(J)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],k=M.exec(K)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==h[0].length&amp;&amp;0==k[0].length)break;b=f(0==h[1].length?0:parseInt(h[1],10),0==k[1].length?0:parseInt(k[1],10))||f(0==h[2].length,0==k[2].length)||f(h[2],k[2])}while(0==b)}z[a]=0&lt;=b}},B=c.document,C=B&amp;&amp;r?x()||(&quot;CSS1Compat&quot;==B.compatMode?parseInt(y,10):5):void 0;var D;if(!(D=!u&amp;&amp;!r)){var E;if(E=r)E=9&lt;=C;D=E}D||u&amp;&amp;A(&quot;1.9.1&quot;);r&amp;&amp;A(&quot;9&quot;);var F=function(a,b,g){var d=document;d.addEventListener?d.addEventListener(a,b,g||!1):d.attachEvent&amp;&amp;d.attachEvent(&quot;on&quot;+a,b)};var G,H=!1,N=!1;F(&quot;mousedown&quot;,function(){H=!0});F(&quot;keydown&quot;,function(){N=!0});document.addEventListener&amp;&amp;F(&quot;click&quot;,function(a){G=a},!0);window.accbk=function(){var a=G?G:window.event;return a?H||N?!1:(a.preventDefault?a.preventDefault():a.returnValue=!1,!0):!1};}).call(this);function st(id) {var a = document.getElementById(id);if (a) {a.myt = (new Date()).getTime();xy(window.event, a);mb(a);}}function ha(a,x){  clh(a,x);if (accbk()) return;su(a);}function ia(a,e,x) {if (accbk()) return;cll(a,x);su(a);}function ja(a,x) {if (accbk()) return;cla(a,x);su(a);}function ga(o,e,x) {if (document.getElementById) {var a=o.id.substring(1),p=&quot;&quot;,r=&quot;&quot;,g=e.target,t,f,h;if (g) {t=g.id;f=g.parentNode;if (f) {p=f.id;h=f.parentNode;if (h)r=h.id;}} else {h=e.srcElement;f=h.parentNode;if (f)p=f.id;t=h.id;}if (t==a||p==a||r==a)return true;ia(a,e,x);window.open(document.getElementById(a).href);}}&lt;/script&gt;&lt;script src=&quot;http://static.googleadsserving.cn/pagead/js/r20151208/r20110914/client/ext/m_js_controller.js&quot;&gt;&lt;/script&gt;&lt;script&gt;buildAdSlot([[[0,0,728,89,&quot;http://www.miniui.com/demo/#src=datagrid/celledit.html&quot;,&quot;http://googleads.g.doubleclick.net/pagead/conversion/?ai=C7mka_QiJVuz1ONSF9gWm05fwC7mLrqgKsfWu66EBwZXo2YQBEAEg28-9F2CdgYCAmAXIAQGpAkXPydFSq4Q-4AIAqAMByAObBKoEjQFP0JdAu8RU7bvoyXfmleZS4GoYgDMJV74Rg1q1L5jsToN0QASL86UUgOpVrMLaECDFXn_HBCnTfg73NXzXa51-i9GPk7XqvOwxO2ZGsKdtJrnEIRLfE5pr3uGO9qhJ94GWoePfjO3vOLAqVZYr42BBBD_obuQyEh1hveP7CVY-Kk3eeg8KLPaAyRgzvWbgBAGAB9GIrh6oB6a-G9gHAQ\u0026sigh=WelgcYF_dtw&quot;,&quot;43443272369&quot;,&quot;http://googleads.g.doubleclick.net/aclk?sa=L\u0026ai=C7mka_QiJVuz1ONSF9gWm05fwC7mLrqgKsfWu66EBwZXo2YQBEAEg28-9F2CdgYCAmAXIAQGpAkXPydFSq4Q-4AIAqAMByAObBKoEjQFP0JdAu8RU7bvoyXfmleZS4GoYgDMJV74Rg1q1L5jsToN0QASL86UUgOpVrMLaECDFXn_HBCnTfg73NXzXa51-i9GPk7XqvOwxO2ZGsKdtJrnEIRLfE5pr3uGO9qhJ94GWoePfjO3vOLAqVZYr42BBBD_obuQyEh1hveP7CVY-Kk3eeg8KLPaAyRgzvWbgBAGAB9GIrh6oB6a-G9gHAQ\u0026num=1\u0026sig=AOD64_3JvNlpXyyX-h-jdG5u3aVlJzBw6Q\u0026client=ca-pub-7443704194229694\u0026adurl=http://www.miniui.com/demo/%23src%3Ddatagrid/celledit.html&quot;,null,null,null,null,null,null,&quot;&quot;,&quot;&quot;,null,&quot;zh-cn&quot;]],728,90,0,0,null,&quot;CKzo0uvHjcoCFdSCvQodpukFvg&quot;,&quot;_QiJVsmENsH59QWg6YnIDA&quot;,null,&quot;ca-pub-7443704194229694&quot;,0,0,0,&quot;_blank&quot;,0,null,0,&quot;http://static.googleadsserving.cn&quot;,[&quot;#000000&quot;,&quot;#0000ff&quot;,&quot;#008000&quot;,&quot;#ffffff&quot;,&quot;#f8f8f8&quot;],0,0,-1235584470,[[&quot;enable_preloading_in_ima&quot;,&quot;False&quot;],[&quot;use_afma_video_player&quot;,&quot;False&quot;],[&quot;afma_precache_min_buffer&quot;,&quot;5000&quot;],[&quot;afma_video_player_type&quot;,&quot;2&quot;],[&quot;delay_page_loaded_timeout&quot;,&quot;0&quot;],[&quot;delay_page_loaded_timeout_action&quot;,&quot;&quot;]],null,null,[0.9,0,10,0,[0,0,0],1000,0],null,[0,0,0,1,0],null,null,null,0]);&lt;/script&gt;&lt;script&gt;&lt;/script&gt;&lt;script&gt;(function(_){var kk=function(){this.nd=[];this.Yf={}};kk.prototype.report=function(){for(var a=[],b=0;b&lt;this.nd.length;++b)a.push(lk(this.nd[b]));return a};var lk=function(a){var b=[a.key,a.value];_.q(a.hf)&amp;&amp;b.push(a.hf);return b},mk={};var nk={1:0,2:1,4:8,5:6,8:11,9:2,6:9,34:25,26:15,3:7,20:12,24:26},ok=function(a,b,c){var d=nk[b];&quot;true&quot;===c.getAttribute(b,&quot;data-is-action-button-expanded&quot;)&amp;&amp;(d=12);(0,window.ja)(a,d)},pk=function(a){return function(){a()}},qk=function(a){return a.report()};_.r(&quot;registerAd&quot;,function(a,b){_.q(mk[b])||(mk[b]=new kk);a.registerClickUrlModifier(_.w(qk,mk[b]));for(var c=[1,2,4,8,6,9,5,3,20,34,26,24],d=0;d&lt;c.length;d++)a.listen(c[d],&quot;mousedown&quot;,pk(_.w(window.st,b))),a.listen(c[d],&quot;click&quot;,_.w(ok,b));a.has(9)||(a.listen(15,&quot;click&quot;,_.w(ok,b)),a.listen(15,&quot;mousedown&quot;,pk(_.w(window.st,b))));a.listen(0,&quot;mouseover&quot;,pk(_.w(window.ss,b)));a.listen(0,&quot;focus&quot;,pk(_.w(window.ss,b)));a.listen(1,&quot;focus&quot;,pk(_.w(window.ss,b)));a.listen(1,&quot;mouseover&quot;,pk(_.w(window.ss,b)));return a},void 0);_.r(&quot;css&quot;,function(a,b,c,d,e){a=mk[a];_.q(a)&amp;&amp;(!_.q(a.Yf[b])||d?(d=a.nd.length,a.Yf[b]=d,a.nd[d]={key:b,value:c,hf:e}):(b=a.nd[a.Yf[b]],b.value=c,b.hf=e))},void 0);})(window.hydra=window.hydra||{});(function(_){var Ai=function(a){this.j=a;this.Di=[6,14];this.ue=[];this.re=[];this.Ek=&quot;data-redirect-ping&quot;;zi(this)},zi=function(a){a.j.forEachAd(function(b,c){a.ue[c]=!1;a.re[c]=!1;(0,_.Bb)(a.Di,function(d){b.listen(d,&quot;click&quot;,Bi(a,c))})})},Ci=function(a,b,c,d,e){return function(){a.re[d]||(a.re[d]=!0,_.Wd(c,b,e.button,e.ctrlKey,e.shiftKey,e.metaKey))}},Bi=function(a,b){return function(c,d,e){if(_.Dc(e))return!1;if(a.ue[b]&amp;&amp;a.re[b])return!0;if(!a.ue[b]){var f=d.getAttribute(c,a.Ek);if(f)c=Ci(a,c,d,b,e),a.ue[b]=!0,_.K(_.M,f,c),_.M.setTimeout(c,5E3);else return!0}_.N(e);return!1}};_.r(&quot;registerAdLocationExtensionRedirectPing&quot;,function(a){return a?new Ai(a):null},void 0);})(window.hydra=window.hydra||{});&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;style&gt;#adunit {background-color: #ffffff;height: 90px;width: 728px;}#ads {height: 90px;left: 0px;position: absolute;top: 0px;width: 728px;}#ads ul{list-style: none;}#ads ul li {clear: both;float: left;line-height: 0;overflow: hidden;position: relative;  }#ads table {border-collapse: collapse;border-spacing: 0;}.separator {border-bottom: 1px solid #d1d1d1;}.rh-img-rtl {-moz-transform: scaleX(-1);-o-transform: scaleX(-1);-webkit-transform: scaleX(-1);transform: scaleX(-1);}.rhsvgpngicon {vertical-align:middle;}.rh-ms-mute-overlay {background-color: #fbfbfb;display: table;height: 100%;opacity: 0.95;position: absolute;top: 0;visibility: hidden;width: 100%;z-index: 9020;}.rh-ms-mute-overlay.visible {visibility: visible;}.rh-ms-mute-overlay &gt; span {color: #333;display: table-cell;font: 20px Arial,arial,sans-serif;text-align: center;vertical-align: middle;}.rh-ms-mute-overlay a {text-decoration: none;}.ads_chrome_top {position: absolute;overflow: hidden;top: 0px;width: 728px;height:0px;}.ads_chrome_bottom {position: absolute;overflow: hidden;bottom: 0px;width: 728px;height:0px;}.ads_chrome_left {position: absolute;overflow: hidden;left: 0px;width:0px;height: 90px;}.ads_chrome_right {position: absolute;overflow: hidden;right: 0px;width:0px;height: 90px;}.rh_custom_close_button .rhsvgpngicon {display: block;cursor: pointer;}.rh_custom_close_button.hidden {display: none;}.rhtitle.rhdefaultcolored {color: #0000ff;}.rhtitle {text-decoration: none;word-wrap: break-word;}.rhtitle-adbadge {background-color: #EDB802;border-radius: 2px;color: #FFFFFF;font-family: &quot;Arial Regular&quot;, &quot;Arial&quot;, sans;font-size: 13px;font-weight: normal;height: 15px;margin: 0 3px;padding: 0 3px;}a.rhtitle:hover {text-decoration: underline;}.icoret-bullet {vertical-align: top;color: #666;}.icoret-title {border-spacing: 2px;margin-left: -8px;table-layout: fixed;word-break: break-word;}.rh-title-overlay {margin: -100%;padding: 100%;}.rhtitle-fade {background: -moz-linear-gradient(left, rgba(255,255,255,0) 75%, #ffffff 95%);background: -webkit-gradient(linear, left top, right top, color-stop(75%,rgba(255,255,255,0)), color-stop(95%, #ffffff));background: -webkit-linear-gradient(left, rgba(255,255,255,0) 75%, #ffffff 95%);background: -o-linear-gradient(left, rgba(255,255,255,0) 75%, #ffffff 95%);background: -ms-linear-gradient(left, rgba(255,255,255,0) 75%, #ffffff 95%);background: linear-gradient(to right, rgba(255,255,255,0) 75%, #ffffff 95%);display: inline;pointer-events: none;}.rhbody.rhdefaultcolored {color: #000000;}.rhbody {text-decoration: none;word-wrap: break-word;}a.rhbody:hover {text-decoration: underline;}.rhurlctr {overflow: hidden;}.rhurlctr_nowrap {text-overflow: ellipsis;white-space: nowrap;}.rhurlctr_clickable {cursor: pointer;}.rhurl {text-decoration: none;}.rhurl:hover {text-decoration: underline;}.rhurl:hover.rhdefaultcolored,.rhurlctr.rhdefaultcolored,.rhurl.rhdefaultcolored span,.rhurl.rhdefaultcolored span:hover {color: #008000;}.rh{display:inline-block;font-size:0;line-height:0;overflow:hidden;padding:0;width:728px} .rh &gt; table{height:100%} .rh1{display:inline-block;font-size:0;line-height:0;overflow:hidden;padding:0 0 0 4px} .rh1 &gt; table{width:100%} .rh10{display:inline-block;font-size:33px;line-height:37px;overflow:hidden;padding:0 7px 0 7px;white-space:nowrap} .rh10c{height:0;padding:0} .rh11{display:inline-block;font-size:18px;line-height:23px;overflow:hidden;padding:3px 7px 3px 7px;white-space:nowrap} .rh11c{padding:0} .rh13{display:inline-block;font-size:20px;line-height:23px;overflow:hidden;padding:0 7px 0 7px} .rh13c{padding:0} .rh1c{padding:0;vertical-align:top} .taw{height:90px;width:728px}&lt;/style&gt;&lt;div id=adunit&gt;&lt;div id=ads &gt;&lt;ul&gt;&lt;li id=taw0 class=&quot;taw taw0&quot;   lang=&quot;zh-cn&quot;&gt;&lt;div class=&quot;rh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;rh1c&quot;&gt;&lt;div class=&quot;rh1&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;rh10c&quot;&gt;&lt;div class=&quot;rh-box-title rh-title rh10 collapsed-box&quot;&gt;&lt;a class=&quot;rhtitle rhdefaultcolored&quot; href=&quot;http://googleads.g.doubleclick.net/aclk?sa=L&amp;ai=C7mka_QiJVuz1ONSF9gWm05fwC7mLrqgKsfWu66EBwZXo2YQBEAEg28-9F2CdgYCAmAXIAQGpAkXPydFSq4Q-4AIAqAMByAObBKoEjQFP0JdAu8RU7bvoyXfmleZS4GoYgDMJV74Rg1q1L5jsToN0QASL86UUgOpVrMLaECDFXn_HBCnTfg73NXzXa51-i9GPk7XqvOwxO2ZGsKdtJrnEIRLfE5pr3uGO9qhJ94GWoePfjO3vOLAqVZYr42BBBD_obuQyEh1hveP7CVY-Kk3eeg8KLPaAyRgzvWbgBAGAB9GIrh6oB6a-G9gHAQ&amp;num=1&amp;sig=AOD64_3JvNlpXyyX-h-jdG5u3aVlJzBw6Q&amp;client=ca-pub-7443704194229694&amp;adurl=http://www.miniui.com/demo/%23src%3Ddatagrid/celledit.html&quot; target=_blank title=&quot;www.miniui.com&quot;&gt;&lt;span&gt;jQuery MiniUI, 企业级Web开发&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&quot;rh11c&quot;&gt;&lt;div class=&quot;rh-box-url rh-url rh11&quot;&gt;&lt;div class=&quot;rhurlctr rhdefaultcolored rhurlctr_nowrap rhurlctr_clickable&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;rhurl rhdefaultcolored&quot; title=&quot;miniui.com&quot; href=&quot;http://googleads.g.doubleclick.net/aclk?sa=L&amp;ai=C7mka_QiJVuz1ONSF9gWm05fwC7mLrqgKsfWu66EBwZXo2YQBEAEg28-9F2CdgYCAmAXIAQGpAkXPydFSq4Q-4AIAqAMByAObBKoEjQFP0JdAu8RU7bvoyXfmleZS4GoYgDMJV74Rg1q1L5jsToN0QASL86UUgOpVrMLaECDFXn_HBCnTfg73NXzXa51-i9GPk7XqvOwxO2ZGsKdtJrnEIRLfE5pr3uGO9qhJ94GWoePfjO3vOLAqVZYr42BBBD_obuQyEh1hveP7CVY-Kk3eeg8KLPaAyRgzvWbgBAGAB9GIrh6oB6a-G9gHAQ&amp;num=1&amp;sig=AOD64_3JvNlpXyyX-h-jdG5u3aVlJzBw6Q&amp;client=ca-pub-7443704194229694&amp;adurl=http://www.miniui.com/demo/%23src%3Ddatagrid/celledit.html&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;miniui.com&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&quot;rh13c&quot;&gt;&lt;div class=&quot;rh-body rh-box-body rh13&quot;&gt;&lt;span class=&quot;rhbody rhdefaultcolored&quot;&gt;500%效率提升，强大UI组件库！ 支持java,.net,php,兼容ie6+&lt;/span&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;style&gt;div,ul,li{margin:0;padding:0;}.abgc{height:15px;position:absolute;right:16px;text-rendering:geometricPrecision;top:0;width:15px;z-index:9020;}.abgb{height:15px;width:15px;}.abgc img{display:block;}.abgc svg{display:block;}.abgs{display:none;height:100%;}.abgl{text-decoration:none;}&lt;/style&gt;&lt;div id=abgc class=abgc dir=&#39;ltr&#39;&gt;&lt;div id=abgb class=&quot;abgb&quot;&gt;&lt;/div&gt;&lt;div id=abgs class=abgs&gt;&lt;a id=abgl class=abgl href=&quot;https://www.google.com/url?ct=abg&amp;amp;q=https://www.google.com/adsense/support/bin/request.py%3Fcontact%3Dabg_afc%26url%3Dhttp://www.iteye.com/topic/103804%26gl%3DCN%26hl%3Dzh%26client%3Dca-pub-7443704194229694%26ai0%3DC7mka_QiJVuz1ONSF9gWm05fwC7mLrqgKsfWu66EBwZXo2YQBEAEg28-9F2CdgYCAmAXIAQGpAkXPydFSq4Q-4AIAqAMByAObBKoEjQFP0JdAu8RU7bvoyXfmleZS4GoYgDMJV74Rg1q1L5jsToN0QASL86UUgOpVrMLaECDFXn_HBCnTfg73NXzXa51-i9GPk7XqvOwxO2ZGsKdtJrnEIRLfE5pr3uGO9qhJ94GWoePfjO3vOLAqVZYr42BBBD_obuQyEh1hveP7CVY-Kk3eeg8KLPaAyRgzvWbgBAGAB9GIrh6oB6a-G9gHAQ&amp;amp;usg=AFQjCNHAAz68v0tKjDlOzdij6a57wtAJAA&quot; target=_blank&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;script src=&quot;http://static.googleadsserving.cn/pagead/js/r20151208/r20110914/abg.js&quot;&gt;&lt;/script&gt;&lt;script&gt;var abgp={elp:document.getElementById(&#39;abgcp&#39;),el:document.getElementById(&#39;abgc&#39;),ael:document.getElementById(&#39;abgs&#39;),iel:document.getElementById(&#39;abgb&#39;),hw:15,sw:111,hh:15,sh:15,himg:&#39;http://static.googleadsserving.cn&#39;+&#39;/pagead/images/abg/icon.png&#39;,simg:&#39;http://static.googleadsserving.cn/pagead/images/abg/zh_cn.png&#39;,alt:&#39;Google 提供的广告&#39;,t:&#39;Google&#39;,tw:38,t2:&#39;提供的广告&#39;,t2w:49,tbo:0,popuptext:&#39;&#39;,att:&#39;adsbygoogle&#39;,ff:&#39;&#39;,halign:&#39;right&#39;,fe:false,fnb:false,iba:false,lttp:false,umd:false,uic:false,uit:false,ict:document.getElementById(&#39;cbb&#39;),icd:undefined};window.abg &amp;&amp; new window.abg(abgp[&#39;elp&#39;],abgp[&#39;el&#39;],abgp[&#39;ael&#39;],abgp[&#39;iel&#39;],abgp[&#39;hw&#39;],abgp[&#39;sw&#39;],abgp[&#39;hh&#39;],abgp[&#39;sh&#39;],abgp[&#39;himg&#39;],abgp[&#39;simg&#39;],abgp[&#39;alt&#39;],abgp[&#39;t&#39;],abgp[&#39;tw&#39;],abgp[&#39;t2&#39;],abgp[&#39;t2w&#39;],abgp[&#39;tbo&#39;],abgp[&#39;popuptext&#39;],abgp[&#39;att&#39;],abgp[&#39;halign&#39;],abgp[&#39;ff&#39;],abgp[&#39;fe&#39;],abgp[&#39;fnb&#39;],abgp[&#39;iba&#39;],abgp[&#39;lttp&#39;],abgp[&#39;umd&#39;],abgp[&#39;uic&#39;],abgp[&#39;uit&#39;],abgp[&#39;ict&#39;],abgp[&#39;icd&#39;]);&lt;/script&gt;&lt;style&gt;.cbc{background-image: url(&#39;http://static.googleadsserving.cn/pagead/images/x_button_blue2.png&#39;);background-position: right top;background-repeat: no-repeat;cursor:pointer;height:15px;right:0;top:0;margin:0;overflow:hidden;padding:0;position:absolute;width:16px;z-index:9010;}.cbc.cbc-hover {background-image: url(&#39;http://static.googleadsserving.cn/pagead/images/x_button_dark.png&#39;);}.cbc &gt; .cb-x{height: 15px;position:absolute;width: 16px;right:0;top:0;}.cb-x &gt; .cb-x-svg{background-color: lightgray;position:absolute;}.cbc.cbc-hover &gt; .cb-x &gt; .cb-x-svg{background-color: #58585a;}.cb-x &gt; .cb-x-svg &gt; .cb-x-svg-path{fill : #00aecd;}.cbc.cbc-hover &gt; .cb-x &gt; .cb-x-svg &gt; .cb-x-svg-path{fill : white;}.cb-x &gt; .cb-x-svg &gt; .cb-x-svg-s-path{fill : white;}&lt;/style&gt;&lt;div id=&quot;cbc&quot; class=cbc &gt;&lt;div id=&quot;cb-x&quot; class=cb-x&gt;&lt;/div&gt; &lt;/div&gt; &lt;style&gt;.ddmc{background:#ccc;color:#000;padding:0;position:absolute;z-index:9020;max-width:100%;box-shadow:2px 2px 3px #aaaaaa;}.ddmc.left{margin-right:0;left:0px;}.ddmc.right{margin-left:0;right:0px;}.ddmc.top{bottom:20px;}.ddmc.bottom{top:20px;}.ddmc .tip{border-left:4px solid transparent;border-right:4px solid transparent;height:0;position:absolute;width:0;font-size:0;line-height:0;}.ddmc.bottom .tip{border-bottom:4px solid #ccc;top:-4px;}.ddmc.top .tip{border-top:4px solid #ccc;bottom:-4px;}.ddmc.right .tip{right:3px;}.ddmc.left .tip{left:3px;}.ddmc .dropdown-content{display:block;}.dropdown-content{display:none;border-collapse:collapse;}.dropdown-item{font:12px Arial,sans-serif;cursor:pointer;padding:3px 7px;vertical-align:middle;}.dropdown-item-hover{background:#58585a;color:#fff;}.dropdown-content &gt; table{border-collapse:collapse;border-spacing:0;}.dropdown-content &gt; table &gt; tbody &gt; tr &gt; td{padding:0;}&lt;/style&gt;&lt;div id=&quot;ddmc&quot; style=&quot;display:none&quot;&gt;&lt;div class=&quot;tip&quot;&gt;&lt;/div&gt;&lt;div class=&quot;dropdown-content&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;div id=&quot;pubmute&quot; style=&quot;border-bottom:1px solid #999;&quot; class=&quot;dropdown-item&quot;&gt;&lt;span&gt;广告覆盖了页面&lt;/span&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div id=&quot;admute&quot; class=&quot;dropdown-item&quot;&gt;&lt;span&gt;停止显示此广告&lt;/span&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/div&gt;&lt;script&gt;(function(){var g=this,h=function(a,b){var c=a.split(&quot;.&quot;),d=g;c[0]in d||!d.execScript||d.execScript(&quot;var &quot;+c[0]);for(var f;c.length&amp;&amp;(f=c.shift());)c.length||void 0===b?d=d[f]?d[f]:d[f]={}:d[f]=b},ca=function(a){var b=typeof a;if(&quot;object&quot;==b)if(a){if(a instanceof Array)return&quot;array&quot;;if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if(&quot;[object Window]&quot;==c)return&quot;object&quot;;if(&quot;[object Array]&quot;==c||&quot;number&quot;==typeof a.length&amp;&amp;&quot;undefined&quot;!=typeof a.splice&amp;&amp;&quot;undefined&quot;!=typeof a.propertyIsEnumerable&amp;&amp;!a.propertyIsEnumerable(&quot;splice&quot;))return&quot;array&quot;;if(&quot;[object Function]&quot;==c||&quot;undefined&quot;!=typeof a.call&amp;&amp;&quot;undefined&quot;!=typeof a.propertyIsEnumerable&amp;&amp;!a.propertyIsEnumerable(&quot;call&quot;))return&quot;function&quot;}else return&quot;null&quot;;else if(&quot;function&quot;==b&amp;&amp;&quot;undefined&quot;==typeof a.call)return&quot;object&quot;;return b},da=function(a,b,c){return a.call.apply(a.bind,arguments)},ea=function(a,b,c){if(!a)throw Error();if(2&lt;arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}},l=function(a,b,c){l=Function.prototype.bind&amp;&amp;-1!=Function.prototype.bind.toString().indexOf(&quot;native code&quot;)?da:ea;return l.apply(null,arguments)};var r=&quot;undefined&quot;!=typeof DOMTokenList,t=function(a,b){if(r){var c=a.classList;0==c.contains(b)&amp;&amp;c.toggle(b)}else if(c=a.className){for(var c=c.split(/\s+/),d=!1,f=0;f&lt;c.length&amp;&amp;!d;++f)d=c[f]==b;d||(c.push(b),a.className=c.join(&quot; &quot;))}else a.className=b},v=function(a,b){if(r){var c=a.classList;1==c.contains(b)&amp;&amp;c.toggle(b)}else if((c=a.className)&amp;&amp;!(0&gt;c.indexOf(b))){for(var c=c.split(/\s+/),d=0;d&lt;c.length;++d)c[d]==b&amp;&amp;c.splice(d--,1);a.className=c.join(&quot; &quot;)}};var w=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&amp;&amp;a.attachEvent(&quot;on&quot;+b,c)};var x=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},y=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var z;a:{var A=g.navigator;if(A){var B=A.userAgent;if(B){z=B;break a}}z=&quot;&quot;};var fa=-1!=z.indexOf(&quot;Opera&quot;)||-1!=z.indexOf(&quot;OPR&quot;),C=-1!=z.indexOf(&quot;Trident&quot;)||-1!=z.indexOf(&quot;MSIE&quot;),ga=-1!=z.indexOf(&quot;Edge&quot;),D=-1!=z.indexOf(&quot;Gecko&quot;)&amp;&amp;!(-1!=z.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;-1==z.indexOf(&quot;Edge&quot;))&amp;&amp;!(-1!=z.indexOf(&quot;Trident&quot;)||-1!=z.indexOf(&quot;MSIE&quot;))&amp;&amp;-1==z.indexOf(&quot;Edge&quot;),ha=-1!=z.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;-1==z.indexOf(&quot;Edge&quot;),ia=function(){var a=z;if(D)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ga)return/Edge\/([\d\.]+)/.exec(a);if(C)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(ha)return/WebKit\/(\S+)/.exec(a)},E=function(){var a=g.document;return a?a.documentMode:void 0},F=function(){if(fa&amp;&amp;g.opera){var a;var b=g.opera.version;try{a=b()}catch(c){a=b}return a}a=&quot;&quot;;(b=ia())&amp;&amp;(a=b?b[1]:&quot;&quot;);return C&amp;&amp;(b=E(),b&gt;parseFloat(a))?String(b):a}(),G={},H=function(a){if(!G[a]){for(var b=0,c=x(String(F)).split(&quot;.&quot;),d=x(String(a)).split(&quot;.&quot;),f=Math.max(c.length,d.length),e=0;0==b&amp;&amp;e&lt;f;e++){var m=c[e]||&quot;&quot;,n=d[e]||&quot;&quot;,u=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),k=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var p=u.exec(m)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],q=k.exec(n)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==p[0].length&amp;&amp;0==q[0].length)break;b=y(0==p[1].length?0:parseInt(p[1],10),0==q[1].length?0:parseInt(q[1],10))||y(0==p[2].length,0==q[2].length)||y(p[2],q[2])}while(0==b)}G[a]=0&lt;=b}},I=g.document,ka=I&amp;&amp;C?E()||(&quot;CSS1Compat&quot;==I.compatMode?parseInt(F,10):5):void 0;var J;if(!(J=!D&amp;&amp;!C)){var K;if(K=C)K=9&lt;=ka;J=K}J||D&amp;&amp;H(&quot;1.9.1&quot;);C&amp;&amp;H(&quot;9&quot;);var la=function(a,b){if(!a||!b)return!1;if(a.contains&amp;&amp;1==b.nodeType)return a==b||a.contains(b);if(&quot;undefined&quot;!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&amp;16);for(;b&amp;&amp;a!=b;)b=b.parentNode;return b==a};var ma=function(a,b,c){var d=&quot;mouseenter_custom&quot;==b,f=L(b);return function(e){e||(e=window.event);if(e.type==f){if(&quot;mouseenter_custom&quot;==b||&quot;mouseleave_custom&quot;==b){var m;if(m=d?e.relatedTarget||e.fromElement:e.relatedTarget||e.toElement)for(var n=0;n&lt;a.length;n++)if(la(a[n],m))return}c(e)}}},L=function(a){return&quot;mouseenter_custom&quot;==a?&quot;mouseover&quot;:&quot;mouseleave_custom&quot;==a?&quot;mouseout&quot;:a};var na=function(){this.u=void 0},M=function(a,b,c){if(null==b)c.push(&quot;null&quot;);else{if(&quot;object&quot;==typeof b){if(&quot;array&quot;==ca(b)){var d=b;b=d.length;c.push(&quot;[&quot;);for(var f=&quot;&quot;,e=0;e&lt;b;e++)c.push(f),f=d[e],M(a,a.u?a.u.call(d,String(e),f):f,c),f=&quot;,&quot;;c.push(&quot;]&quot;);return}if(b instanceof String||b instanceof Number||b instanceof Boolean)b=b.valueOf();else{c.push(&quot;{&quot;);e=&quot;&quot;;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&amp;&amp;(f=b[d],&quot;function&quot;!=typeof f&amp;&amp;(c.push(e),N(d,c),c.push(&quot;:&quot;),M(a,a.u?a.u.call(b,d,f):f,c),e=&quot;,&quot;));c.push(&quot;}&quot;);return}}switch(typeof b){case &quot;string&quot;:N(b,c);break;case &quot;number&quot;:c.push(isFinite(b)&amp;&amp;!isNaN(b)?String(b):&quot;null&quot;);break;case &quot;boolean&quot;:c.push(String(b));break;case &quot;function&quot;:c.push(&quot;null&quot;);break;default:throw Error(&quot;Unknown type: &quot;+typeof b);}}},O={&#39;&quot;&#39;:&#39;\\&quot;&#39;,&quot;\\&quot;:&quot;\\\\&quot;,&quot;/&quot;:&quot;\\/&quot;,&quot;\b&quot;:&quot;\\b&quot;,&quot;\f&quot;:&quot;\\f&quot;,&quot;\n&quot;:&quot;\\n&quot;,&quot;\r&quot;:&quot;\\r&quot;,&quot;\t&quot;:&quot;\\t&quot;,&quot;\x0B&quot;:&quot;\\u000b&quot;},oa=/\uffff/.test(&quot;\uffff&quot;)?/[\\\&quot;\x00-\x1f\x7f-\uffff]/g:/[\\\&quot;\x00-\x1f\x7f-\xff]/g,N=function(a,b){b.push(&#39;&quot;&#39;,a.replace(oa,function(a){var b=O[a];b||(b=&quot;\\u&quot;+(a.charCodeAt(0)|65536).toString(16).substr(1),O[a]=b);return b}),&#39;&quot;&#39;)};var P=function(a,b,c,d,f,e,m,n,u,k,p,q){this.m=a;this.da=b;this.L=c;this.ba=d;this.B=f;this.A=e;this.ia=m;this.ga=n;this.o=null;this.J=!1;this.I=q;this.U=p;this.j=document.getElementById(&quot;pubmute&quot;+k);this.i=document.getElementById(&quot;admute&quot;+k);this.l=document.getElementById(&quot;wta&quot;+k);this.V=parseInt(k,10)||0;this.F();this.m.className=[&quot;ddmc&quot;,u&amp;1?&quot;left&quot;:&quot;right&quot;,u&amp;2?&quot;top&quot;:&quot;bottom&quot;].join(&quot; &quot;)};P.prototype.F=function(){Q(this.m,&quot;mouseenter_custom&quot;,this,this.w);Q(this.m,&quot;mouseleave_custom&quot;,this,this.M);this.j&amp;&amp;(Q(this.j,&quot;mouseenter_custom&quot;,this,this.$),Q(this.j,&quot;mouseleave_custom&quot;,this,this.D),w(this.j,&quot;click&quot;,l(this.ca,this)));this.i&amp;&amp;(Q(this.i,&quot;mouseenter_custom&quot;,this,this.R),Q(this.i,&quot;mouseleave_custom&quot;,this,this.v),w(this.i,&quot;click&quot;,l(this.aa,this)));this.l&amp;&amp;(Q(this.l,&quot;mouseenter_custom&quot;,this,this.ea),Q(this.l,&quot;mouseleave_custom&quot;,this,this.G),w(this.l,&quot;click&quot;,l(this.Z,this)))};P.prototype.ca=function(){R(this);S(this,0);var a=this.L;null!=a&amp;&amp;a();T(this,&quot;user_feedback_menu_option&quot;,&quot;3&quot;,!0)};P.prototype.aa=function(){R(this);S(this,1);var a=this.L;null!=a&amp;&amp;a();T(this,&quot;user_feedback_menu_option&quot;,&quot;1&quot;,!0)};var S=function(a,b){var c={type:b,close_button_token:a.A,creative_conversion_url:a.B,ablation_config:a.U,undo_callback:a.ba,creative_index:a.V};if(a.I)a.I.fireOnObject(&quot;mute_option_selected&quot;,c);else{var d;a:{d=[&quot;muteSurvey&quot;];for(var f=g,e;e=d.shift();)if(null!=f[e])f=f[e];else{d=null;break a}d=f}d&amp;&amp;d.setupSurveyPage(c)}};P.prototype.Z=function(a){R(this);a.preventDefault();if(a=window.open(this.ia,&quot;_blank&quot;)){var b={};b.whyThisAdToken=this.ga;b.closeButtonToken=this.A;b.creativeConversionUrl=this.B;var c=[];M(new na,b,c);a.name=c.join(&quot;&quot;)}T(this,&quot;closebutton_whythisad_click&quot;,a?&quot;1&quot;:&quot;2&quot;,!1)};var U=function(a,b){a.m.style.display=b?&quot;&quot;:&quot;none&quot;};P.prototype.M=function(){this.o=g.setTimeout(l(function(){R(this);this.o=null},this),500)};P.prototype.w=function(){null!=this.o&amp;&amp;(g.clearTimeout(this.o),this.o=null)};var R=function(a){var b=a.da;null!=b&amp;&amp;b();V(a)&amp;&amp;U(a,!1)};P.prototype.$=function(){this.j&amp;&amp;t(this.j,&quot;dropdown-item-hover&quot;);this.v();this.G()};P.prototype.D=function(){this.j&amp;&amp;v(this.j,&quot;dropdown-item-hover&quot;)};P.prototype.R=function(){this.i&amp;&amp;t(this.i,&quot;dropdown-item-hover&quot;);this.D();this.G()};P.prototype.v=function(){this.i&amp;&amp;v(this.i,&quot;dropdown-item-hover&quot;)};P.prototype.ea=function(){this.l&amp;&amp;t(this.l,&quot;dropdown-item-hover&quot;);this.v();this.D()};P.prototype.G=function(){this.l&amp;&amp;v(this.l,&quot;dropdown-item-hover&quot;)};var V=function(a){return&quot;none&quot;!==a.m.style.display};P.prototype.toggle=function(){V(this)?V(this)&amp;&amp;U(this,!1):(U(this,!0),this.J||(this.J=!0,T(this,&quot;user_feedback_menu_interaction&quot;)))};var T=function(a,b,c,d){a=a.B+&quot;&amp;label=&quot;+b+(c?&quot;&amp;label_instance=&quot;+c:&quot;&quot;)+(d?&quot;&amp;cbt=&quot;+a.A:&quot;&quot;);b=window;b.google_image_requests||(b.google_image_requests=[]);c=b.document.createElement(&quot;img&quot;);c.src=a;b.google_image_requests.push(c)},Q=function(a,b,c,d){d=ma([a],b,l(d,c));w(a,L(b),l(d,c))};var W=function(a,b,c,d,f,e,m,n,u,k,p,q,aa,pa,ba){this.creativeConversionUrl=f;this.T=e;this.ha=m;this.fa=n;this.S=document.getElementById(&quot;cb-x&quot;+aa);f=l(this.C,this);e=l(this.K,this);m=l(this.N,this);d?(k=k?1:0,p&amp;&amp;(k|=2),d=new P(d,f,e,m,this.creativeConversionUrl,this.T,this.ha,this.fa,k,aa,pa,ba)):d=null;this.h=d;this.O=document.getElementById(&quot;pbc&quot;);this.g=a;this.P=b;this.H=c;this.s=ba;&quot;undefined&quot;!=typeof SVGElement&amp;&amp;&quot;undefined&quot;!=typeof document.createElementNS&amp;&amp;q&amp;&amp;(this.g.style.backgroundImage=&quot;none&quot;,this.S.appendChild(qa(u)));this.F()},X;W.prototype.F=function(){w(this.g,&quot;click&quot;,l(this.W,this));w(this.g,&quot;mouseover&quot;,l(this.Y,this));w(this.g,&quot;mouseout&quot;,l(this.X,this))};W.prototype.W=function(){this.h&amp;&amp;(this.h.w(),this.h.toggle())};W.prototype.Y=function(){this.h&amp;&amp;this.h.w();null!==this.g&amp;&amp;t(this.g,&quot;cbc-hover&quot;)};W.prototype.X=function(){this.h&amp;&amp;V(this.h)?this.h.M():this.C()};var qa=function(a){var b=document.createElementNS(&quot;//www.w3.org/2000/svg&quot;,&quot;svg&quot;),c=document.createElementNS(&quot;//www.w3.org/2000/svg&quot;,&quot;path&quot;),d=document.createElementNS(&quot;//www.w3.org/2000/svg&quot;,&quot;path&quot;),f=1.15/Math.sqrt(2),e=.2*a,f=&quot;M&quot;+(e+f+1)+&quot;,&quot;+e+&quot;L&quot;+(a/2+1)+&quot;,&quot;+(a/2-f)+&quot;L&quot;+(a-e-f+1)+&quot;,&quot;+e+&quot;L&quot;+(a-e+1)+&quot;,&quot;+(e+f)+&quot;L&quot;+(a/2+f+1)+&quot;,&quot;+a/2+&quot;L&quot;+(a-e+1)+&quot;,&quot;+(a-e-f)+&quot;L&quot;+(a-e-f+1)+&quot;,&quot;+(a-e)+&quot;L&quot;+(a/2+1)+&quot;,&quot;+(a/2+f)+&quot;L&quot;+(e+f+1)+&quot;,&quot;+(a-e)+&quot;L&quot;+(e+1)+&quot;,&quot;+(a-e-f)+&quot;L&quot;+(a/2-f+1)+&quot;,&quot;+a/2+&quot;L&quot;+(e+1)+&quot;,&quot;+(e+f)+&quot;Z&quot;,e=&quot;M0,0L1,0L1,&quot;+a+&quot;L0,&quot;+a+&quot;Z&quot;;b.setAttribute(&quot;class&quot;,&quot;cb-x-svg&quot;);b.setAttribute(&quot;width&quot;,a+1);b.setAttribute(&quot;height&quot;,a);b.appendChild(c);b.appendChild(d);c.setAttribute(&quot;d&quot;,f);c.setAttribute(&quot;class&quot;,&quot;cb-x-svg-path&quot;);d.setAttribute(&quot;d&quot;,e);d.setAttribute(&quot;class&quot;,&quot;cb-x-svg-s-path&quot;);return b},Y=function(a){a&amp;&amp;(a.style.display=&quot;block&quot;)},Z=function(a){a&amp;&amp;(a.style.display=&quot;none&quot;)};W.prototype.C=function(){null!==this.g&amp;&amp;v(this.g,&quot;cbc-hover&quot;)};W.prototype.K=function(){this.C();this.s?this.s.showOnly(0):(Z(this.g),Z(this.H),Z(this.O),Y(this.P))};W.prototype.N=function(){this.s?this.s.resetAll():(Y(this.g),Y(this.H),Y(this.O),Z(this.P))};h(&quot;cbb&quot;,function(a,b,c,d,f,e,m,n,u,k,p,q){w(window,&quot;load&quot;,function(){a&amp;&amp;(X=new W(a,document.getElementById(&quot;cbtf&quot;),b,c,d,f,e,m,15,u,k,p,q,n,window.adSlot))})});h(&quot;cbbha&quot;,function(){X.K()});h(&quot;cbbsa&quot;,function(){X.N()});}).call(this);cbb(document.getElementById(&#39;cbc&#39;),document.getElementById(&#39;ad_unit&#39;),document.getElementById(&#39;ddmc&#39;),&#39;http://googleads.g.doubleclick.net/pagead/conversion/?ai\x3dC7mka_QiJVuz1ONSF9gWm05fwC7mLrqgKsfWu66EBwZXo2YQBEAEg28-9F2CdgYCAmAXIAQGpAkXPydFSq4Q-4AIAqAMByAObBKoEjQFP0JdAu8RU7bvoyXfmleZS4GoYgDMJV74Rg1q1L5jsToN0QASL86UUgOpVrMLaECDFXn_HBCnTfg73NXzXa51-i9GPk7XqvOwxO2ZGsKdtJrnEIRLfE5pr3uGO9qhJ94GWoePfjO3vOLAqVZYr42BBBD_obuQyEh1hveP7CVY-Kk3eeg8KLPaAyRgzvWbgBAGAB9GIrh6oB6a-G9gHAQ\x26sigh\x3dWelgcYF_dtw&#39;,&#39;15UUJfj0KvIIsfWu66EBEPHawkIY8eyoHyIOd3d3Lm1pbml1aS5jb20yCAgFExi12QoUQhdjYS1wdWItNzQ0MzcwNDE5NDIyOTY5NEgAWAFwAQ&#39;,&#39;https://www.google.com/ads/preferences/whythisad//Gbc2IQqM9Vt5LmmF&#39;,&#39;&#39;,&#39;{\x22key_value\x22:[]}&#39;,false,false,false,&#39;&#39;);&lt;/script&gt;&lt;/li&gt;&lt;script&gt;buildTextAd(adSlot, 0);&lt;/script&gt;&lt;/ul&gt;&lt;/div&gt;&lt;div class=ads_chrome_top&gt;&lt;/div&gt;&lt;div class=ads_chrome_bottom&gt;&lt;/div&gt;&lt;div class=ads_chrome_left&gt;&lt;/div&gt;&lt;div class=ads_chrome_right&gt;&lt;/div&gt;&lt;/div&gt;&lt;script&gt;(function(){var g,h=this,aa=function(a,b,c){return a.call.apply(a.bind,arguments)},ba=function(a,b,c){if(!a)throw Error();if(2&lt;arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}},l=function(a,b,c){l=Function.prototype.bind&amp;&amp;-1!=Function.prototype.bind.toString().indexOf(&quot;native code&quot;)?aa:ba;return l.apply(null,arguments)},m=Date.now||function(){return+new Date};var n=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},p=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var q=function(a){return Array.prototype.concat.apply(Array.prototype,arguments)},ca=function(a){var b=a.length;if(0&lt;b){for(var c=Array(b),d=0;d&lt;b;d++)c[d]=a[d];return c}return[]};var r;a:{var t=h.navigator;if(t){var u=t.userAgent;if(u){r=u;break a}}r=&quot;&quot;}var v=function(a){return-1!=r.indexOf(a)};var w=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&amp;&amp;a.attachEvent(&quot;on&quot;+b,c)};var da=v(&quot;Opera&quot;)||v(&quot;OPR&quot;),x=v(&quot;Trident&quot;)||v(&quot;MSIE&quot;),ea=v(&quot;Edge&quot;),y=v(&quot;Gecko&quot;)&amp;&amp;!(-1!=r.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!v(&quot;Edge&quot;))&amp;&amp;!(v(&quot;Trident&quot;)||v(&quot;MSIE&quot;))&amp;&amp;!v(&quot;Edge&quot;),fa=-1!=r.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!v(&quot;Edge&quot;),ga=function(){var a=r;if(y)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ea)return/Edge\/([\d\.]+)/.exec(a);if(x)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(fa)return/WebKit\/(\S+)/.exec(a)},z=function(){var a=h.document;return a?a.documentMode:void 0},A=function(){if(da&amp;&amp;h.opera){var a;var b=h.opera.version;try{a=b()}catch(c){a=b}return a}a=&quot;&quot;;(b=ga())&amp;&amp;(a=b?b[1]:&quot;&quot;);return x&amp;&amp;(b=z(),b&gt;parseFloat(a))?String(b):a}(),D={},E=function(a){if(!D[a]){for(var b=0,c=n(String(A)).split(&quot;.&quot;),d=n(String(a)).split(&quot;.&quot;),e=Math.max(c.length,d.length),f=0;0==b&amp;&amp;f&lt;e;f++){var k=c[f]||&quot;&quot;,pa=d[f]||&quot;&quot;,qa=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),ra=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var B=qa.exec(k)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],C=ra.exec(pa)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==B[0].length&amp;&amp;0==C[0].length)break;b=p(0==B[1].length?0:parseInt(B[1],10),0==C[1].length?0:parseInt(C[1],10))||p(0==B[2].length,0==C[2].length)||p(B[2],C[2])}while(0==b)}D[a]=0&lt;=b}},ha=h.document,ia=ha&amp;&amp;x?z()||(&quot;CSS1Compat&quot;==ha.compatMode?parseInt(A,10):5):void 0;var F;if(!(F=!y&amp;&amp;!x)){var G;if(G=x)G=9&lt;=ia;F=G}F||y&amp;&amp;E(&quot;1.9.1&quot;);x&amp;&amp;E(&quot;9&quot;);var H=document,I=window;var ka=&quot;StopIteration&quot;in h?h.StopIteration:{message:&quot;StopIteration&quot;,stack:&quot;&quot;},J=function(){};J.prototype.next=function(){throw ka;};J.prototype.W=function(){return this};var K=function(a,b){this.m={};this.i=[];this.J=this.h=0;var c=arguments.length;if(1&lt;c){if(c%2)throw Error(&quot;Uneven number of arguments&quot;);for(var d=0;d&lt;c;d+=2)this.set(arguments[d],arguments[d+1])}else a&amp;&amp;this.addAll(a)};K.prototype.v=function(){L(this);for(var a=[],b=0;b&lt;this.i.length;b++)a.push(this.m[this.i[b]]);return a};K.prototype.B=function(){L(this);return this.i.concat()};K.prototype.A=function(a){return M(this.m,a)};K.prototype.remove=function(a){return M(this.m,a)?(delete this.m[a],this.h--,this.J++,this.i.length&gt;2*this.h&amp;&amp;L(this),!0):!1};var L=function(a){if(a.h!=a.i.length){for(var b=0,c=0;b&lt;a.i.length;){var d=a.i[b];M(a.m,d)&amp;&amp;(a.i[c++]=d);b++}a.i.length=c}if(a.h!=a.i.length){for(var e={},c=b=0;b&lt;a.i.length;)d=a.i[b],M(e,d)||(a.i[c++]=d,e[d]=1),b++;a.i.length=c}};g=K.prototype;g.get=function(a,b){return M(this.m,a)?this.m[a]:b};g.set=function(a,b){M(this.m,a)||(this.h++,this.i.push(a),this.J++);this.m[a]=b};g.addAll=function(a){var b;if(a instanceof K)b=a.B(),a=a.v();else{b=[];var c=0,d;for(d in a)b[c++]=d;c=[];d=0;for(var e in a)c[d++]=a[e];a=c}for(e=0;e&lt;b.length;e++)this.set(b[e],a[e])};g.forEach=function(a,b){for(var c=this.B(),d=0;d&lt;c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};g.clone=function(){return new K(this)};g.W=function(a){L(this);var b=0,c=this.J,d=this,e=new J;e.next=function(){if(c!=d.J)throw Error(&quot;The map has changed since the iterator was created&quot;);if(b&gt;=d.i.length)throw ka;var e=d.i[b++];return a?e:d.m[e]};return e};var M=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};var la=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,ma=function(a,b){if(a)for(var c=a.split(&quot;&amp;&quot;),d=0;d&lt;c.length;d++){var e=c[d].indexOf(&quot;=&quot;),f=null,k=null;0&lt;=e?(f=c[d].substring(0,e),k=c[d].substring(e+1)):f=c[d];b(f,k?decodeURIComponent(k.replace(/\+/g,&quot; &quot;)):&quot;&quot;)}};var N=function(a,b){this.u=this.I=this.w=&quot;&quot;;this.H=null;this.F=this.D=&quot;&quot;;this.l=this.Z=!1;var c;if(a instanceof N)this.l=void 0!==b?b:a.l,na(this,a.w),c=a.I,O(this),this.I=c,c=a.u,O(this),this.u=c,oa(this,a.H),c=a.D,O(this),this.D=c,sa(this,a.o.clone()),c=a.F,O(this),this.F=c;else if(a&amp;&amp;(c=String(a).match(la))){this.l=!!b;na(this,c[1]||&quot;&quot;,!0);var d=c[2]||&quot;&quot;;O(this);this.I=P(d);d=c[3]||&quot;&quot;;O(this);this.u=P(d,!0);oa(this,c[4]);d=c[5]||&quot;&quot;;O(this);this.D=P(d,!0);sa(this,c[6]||&quot;&quot;,!0);c=c[7]||&quot;&quot;;O(this);this.F=P(c)}else this.l=!!b,this.o=new Q(null,0,this.l)};N.prototype.toString=function(){var a=[],b=this.w;b&amp;&amp;a.push(R(b,ta,!0),&quot;:&quot;);var c=this.u;if(c||&quot;file&quot;==b)a.push(&quot;//&quot;),(b=this.I)&amp;&amp;a.push(R(b,ta,!0),&quot;@&quot;),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,&quot;%$1&quot;)),c=this.H,null!=c&amp;&amp;a.push(&quot;:&quot;,String(c));if(c=this.D)this.u&amp;&amp;&quot;/&quot;!=c.charAt(0)&amp;&amp;a.push(&quot;/&quot;),a.push(R(c,&quot;/&quot;==c.charAt(0)?ua:va,!0));(c=this.o.toString())&amp;&amp;a.push(&quot;?&quot;,c);(c=this.F)&amp;&amp;a.push(&quot;#&quot;,R(c,wa));return a.join(&quot;&quot;)};N.prototype.clone=function(){return new N(this)};var na=function(a,b,c){O(a);a.w=c?P(b,!0):b;a.w&amp;&amp;(a.w=a.w.replace(/:$/,&quot;&quot;))},oa=function(a,b){O(a);if(b){b=Number(b);if(isNaN(b)||0&gt;b)throw Error(&quot;Bad port number &quot;+b);a.H=b}else a.H=null},sa=function(a,b,c){O(a);b instanceof Q?(a.o=b,a.o.N(a.l)):(c||(b=R(b,xa)),a.o=new Q(b,0,a.l))},O=function(a){if(a.Z)throw Error(&quot;Tried to modify a read-only Uri&quot;);};N.prototype.N=function(a){this.l=a;this.o&amp;&amp;this.o.N(a);return this};var P=function(a,b){return a?b?decodeURI(a.replace(/%25/g,&quot;%2525&quot;)):decodeURIComponent(a):&quot;&quot;},R=function(a,b,c){return&quot;string&quot;==typeof a?(a=encodeURI(a).replace(b,ya),c&amp;&amp;(a=a.replace(/%25([0-9a-fA-F]{2})/g,&quot;%$1&quot;)),a):null},ya=function(a){a=a.charCodeAt(0);return&quot;%&quot;+(a&gt;&gt;4&amp;15).toString(16)+(a&amp;15).toString(16)},ta=/[#\/\?@]/g,va=/[\#\?:]/g,ua=/[\#\?]/g,xa=/[\#\?@]/g,wa=/#/g,Q=function(a,b,c){this.h=this.g=null;this.j=a||null;this.l=!!c},S=function(a){a.g||(a.g=new K,a.h=0,a.j&amp;&amp;ma(a.j,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g,&quot; &quot;)),c)}))};g=Q.prototype;g.add=function(a,b){S(this);this.j=null;a=T(this,a);var c=this.g.get(a);c||this.g.set(a,c=[]);c.push(b);this.h++;return this};g.remove=function(a){S(this);a=T(this,a);return this.g.A(a)?(this.j=null,this.h-=this.g.get(a).length,this.g.remove(a)):!1};g.A=function(a){S(this);a=T(this,a);return this.g.A(a)};g.B=function(){S(this);for(var a=this.g.v(),b=this.g.B(),c=[],d=0;d&lt;b.length;d++)for(var e=a[d],f=0;f&lt;e.length;f++)c.push(b[d]);return c};g.v=function(a){S(this);var b=[];if(&quot;string&quot;==typeof a)this.A(a)&amp;&amp;(b=q(b,this.g.get(T(this,a))));else{a=this.g.v();for(var c=0;c&lt;a.length;c++)b=q(b,a[c])}return b};g.set=function(a,b){S(this);this.j=null;a=T(this,a);this.A(a)&amp;&amp;(this.h-=this.g.get(a).length);this.g.set(a,[b]);this.h++;return this};g.get=function(a,b){var c=a?this.v(a):[];return 0&lt;c.length?String(c[0]):b};g.toString=function(){if(this.j)return this.j;if(!this.g)return&quot;&quot;;for(var a=[],b=this.g.B(),c=0;c&lt;b.length;c++)for(var d=b[c],e=encodeURIComponent(String(d)),d=this.v(d),f=0;f&lt;d.length;f++){var k=e;&quot;&quot;!==d[f]&amp;&amp;(k+=&quot;=&quot;+encodeURIComponent(String(d[f])));a.push(k)}return this.j=a.join(&quot;&amp;&quot;)};g.clone=function(){var a=new Q;a.j=this.j;this.g&amp;&amp;(a.g=this.g.clone(),a.h=this.h);return a};var T=function(a,b){var c=String(b);a.l&amp;&amp;(c=c.toLowerCase());return c};Q.prototype.N=function(a){a&amp;&amp;!this.l&amp;&amp;(S(this),this.j=null,this.g.forEach(function(a,c){var d=c.toLowerCase();c!=d&amp;&amp;(this.remove(c),this.remove(d),0&lt;a.length&amp;&amp;(this.j=null,this.g.set(T(this,d),ca(a)),this.h+=a.length))},this));this.l=a};var W=function(a,b,c,d,e,f,k){U(H.hidden)?(this.C=&quot;hidden&quot;,this.K=&quot;visibilitychange&quot;):U(H.mozHidden)?(this.C=&quot;mozHidden&quot;,this.K=&quot;mozvisibilitychange&quot;):U(H.msHidden)?(this.C=&quot;msHidden&quot;,this.K=&quot;msvisibilitychange&quot;):U(H.webkitHidden)&amp;&amp;(this.C=&quot;webkitHidden&quot;,this.K=&quot;webkitvisibilitychange&quot;);this.M=!1;this.s=a;this.G=-1;this.T=b;this.V=c;this.$=d;this.X=f;this.P=k?&quot;mousedown&quot;:&quot;click&quot;;e&amp;&amp;H[this.C]&amp;&amp;V(this,2);this.O=this.R=this.L=null;a=l(this.Y,this);w(H,this.K,a);za(this)};W.prototype.Y=function(){if(H[this.C])this.M&amp;&amp;(this.S(),this.G=m(),V(this,0));else{if(-1!=this.G){var a=m()-this.G;this.G=-1;V(this,1,a);null!==this.s&amp;&amp;this.s.registerFinalizeCallback(l(this.s.fireOnObject,this.s,&quot;attempt_survey_trigger&quot;,[&quot;wfocus&quot;,this.V,this.T,this.L,this.R,this.O,a]))}this.X&amp;&amp;V(this,3)}};var za=function(a){if(null!==a.s){var b=l(function(a,b){this.L=b.ca().ba();if(!this.L){var c=new N(b.aa());this.L=c.u+c.D}this.R=b.creativeConversionUrl();this.O=b.adGroupCreativeId();this.U()},a),c=a.P;a.s.forEachAd(function(a){a.forEachNavigationAdPiece(function(d){a.listen(d,c,b)})})}else{var d=l(a.U,a);w(I,a.P,d)}};W.prototype.U=function(){this.M=!0;var a=l(this.S,this);I.setTimeout(a,5E3)};W.prototype.S=function(){this.M=!1};var V=function(a,b,c){a=[&quot;//&quot;,a.$?&quot;googleads.g.doubleclick.net&quot;:&quot;pagead2.googlesyndication.com&quot;,&quot;/pagead/gen_204?id=wfocus&quot;,&quot;&amp;gqid=&quot;+a.T,&quot;&amp;qqid=&quot;+a.V].join(&quot;&quot;);0==b&amp;&amp;(a+=&quot;&amp;return=0&quot;);1==b&amp;&amp;(a+=&quot;&amp;return=1&amp;timeDelta=&quot;+c);2==b&amp;&amp;(a+=&quot;&amp;bgload=1&quot;);3==b&amp;&amp;(a+=&quot;&amp;fg=1&quot;);I.google_image_requests||(I.google_image_requests=[]);b=I.document.createElement(&quot;img&quot;);b.src=a;I.google_image_requests.push(b)},U=function(a){return&quot;undefined&quot;!==typeof a};var Aa=function(a,b,c,d,e,f){return new W(null,a,b,c,d,e,f)},X=[&quot;wfocusnhinit&quot;],Y=h;X[0]in Y||!Y.execScript||Y.execScript(&quot;var &quot;+X[0]);for(var Z;X.length&amp;&amp;(Z=X.shift());)X.length||void 0===Aa?Y=Y[Z]?Y[Z]:Y[Z]={}:Y[Z]=Aa;}).call(this);wfocusnhinit(&quot;_QiJVsmENsH59QWg6YnIDA&quot;,&quot;CKzo0uvHjcoCFdSCvQodpukFvg&quot;,true,true,true,false);&lt;/script&gt;&lt;iframe scrolling=&quot;no&quot; frameborder=0 height=0 width=0 src=&quot;http://cm.g.doubleclick.net/push?client=ca-pub-7443704194229694&quot; style=&quot;position:absolute&quot;&gt;&lt;/iframe&gt;&lt;script type=&quot;text/javascript&quot;&gt;(function(){var h=this,aa=function(a){var b=typeof a;if(&quot;object&quot;==b)if(a){if(a instanceof Array)return&quot;array&quot;;if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if(&quot;[object Window]&quot;==c)return&quot;object&quot;;if(&quot;[object Array]&quot;==c||&quot;number&quot;==typeof a.length&amp;&amp;&quot;undefined&quot;!=typeof a.splice&amp;&amp;&quot;undefined&quot;!=typeof a.propertyIsEnumerable&amp;&amp;!a.propertyIsEnumerable(&quot;splice&quot;))return&quot;array&quot;;if(&quot;[object Function]&quot;==c||&quot;undefined&quot;!=typeof a.call&amp;&amp;&quot;undefined&quot;!=typeof a.propertyIsEnumerable&amp;&amp;!a.propertyIsEnumerable(&quot;call&quot;))return&quot;function&quot;}else return&quot;null&quot;;else if(&quot;function&quot;==b&amp;&amp;&quot;undefined&quot;==typeof a.call)return&quot;object&quot;;return b},k=function(a){return&quot;string&quot;==typeof a},ba=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}},m=Date.now||function(){return+new Date},n=function(a,b){var c=a.split(&quot;.&quot;),d=h;c[0]in d||!d.execScript||d.execScript(&quot;var &quot;+c[0]);for(var e;c.length&amp;&amp;(e=c.shift());)c.length||void 0===b?d=d[e]?d[e]:d[e]={}:d[e]=b};var p=function(a,b,c,d,e){if(e)c=a+(&quot;&amp;&quot;+b+&quot;=&quot;+c);else{var f=&quot;&amp;&quot;+b+&quot;=&quot;,g=a.indexOf(f);0&gt;g?c=a+f+c:(g+=f.length,f=a.indexOf(&quot;&amp;&quot;,g),c=0&lt;=f?a.substring(0,g)+c+a.substring(f):a.substring(0,g)+c)}return 2E3&lt;c.length?void 0!==d?p(a,b,d,void 0,e):a:c};var ca=function(){var a=/[&amp;\?]exk=([^&amp; ]+)/.exec(q.location.href);return a&amp;&amp;2==a.length?a[1]:null};var r=function(a,b){this.width=a;this.height=b};r.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};var da=function(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&amp;&amp;b.call(void 0,a[c],c,a)},fa=function(){var a=ea;if(!a)return&quot;&quot;;var b=/.*[&amp;#?]google_debug(=[^&amp;]*)?(&amp;.*)?$/;try{var c=b.exec(decodeURIComponent(a));if(c)return c[1]&amp;&amp;1&lt;c[1].length?c[1].substring(1):&quot;true&quot;}catch(d){}return&quot;&quot;};var ga=function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&amp;&amp;a.attachEvent(&quot;on&quot;+b,c)};var ha=function(a){var b=&quot;&quot;;da(a,function(a,d){if(0===a||a)b+=&quot;&amp;&quot;+d+&quot;=&quot;+encodeURIComponent(String(a))});return b},ia=function(a,b,c){a.google_image_requests||(a.google_image_requests=[]);var d=a.document.createElement(&quot;img&quot;);if(c){var e=function(a){c(a);a=e;d.removeEventListener?d.removeEventListener(&quot;load&quot;,a,!1):d.detachEvent&amp;&amp;d.detachEvent(&quot;onload&quot;,a);a=e;d.removeEventListener?d.removeEventListener(&quot;error&quot;,a,!1):d.detachEvent&amp;&amp;d.detachEvent(&quot;onerror&quot;,a)};ga(d,&quot;load&quot;,e);ga(d,&quot;error&quot;,e)}d.src=b;a.google_image_requests.push(d)};var ja=function(a,b,c){this.v=a;this.u=b;this.c=c;this.f=null;this.s=this.g;this.A=!1},ka=function(a,b,c){this.message=a;this.fileName=b||&quot;&quot;;this.lineNumber=c||-1},ma=function(a,b,c){var d;try{d=c()}catch(g){var e=a.c;try{var f=la(g),e=a.s.call(a,b,f,void 0,void 0)}catch(l){a.g(&quot;pAR&quot;,l)}if(!e)throw g;}finally{}return d},t=function(a,b){var c=na;return function(){var d=arguments;return ma(c,a,function(){return b.apply(void 0,d)})}};ja.prototype.g=function(a,b,c,d,e){var f={};f.context=a;b instanceof ka||(b=la(b));f.msg=b.message.substring(0,512);b.fileName&amp;&amp;(f.file=b.fileName);0&lt;b.lineNumber&amp;&amp;(f.line=b.lineNumber.toString());a=h.document;f.url=a.URL.substring(0,512);f.ref=a.referrer.substring(0,512);if(this.f)try{this.f(f)}catch(l){}if(d)try{d(f)}catch(l){}d=this.v;try{if((this.A?d.w:Math.random())&lt;(c||d.o)){var g=d.m+(e||this.u)+ha(f),g=g.substring(0,2E3);ia(h,g)}}catch(l){}return this.c};var la=function(a){var b=a.toString();a.name&amp;&amp;-1==b.indexOf(a.name)&amp;&amp;(b+=&quot;: &quot;+a.name);a.message&amp;&amp;-1==b.indexOf(a.message)&amp;&amp;(b+=&quot;: &quot;+a.message);if(a.stack){var c=a.stack,d=b;try{-1==c.indexOf(d)&amp;&amp;(c=d+&quot;\n&quot;+c);for(var e;c!=e;)e=c,c=c.replace(/((https?:\/..*\/)[^\/:]*:\d+(?:.|\n)*)\2/,&quot;$1&quot;);b=c.replace(/\n */g,&quot;\n&quot;)}catch(f){b=d}}return new ka(b,a.fileName,a.lineNumber)};var oa=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},pa=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var qa=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0&gt;c?Math.max(0,a.length+c):c;if(k(a))return k(b)&amp;&amp;1==b.length?a.indexOf(b,c):-1;for(;c&lt;a.length;c++)if(c in a&amp;&amp;a[c]===b)return c;return-1},ra=Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=k(a)?a.split(&quot;&quot;):a,g=0;g&lt;d;g++)g in f&amp;&amp;(e[g]=b.call(c,f[g],g,a));return e};var sa=function(a,b){for(var c in a)b.call(void 0,a[c],c,a)};var v;a:{var ta=h.navigator;if(ta){var ua=ta.userAgent;if(ua){v=ua;break a}}v=&quot;&quot;}var w=function(a){return-1!=v.indexOf(a)};var x=function(){return w(&quot;Opera&quot;)||w(&quot;OPR&quot;)},va=function(){return(w(&quot;Chrome&quot;)||w(&quot;CriOS&quot;))&amp;&amp;!x()&amp;&amp;!w(&quot;Edge&quot;)};var wa=function(){return w(&quot;iPhone&quot;)&amp;&amp;!w(&quot;iPod&quot;)&amp;&amp;!w(&quot;iPad&quot;)};var xa=x(),y=w(&quot;Trident&quot;)||w(&quot;MSIE&quot;),ya=w(&quot;Edge&quot;),z=w(&quot;Gecko&quot;)&amp;&amp;!(-1!=v.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!w(&quot;Edge&quot;))&amp;&amp;!(w(&quot;Trident&quot;)||w(&quot;MSIE&quot;))&amp;&amp;!w(&quot;Edge&quot;),za=-1!=v.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!w(&quot;Edge&quot;),Aa=function(){var a=v;if(z)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ya)return/Edge\/([\d\.]+)/.exec(a);if(y)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(za)return/WebKit\/(\S+)/.exec(a)},Ba=function(){var a=h.document;return a?a.documentMode:void 0},Ca=function(){if(xa&amp;&amp;h.opera){var a;var b=h.opera.version;try{a=b()}catch(c){a=b}return a}a=&quot;&quot;;(b=Aa())&amp;&amp;(a=b?b[1]:&quot;&quot;);return y&amp;&amp;(b=Ba(),b&gt;parseFloat(a))?String(b):a}(),Da={},A=function(a){var b;if(!(b=Da[a])){b=0;for(var c=oa(String(Ca)).split(&quot;.&quot;),d=oa(String(a)).split(&quot;.&quot;),e=Math.max(c.length,d.length),f=0;0==b&amp;&amp;f&lt;e;f++){var g=c[f]||&quot;&quot;,l=d[f]||&quot;&quot;,V=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),u=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var M=V.exec(g)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],N=u.exec(l)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==M[0].length&amp;&amp;0==N[0].length)break;b=pa(0==M[1].length?0:parseInt(M[1],10),0==N[1].length?0:parseInt(N[1],10))||pa(0==M[2].length,0==N[2].length)||pa(M[2],N[2])}while(0==b)}b=Da[a]=0&lt;=b}return b},Ea=h.document,Fa=Ea&amp;&amp;y?Ba()||(&quot;CSS1Compat&quot;==Ea.compatMode?parseInt(Ca,10):5):void 0;!z&amp;&amp;!y||y&amp;&amp;9&lt;=Fa||z&amp;&amp;A(&quot;1.9.1&quot;);y&amp;&amp;A(&quot;9&quot;);var B=document,q=window;var C=null;function D(a){return&quot;function&quot;==typeof encodeURIComponent?encodeURIComponent(a):escape(a)}var E=function(a,b){ia(a,b,void 0)},Ga=function(){if(!B.body)return!1;if(!C){var a=B.createElement(&quot;iframe&quot;);a.style.display=&quot;none&quot;;a.id=&quot;anonIframe&quot;;C=a;B.body.appendChild(a)}return!0},Ha={};var na;na=new ja(new function(){this.m=&quot;http&quot;+(&quot;http:&quot;==q.location.protocol?&quot;&quot;:&quot;s&quot;)+&quot;://pagead2.googlesyndication.com/pagead/gen_204?id=&quot;;this.o=.01;this.w=Math.random()},&quot;jserror&quot;,!0);var F=function(a,b){return t(a,b)};y&amp;&amp;A(&quot;9&quot;);!za||A(&quot;528&quot;);z&amp;&amp;A(&quot;1.9b&quot;)||y&amp;&amp;A(&quot;8&quot;)||xa&amp;&amp;A(&quot;9.5&quot;)||za&amp;&amp;A(&quot;528&quot;);z&amp;&amp;!A(&quot;8&quot;)||y&amp;&amp;A(&quot;9&quot;);var Ia=function(a,b,c){if(&quot;array&quot;==aa(b))for(var d=0;d&lt;b.length;d++)Ia(a,String(b[d]),c);else null!=b&amp;&amp;c.push(&quot;&amp;&quot;,a,&quot;&quot;===b?&quot;&quot;:&quot;=&quot;,encodeURIComponent(String(b)))},Ja=function(a,b,c){for(c=c||0;c&lt;b.length;c+=2)Ia(b[c],b[c+1],a);return a},Ka=function(a,b){var c=2==arguments.length?Ja([a],arguments[1],0):Ja([a],arguments,1);if(c[1]){var d=c[0],e=d.indexOf(&quot;#&quot;);0&lt;=e&amp;&amp;(c.push(d.substr(e)),c[0]=d=d.substr(0,e));e=d.indexOf(&quot;?&quot;);0&gt;e?c[1]=&quot;?&quot;:e==d.length-1&amp;&amp;(c[1]=void 0)}return c.join(&quot;&quot;)};var La=0,G={},Na=function(a){var b=G.imageLoadingEnabled;if(null!=b)a(b);else{var c=!1;Ma(function(b,e){delete G[e];c||(c=!0,null!=G.imageLoadingEnabled||(G.imageLoadingEnabled=b),a(b))})}},Ma=function(a){var b=new Image,c,d=&quot;&quot;+La++;G[d]=b;b.onload=function(){clearTimeout(c);a(!0,d)};c=setTimeout(function(){a(!1,d)},300);b.src=&quot;data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==&quot;},Oa=function(a){if(a){var b=document.createElement(&quot;OBJECT&quot;);b.data=a;b.width=1;b.height=1;b.style.visibility=&quot;hidden&quot;;var c=&quot;&quot;+La++;G[c]=b;b.onload=b.onerror=function(){delete G[c]};document.body.appendChild(b)}},Pa=function(a){if(a){var b=new Image,c=&quot;&quot;+La++;G[c]=b;b.onload=b.onerror=function(){delete G[c]};b.src=a}},Qa=function(a){Na(function(b){b?Pa(a):Oa(a)})};var Ra={l:&quot;ud=1&quot;,j:&quot;ts=0&quot;,B:&quot;sc=1&quot;,h:&quot;gz=1&quot;,i:&quot;op=1&quot;};if(B&amp;&amp;B.URL){var ea=B.URL,Sa=!(ea&amp;&amp;0&lt;fa().length);na.c=Sa}var H=function(a,b,c,d){ga(a,b,t(d||&quot;osd_or_lidar::&quot;+b,c),void 0)},Ta=function(a,b,c){if(!(0&gt;=b)){var d=0,e=function(){a();d++;d&lt;b&amp;&amp;q.setTimeout(t(c,e),100)};e()}};var I=function(a,b){this.b=a||0;this.a=b||&quot;&quot;},J=function(a,b){a.b&amp;&amp;(b[4]=a.b);a.a&amp;&amp;(b[12]=a.a)};I.prototype.match=function(a){return(this.b||this.a)&amp;&amp;(a.b||a.a)?this.a||a.a?this.a==a.a:this.b||a.b?this.b==a.b:!1:!1};I.prototype.toString=function(){var a=&quot;&quot;+this.b;this.a&amp;&amp;(a+=&quot;-&quot;+this.a);return a};var Ua=function(){var a=K,b=[];a.b&amp;&amp;b.push(&quot;adk=&quot;+a.b);a.a&amp;&amp;b.push(&quot;exk=&quot;+a.a);return b},L=function(a){var b=[];sa(a,function(a,d){var e=D(d),f=a;k(f)&amp;&amp;(f=D(f));b.push(e+&quot;=&quot;+f)});return b.join(&quot;\n&quot;)},Va=0,Wa=0,Xa=function(a){var b=0,c=q;try{if(c&amp;&amp;c.Goog_AdSense_getAdAdapterInstance)return c}catch(d){}for(;c&amp;&amp;5&gt;b;){try{if(c.google_osd_static_frame)return c}catch(d){}try{if(c.aswift_0&amp;&amp;(!a||c.aswift_0.google_osd_static_frame))return c.aswift_0}catch(d){}b++;c=c!=c.parent?c.parent:null}return null},Ya=function(a,b,c,d,e){if(10&lt;Wa)q.clearInterval(Va);else if(++Wa,q.postMessage&amp;&amp;(b.b||b.a)){var f=Xa(!0);if(f){var g={};J(b,g);g[0]=&quot;goog_request_monitoring&quot;;g[6]=a;g[16]=c;d&amp;&amp;d.length&amp;&amp;(g[17]=d.join(&quot;,&quot;));e&amp;&amp;(g[19]=e);try{var l=L(g);f.postMessage(l,&quot;*&quot;)}catch(V){}}}},Za=function(a){var b=Xa(!1),c=!b;!b&amp;&amp;q&amp;&amp;(b=q.parent);if(b&amp;&amp;b.postMessage)try{b.postMessage(a,&quot;*&quot;),c&amp;&amp;q.postMessage(a,&quot;*&quot;)}catch(d){}};var O=!1,$a=function(a){if(a=a.match(/[\d]+/g))a.length=3};(function(){if(navigator.plugins&amp;&amp;navigator.plugins.length){var a=navigator.plugins[&quot;Shockwave Flash&quot;];if(a&amp;&amp;(O=!0,a.description)){$a(a.description);return}if(navigator.plugins[&quot;Shockwave Flash 2.0&quot;]){O=!0;return}}if(navigator.mimeTypes&amp;&amp;navigator.mimeTypes.length&amp;&amp;(O=(a=navigator.mimeTypes[&quot;application/x-shockwave-flash&quot;])&amp;&amp;a.enabledPlugin)){$a(a.enabledPlugin.description);return}try{var b=new ActiveXObject(&quot;ShockwaveFlash.ShockwaveFlash.7&quot;);O=!0;$a(b.GetVariable(&quot;$version&quot;));return}catch(c){}try{b=new ActiveXObject(&quot;ShockwaveFlash.ShockwaveFlash.6&quot;);O=!0;return}catch(c){}try{b=new ActiveXObject(&quot;ShockwaveFlash.ShockwaveFlash&quot;),O=!0,$a(b.GetVariable(&quot;$version&quot;))}catch(c){}})();var ab=w(&quot;Firefox&quot;),bb=wa()||w(&quot;iPod&quot;),cb=w(&quot;iPad&quot;),db=w(&quot;Android&quot;)&amp;&amp;!(va()||w(&quot;Firefox&quot;)||x()||w(&quot;Silk&quot;)),eb=va(),fb=w(&quot;Safari&quot;)&amp;&amp;!(va()||w(&quot;Coast&quot;)||x()||w(&quot;Edge&quot;)||w(&quot;Silk&quot;)||w(&quot;Android&quot;))&amp;&amp;!(wa()||w(&quot;iPad&quot;)||w(&quot;iPod&quot;));var P=function(a){return(a=a.exec(v))?a[1]:&quot;&quot;};(function(){if(ab)return P(/Firefox\/([0-9.]+)/);if(y||ya||xa)return Ca;if(eb)return P(/Chrome\/([0-9.]+)/);if(fb&amp;&amp;!(wa()||w(&quot;iPad&quot;)||w(&quot;iPod&quot;)))return P(/Version\/([0-9.]+)/);if(bb||cb){var a;if(a=/Version\/(\S+).*Mobile\/(\S+)/.exec(v))return a[1]+&quot;.&quot;+a[2]}else if(db)return(a=P(/Android\s+([0-9.]+)/))?a:P(/Version\/([0-9.]+)/);return&quot;&quot;})();var hb=function(){var a=q.parent&amp;&amp;q.parent!=q,b=a&amp;&amp;0&lt;=&quot;//tpc.googlesyndication.com&quot;.indexOf(q.location.host);if(a&amp;&amp;q.name&amp;&amp;0==q.name.indexOf(&quot;google_ads_iframe&quot;)||b){var c;a=q||q;try{var d;if(a.document&amp;&amp;!a.document.body)d=new r(-1,-1);else{var e=(a||window).document,f=&quot;CSS1Compat&quot;==e.compatMode?e.documentElement:e.body;d=(new r(f.clientWidth,f.clientHeight)).round()}c=d}catch(g){c=new r(-12245933,-12245933)}return gb(c)}c=q.document.getElementsByTagName(&quot;SCRIPT&quot;);return 0&lt;c.length&amp;&amp;(c=c[c.length-1],c.parentElement&amp;&amp;c.parentElement.id&amp;&amp;0&lt;c.parentElement.id.indexOf(&quot;_ad_container&quot;))?gb(void 0,c.parentElement):null},gb=function(a,b){var c=ib(&quot;IMG&quot;,a,b);return c||(c=ib(&quot;IFRAME&quot;,a,b))?c:(c=ib(&quot;OBJECT&quot;,a,b))?c:null},ib=function(a,b,c){var d=document;c=c||d;d=a&amp;&amp;&quot;*&quot;!=a?a.toUpperCase():&quot;&quot;;c=c.querySelectorAll&amp;&amp;c.querySelector&amp;&amp;d?c.querySelectorAll(d+&quot;&quot;):c.getElementsByTagName(d||&quot;*&quot;);for(d=0;d&lt;c.length;d++){var e=c[d];if(&quot;OBJECT&quot;==a)a:{var f=e.getAttribute(&quot;height&quot;);if(null!=f&amp;&amp;0&lt;f&amp;&amp;0==e.clientHeight)for(var f=e.children,g=0;g&lt;f.length;g++){var l=f[g];if(&quot;OBJECT&quot;==l.nodeName||&quot;EMBED&quot;==l.nodeName){e=l;break a}}}f=e.clientHeight;g=e.clientWidth;if(l=b)l=new r(g,f),l=Math.abs(b.width-l.width)&lt;.1*b.width&amp;&amp;Math.abs(b.height-l.height)&lt;.1*b.height;if(l||!b&amp;&amp;10&lt;f&amp;&amp;10&lt;g)return e}return null};var jb,Q=0,R=&quot;&quot;,S=!1,T=!1,U=!1,kb=!0,lb=!1,mb=!1,nb=!1,ob=!1,pb=!1,qb=&quot;&quot;,rb=0,sb=0,W=0,tb=[],K=null,ub=&quot;&quot;,vb=[],wb=null,xb=[],yb=!1,zb=&quot;&quot;,Ab=&quot;&quot;,Bb=(new Date).getTime(),Cb=!1,Db=&quot;&quot;,Eb=!1,Fb=[&quot;1&quot;,&quot;0&quot;,&quot;3&quot;],X=0,Y=0,Gb=0,Hb=&quot;&quot;,Jb=function(a,b,c){S&amp;&amp;(kb||3!=(c||3)||nb)&amp;&amp;Ib(a,b,!0);if(U||T&amp;&amp;mb)Ib(a,b),T=U=!1},Kb=function(){var a=wb;return a?2!=a():!0},Ib=function(a,b,c){(b=b||ub)&amp;&amp;!yb&amp;&amp;(2==Y||c)&amp;&amp;Kb()&amp;&amp;(b=Lb(b,c),lb?Qa(b):E(a,b),pb=!0,c?S=!1:yb=!0)},Lb=function(a,b){var c;c=b?&quot;osdim&quot;:U?&quot;osd2&quot;:&quot;osdtos&quot;;var d=[&quot;//pagead2.googlesyndication.com/activeview&quot;,&quot;?id=&quot;,c];&quot;osd2&quot;==c&amp;&amp;T&amp;&amp;mb&amp;&amp;d.push(&quot;&amp;ts=1&quot;);R&amp;&amp;d.push(&quot;&amp;avi=&quot;,R);jb&amp;&amp;d.push(&quot;&amp;cid=&quot;,jb);d.push(&quot;&amp;ti=1&quot;);d.push(&quot;&amp;&quot;,a);d.push(&quot;&amp;uc=&quot;+Gb);Cb?d.push(&quot;&amp;tgt=&quot;+Db):d.push(&quot;&amp;tgt=nf&quot;);d.push(&quot;&amp;cl=&quot;+(Eb?1:0));&quot;&quot;!=qb&amp;&amp;(d.push(&quot;&amp;lop=1&quot;),c=m()-rb,d.push(&quot;&amp;tslp=&quot;+c));d=d.join(&quot;&quot;);for(c=0;c&lt;vb.length;c++){try{var e=vb[c]()}catch(g){}var f=&quot;max_length&quot;;2&lt;=e.length&amp;&amp;(3==e.length&amp;&amp;(f=e[2]),d=p(d,D(e[0]),D(e[1]),f))}2E3&lt;d.length&amp;&amp;(d=d.substring(0,2E3));return d},Z=function(a,b){if(zb){try{var c=p(zb,&quot;vi&quot;,a);Ga()&amp;&amp;E(C.contentWindow,c)}catch(e){}0&lt;=qa(Fb,a)&amp;&amp;(zb=&quot;&quot;);var c=b||ub,d;d=p(&quot;//pagead2.googlesyndication.com/pagead/gen_204?id=sldb&quot;,&quot;avi&quot;,R);d=p(d,&quot;vi&quot;,a);c&amp;&amp;(d+=&quot;&amp;&quot;+c);try{E(q,d)}catch(e){}}},Mb=function(){Z(&quot;-1&quot;)},Ob=function(a){if(a&amp;&amp;a.data&amp;&amp;k(a.data)){var b;var c=a.data;if(k(c)){b={};for(var c=c.split(&quot;\n&quot;),d=0;d&lt;c.length;d++){var e=c[d].indexOf(&quot;=&quot;);if(!(0&gt;=e)){var f=Number(c[d].substr(0,e)),e=c[d].substr(e+1);switch(f){case 5:case 8:case 11:case 15:case 16:case 18:e=&quot;true&quot;==e;break;case 4:case 7:case 6:case 14:case 20:case 21:case 22:case 23:e=Number(e);break;case 3:case 19:if(&quot;function&quot;==aa(decodeURIComponent))try{e=decodeURIComponent(e)}catch(l){throw Error(&quot;Error: URI malformed: &quot;+e);}break;case 17:e=ra(decodeURIComponent(e).split(&quot;,&quot;),Number)}b[f]=e}}b=b[0]?b:null}else b=null;if(b&amp;&amp;(c=new I(b[4],b[12]),K&amp;&amp;K.match(c))){for(c=0;c&lt;xb.length;c++)xb[c](b);void 0!=b[18]&amp;&amp;(nb=b[18],nb||2!=W||(W=3,Nb()));c=b[0];if(&quot;goog_acknowledge_monitoring&quot;==c)q.clearInterval(Va),X=2;else if(&quot;goog_get_mode&quot;==c){X=1;d={};K&amp;&amp;J(K,d);d[0]=&quot;goog_provide_mode&quot;;d[6]=Y;d[19]=Hb;d[16]=T;try{var g=L(d);a.source.postMessage(g,a.origin)}catch(l){}q.clearInterval(Va);X=2}else&quot;goog_update_data&quot;==c?(ub=b[3],++Gb):&quot;goog_image_request&quot;==c&amp;&amp;(Jb(q,b[3]),b[5]||b[11]||Z(&quot;0&quot;,b[3]));if(&quot;goog_update_data&quot;==c||&quot;goog_image_request&quot;==c)(1==Y||2==Y||S)&amp;&amp;b[5]&amp;&amp;(a=1==b[15]&amp;&amp;&quot;goog_update_data&quot;==c,mb=!0,Z(&quot;1&quot;),Ab&amp;&amp;Kb()&amp;&amp;(g=Ab,Ga()&amp;&amp;E(C.contentWindow,g),Ab=&quot;&quot;),S&amp;&amp;!a&amp;&amp;(Ib(q,void 0,!0),ob=!0,sb=m()),3==W&amp;&amp;(W=4,Nb()),S||1!=Y||(yb=!0)),(1==Y||2==Y||S)&amp;&amp;b[11]&amp;&amp;(T=!1,Z(&quot;3&quot;),S&amp;&amp;(Ib(q,void 0,!0),1==W&amp;&amp;nb&amp;&amp;(W=2)))}}},Nb=function(){var a=q,b=W;0!=b&amp;&amp;1!=b&amp;&amp;Pb(a,&quot;osdim&quot;,&quot;zas=&quot;+b)},Pb=function(a,b,c){b=&quot;//pagead2.googlesyndication.com/pagead/gen_204?id=&quot;+b+&quot;&amp;&quot;;var d=[];d.push(&quot;ovr_value=&quot;+Q);d.push(&quot;avi=&quot;+R);K&amp;&amp;(d=d.concat(Ua()));d.push(&quot;tt=&quot;+((new Date).getTime()-Bb));d.push(c);a.document&amp;&amp;a.document.referrer&amp;&amp;d.push(&quot;ref=&quot;+D(a.document.referrer));b+=d.join(&quot;&amp;&quot;);try{E(a,b)}catch(e){}},Qb=function(){Jb(q);Z(&quot;0&quot;);2&gt;X&amp;&amp;!T&amp;&amp;2==Y&amp;&amp;Pb(q,&quot;osd2&quot;,&quot;hs=&quot;+X)},Rb=function(){var a={};J(K,a);a[0]=&quot;goog_dom_content_loaded&quot;;var b=L(a);try{Ta(function(){Za(b)},10,&quot;osd_listener::ldcl_int&quot;)}catch(c){}},Sb=function(){var a={};J(K,a);a[0]=&quot;goog_creative_loaded&quot;;var b=L(a);Ta(function(){Za(b)},10,&quot;osd_listener::lcel_int&quot;);Eb=!0},Tb=function(a){if(k(a)){a=a.split(&quot;&amp;&quot;);for(var b=a.length-1;0&lt;=b;b--){var c=a[b],d=Ra;c==d.l?(kb=!1,a.splice(b,1)):c==d.h?(W=1,a.splice(b,1)):c==d.j?(T=!1,a.splice(b,1)):c==d.i&amp;&amp;(lb=!0,a.splice(b,1))}Hb=a.join(&quot;&amp;&quot;)}},Ub=function(){if(!Cb){var a=hb();a&amp;&amp;(Cb=!0,Db=a.tagName,a.complete||a.naturalWidth?Sb():H(a,&quot;load&quot;,Sb,&quot;osd_listener::creative_load&quot;))}};n(&quot;osdlfm&quot;,F(&quot;osd_listener::init&quot;,function(a,b,c,d,e,f,g,l,V){Q=a;zb=b;Ab=d;S=f;jb=V;g&amp;&amp;Tb(g);T=f;1==l?tb.push(947190538):2==l?tb.push(947190541):3==l&amp;&amp;tb.push(947190542);K=new I(e,ca());H(q,&quot;load&quot;,Mb,&quot;osd_listener::load&quot;);H(q,&quot;message&quot;,Ob,&quot;osd_listener::message&quot;);R=c||&quot;&quot;;H(q,&quot;unload&quot;,Qb,&quot;osd_listener::unload&quot;);var u=q.document;!u.readyState||&quot;complete&quot;!=u.readyState&amp;&amp;&quot;loaded&quot;!=u.readyState?(&quot;msie&quot;in Ha?Ha.msie:Ha.msie=-1!=navigator.userAgent.toLowerCase().indexOf(&quot;msie&quot;))&amp;&amp;!window.opera?H(u,&quot;readystatechange&quot;,function(){&quot;complete&quot;!=u.readyState&amp;&amp;&quot;loaded&quot;!=u.readyState||Rb()},&quot;osd_listener::rsc&quot;):H(u,&quot;DOMContentLoaded&quot;,Rb,&quot;osd_listener::dcl&quot;):Rb();-1==Q?Y=f?3:1:-2==Q?Y=3:0&lt;Q&amp;&amp;(Y=2,U=!0);T&amp;&amp;!U&amp;&amp;-1==Q&amp;&amp;(Y=2);K&amp;&amp;(K.b||K.a)&amp;&amp;(X=1,Va=q.setInterval(t(&quot;osd_proto::reqm_int&quot;,ba(Ya,Y,K,T,tb,Hb)),500));Ta(Ub,5,&quot;osd_listener:sfc&quot;)}));n(&quot;osdlac&quot;,F(&quot;osd_listener::lac_ex&quot;,function(a){vb.push(a)}));n(&quot;osdlamrc&quot;,F(&quot;osd_listener::lamrc_ex&quot;,function(a){xb.push(a)}));n(&quot;osdsir&quot;,t(&quot;osd_listener::sir_ex&quot;,Jb));n(&quot;osdacrc&quot;,F(&quot;osd_listener::acrc_ex&quot;,function(a){wb=a}));n(&quot;osdpcls&quot;,F(&quot;osd_listener::acrc_ex&quot;,function(a){if(&quot;&quot;==a||q==q.top||yb||pb&amp;&amp;!ob)return!1;qb=a;if(ob){var b=R;R=a;var c=Lb(ub,!0);R=b;b=m()-sb;c=Ka(c,&quot;tsvp&quot;,b);b=q;lb?Qa(c):E(b,c)}R=&quot;&quot;==R?a:R+&quot;,&quot;+a;rb=m();return!0}));}).call(this);osdlfm(-1,&#39;&#39;,&#39;Bu3Zk_QiJVuz1ONSF9gWm05fwCwCx9a7roQEAABABOAHIAQHgAgDIA5sE4AQB&#39;,&#39;&#39;,3059382826,true,&#39;ud\x3d1\x26la\x3d0\x26&#39;,3,&#39;5Ghk5rrgC0ZQQslGsGJmsHA13Co&#39;);&lt;/script&gt;&lt;style&gt;.feedback_container {width: 100%;height: 100%;position: absolute;top:0;left:0;display: none;z-index: 9020;background-color: white;}.feedback_page {font-family: &quot;Arial&quot;;font-size: 13px;margin: 9px 12px 9px 12px;}.feedback_title {font-weight: bold;color: #000000;}.feedback_page a {font-weight: normal;color: #3366cc;}.feedback_description {color: #666666;line-height: 16px;margin: 2px 0 2px 0;}.feedback_closing {color: #0367ff;line-height: 16px;margin: 2px 0 2px 0;}.feedback_logo {position: absolute;right: 0;bottom: 0;margin: 0 12px 9px 0;}.feedback_logo img {height: 15px;}.survey_description {color: #666666;line-height: 17px;margin: 10px 0 2px 0;}.survey {color: #666666;line-height: 20px;}.survey_option {float: left;margin: 0 15px 0 0;}.survey_option input {margin: 0;vertical-align: middle;}.survey_option_text {margin: 0 0 0 5px;line-height: 17px;vertical-align: bottom;}.survey_option:hover {background-color: lightblue;cursor: default;}&lt;/style&gt;&lt;div id=&quot;cbtf&quot; class=&quot;feedback_container&quot;&gt;&lt;div class=&quot;feedback_page&quot;&gt;&lt;div id=&quot;mtadmas&quot;&gt;&lt;div class=&quot;feedback_title&quot;&gt;该广告已关闭。 &lt;a id=&quot;mtadmaundo&quot; href=&quot;javascript:void(0)&quot;&gt;撤消&lt;/a&gt;&lt;/div&gt;&lt;div class=&quot;survey_description&quot;&gt;此广告有什么问题？&lt;/div&gt;&lt;div class=&quot;survey&quot; id=&quot;survey_0&quot;&gt;&lt;label&gt;&lt;div class=&quot;survey_option&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;surveyOptions&quot; value=&quot;7&quot;&gt;&lt;span class=&quot;survey_option_text&quot;&gt;不相关&lt;/span&gt;&lt;/div&gt;&lt;/label&gt;&lt;label&gt;&lt;div class=&quot;survey_option&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;surveyOptions&quot; value=&quot;2&quot;&gt;&lt;span class=&quot;survey_option_text&quot;&gt;重复显示&lt;/span&gt;&lt;/div&gt;&lt;/label&gt;&lt;label&gt;&lt;div class=&quot;survey_option&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;surveyOptions&quot; value=&quot;8&quot;&gt;&lt;span class=&quot;survey_option_text&quot;&gt;内容不当&lt;/span&gt;&lt;/div&gt;&lt;/label&gt;&lt;/div&gt;&lt;/div&gt;&lt;div id=&quot;mtadmac&quot; style=&quot;display:none&quot;&gt;&lt;div class=&quot;feedback_title&quot;&gt;感谢您的反馈！ &lt;a id=&quot;mtadmback&quot; href=&quot;javascript:void(0)&quot;&gt;返回&lt;/a&gt;&lt;/div&gt;&lt;div class=&quot;feedback_description&quot;&gt;我们将对此广告进行审核，以便改善您在今后的体验。&lt;/div&gt;&lt;div class=&quot;feedback_description&quot;&gt;建议您更新&lt;a href=&quot;https://www.google.com/settings/ads/anonymous&quot; target=&quot;_blank&quot;&gt;广告设置&lt;/a&gt;，以便我们为您展示更合适的广告。&lt;/div&gt;&lt;div id=&quot;ad-feedback-closing&quot; style=&quot;display:none&quot; class=&quot;feedback_closing&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;div id=&quot;mtadmpc&quot; style=&quot;display:none&quot;&gt;&lt;div class=&quot;feedback_title&quot;&gt;感谢您的反馈！ &lt;a id=&quot;mtadmpundo&quot; href=&quot;javascript:void(0)&quot;&gt;撤消&lt;/a&gt;&lt;/div&gt;&lt;div class=&quot;feedback_description&quot;&gt;我们会根据您的反馈审核此网站上的广告。&lt;/div&gt;&lt;div class=&quot;feedback_description&quot;&gt;建议您更新&lt;a href=&quot;https://www.google.com/settings/ads/anonymous&quot; target=&quot;_blank&quot;&gt;广告设置&lt;/a&gt;，以便我们为您展示更合适的广告。&lt;/div&gt;&lt;div id=&quot;pub-feedback-closing&quot; style=&quot;display:none&quot; class=&quot;feedback_closing&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;span id=&quot;feedback-closing-template&quot; style=&quot;display:none&quot;&gt;即将关闭广告：%1$d 秒&lt;/span&gt;&lt;div class=&quot;feedback_logo&quot;&gt;&lt;img src=&quot;//www.gstatic.com/images/branding/googlelogo/1x/googlelogo_color_112x36dp.png&quot;/&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;script&gt;(function(){var g=this,k=function(a,b){var c=a.split(&quot;.&quot;),d=g;c[0]in d||!d.execScript||d.execScript(&quot;var &quot;+c[0]);for(var e;c.length&amp;&amp;(e=c.shift());)c.length||void 0===b?d=d[e]?d[e]:d[e]={}:d[e]=b},aa=function(a){var b=typeof a;if(&quot;object&quot;==b)if(a){if(a instanceof Array)return&quot;array&quot;;if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if(&quot;[object Window]&quot;==c)return&quot;object&quot;;if(&quot;[object Array]&quot;==c||&quot;number&quot;==typeof a.length&amp;&amp;&quot;undefined&quot;!=typeof a.splice&amp;&amp;&quot;undefined&quot;!=typeof a.propertyIsEnumerable&amp;&amp;!a.propertyIsEnumerable(&quot;splice&quot;))return&quot;array&quot;;if(&quot;[object Function]&quot;==c||&quot;undefined&quot;!=typeof a.call&amp;&amp;&quot;undefined&quot;!=typeof a.propertyIsEnumerable&amp;&amp;!a.propertyIsEnumerable(&quot;call&quot;))return&quot;function&quot;}else return&quot;null&quot;;else if(&quot;function&quot;==b&amp;&amp;&quot;undefined&quot;==typeof a.call)return&quot;object&quot;;return b},ba=function(a,b,c){return a.call.apply(a.bind,arguments)},ca=function(a,b,c){if(!a)throw Error();if(2&lt;arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}},l=function(a,b,c){l=Function.prototype.bind&amp;&amp;-1!=Function.prototype.bind.toString().indexOf(&quot;native code&quot;)?ba:ca;return l.apply(null,arguments)};var n=function(a,b){var c=parseInt(a,10);return isNaN(c)?b:c};var p;var u=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},v=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var da=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0&gt;c?Math.max(0,a.length+c):c;if(&quot;string&quot;==typeof a)return&quot;string&quot;==typeof b&amp;&amp;1==b.length?a.indexOf(b,c):-1;for(;c&lt;a.length;c++)if(c in a&amp;&amp;a[c]===b)return c;return-1};var w=function(a){w[&quot; &quot;](a);return a};w[&quot; &quot;]=function(){};var x;a:{var y=g.navigator;if(y){var z=y.userAgent;if(z){x=z;break a}}x=&quot;&quot;};var ea=-1!=x.indexOf(&quot;Opera&quot;)||-1!=x.indexOf(&quot;OPR&quot;),A=-1!=x.indexOf(&quot;Trident&quot;)||-1!=x.indexOf(&quot;MSIE&quot;),fa=-1!=x.indexOf(&quot;Edge&quot;),B=-1!=x.indexOf(&quot;Gecko&quot;)&amp;&amp;!(-1!=x.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;-1==x.indexOf(&quot;Edge&quot;))&amp;&amp;!(-1!=x.indexOf(&quot;Trident&quot;)||-1!=x.indexOf(&quot;MSIE&quot;))&amp;&amp;-1==x.indexOf(&quot;Edge&quot;),ga=-1!=x.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;-1==x.indexOf(&quot;Edge&quot;),ha=function(){var a=x;if(B)return/rv\:([^\);]+)(\)|;)/.exec(a);if(fa)return/Edge\/([\d\.]+)/.exec(a);if(A)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(ga)return/WebKit\/(\S+)/.exec(a)},C=function(){var a=g.document;return a?a.documentMode:void 0},D=function(){if(ea&amp;&amp;g.opera){var a;var b=g.opera.version;try{a=b()}catch(c){a=b}return a}a=&quot;&quot;;(b=ha())&amp;&amp;(a=b?b[1]:&quot;&quot;);return A&amp;&amp;(b=C(),b&gt;parseFloat(a))?String(b):a}(),E={},F=function(a){var b;if(!(b=E[a])){b=0;for(var c=u(String(D)).split(&quot;.&quot;),d=u(String(a)).split(&quot;.&quot;),e=Math.max(c.length,d.length),f=0;0==b&amp;&amp;f&lt;e;f++){var h=c[f]||&quot;&quot;,m=d[f]||&quot;&quot;,r=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),ma=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var q=r.exec(h)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],t=ma.exec(m)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==q[0].length&amp;&amp;0==t[0].length)break;b=v(0==q[1].length?0:parseInt(q[1],10),0==t[1].length?0:parseInt(t[1],10))||v(0==q[2].length,0==t[2].length)||v(q[2],t[2])}while(0==b)}b=E[a]=0&lt;=b}return b},G=g.document,ia=G&amp;&amp;A?C()||(&quot;CSS1Compat&quot;==G.compatMode?parseInt(D,10):5):void 0;var H;if(!(H=!B&amp;&amp;!A)){var I;if(I=A)I=9&lt;=ia;H=I}H||B&amp;&amp;F(&quot;1.9.1&quot;);var J=A&amp;&amp;!F(&quot;9&quot;);var K=function(a){var b=document;return&quot;string&quot;==typeof a?b.getElementById(a):a},L=function(a,b){var c=b||document;return c.querySelectorAll&amp;&amp;c.querySelector?c.querySelectorAll(&quot;.&quot;+a):ka(a,b)},ka=function(a,b){var c,d,e,f;c=document;c=b||c;if(c.querySelectorAll&amp;&amp;c.querySelector&amp;&amp;a)return c.querySelectorAll(&quot;&quot;+(a?&quot;.&quot;+a:&quot;&quot;));if(a&amp;&amp;c.getElementsByClassName){var h=c.getElementsByClassName(a);return h}h=c.getElementsByTagName(&quot;*&quot;);if(a){f={};for(d=e=0;c=h[d];d++){var m=c.className,r;if(r=&quot;function&quot;==typeof m.split)r=0&lt;=da(m.split(/\s+/),a);r&amp;&amp;(f[e++]=c)}f.length=e;return f}return h},la={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1},M={IMG:&quot; &quot;,BR:&quot;\n&quot;},na=function(){var a=document.getElementById(&quot;feedback-closing-template&quot;);if(J&amp;&amp;&quot;innerText&quot;in a)a=a.innerText.replace(/(\r\n|\r|\n)/g,&quot;\n&quot;);else{var b=[];N(a,b,!0);a=b.join(&quot;&quot;)}a=a.replace(/ \xAD /g,&quot; &quot;).replace(/\xAD/g,&quot;&quot;);a=a.replace(/\u200B/g,&quot;&quot;);J||(a=a.replace(/ +/g,&quot; &quot;));&quot; &quot;!=a&amp;&amp;(a=a.replace(/^\s*/,&quot;&quot;));return a},N=function(a,b,c){if(!(a.nodeName in la))if(3==a.nodeType)c?b.push(String(a.nodeValue).replace(/(\r\n|\r|\n)/g,&quot;&quot;)):b.push(a.nodeValue);else if(a.nodeName in M)b.push(M[a.nodeName]);else for(a=a.firstChild;a;)N(a,b,c),a=a.nextSibling},O=function(a){this.w=a||g.document||document},oa=function(a,b){return L(&quot;feedback_description&quot;,b||a.w)};O.prototype.createElement=function(a){return this.w.createElement(a)};O.prototype.createTextNode=function(a){return this.w.createTextNode(String(a))};O.prototype.appendChild=function(a,b){a.appendChild(b)};var P=function(a){var b=window;return b.getComputedStyle?b.getComputedStyle(a,null):a.currentStyle};var Q=function(a,b){a.addEventListener?a.addEventListener(&quot;click&quot;,b,!1):a.attachEvent&amp;&amp;a.attachEvent(&quot;onclick&quot;,b)};var R=function(a){var b=window;b.google_image_requests||(b.google_image_requests=[]);var c=b.document.createElement(&quot;img&quot;);c.src=a;b.google_image_requests.push(c)};var pa=function(a){var b={};if(a&amp;&amp;a.key_value){a=a.key_value;for(var c=0;c&lt;a.length;c++){var d=a[c];if(&quot;key&quot;in d&amp;&amp;&quot;value&quot;in d){var e=d.value;b[d.key]=null==e?null:String(e)}}}return b};var qa=function(a){a=String(a);if(/^\s*$/.test(a)?0:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\[&quot;\\\/bfnrtu]/g,&quot;@&quot;).replace(/(?:&quot;[^&quot;\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*&quot;|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)[\s\u2028\u2029]*(?=:|,|]|}|$)/g,&quot;]&quot;).replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,&quot;&quot;)))try{return eval(&quot;(&quot;+a+&quot;)&quot;)}catch(b){}throw Error(&quot;Invalid JSON string: &quot;+a);},T=function(a){var b=[];S(new ra,a,b);return b.join(&quot;&quot;)},ra=function(){this.o=void 0},S=function(a,b,c){if(null==b)c.push(&quot;null&quot;);else{if(&quot;object&quot;==typeof b){if(&quot;array&quot;==aa(b)){var d=b;b=d.length;c.push(&quot;[&quot;);for(var e=&quot;&quot;,f=0;f&lt;b;f++)c.push(e),e=d[f],S(a,a.o?a.o.call(d,String(f),e):e,c),e=&quot;,&quot;;c.push(&quot;]&quot;);return}if(b instanceof String||b instanceof Number||b instanceof Boolean)b=b.valueOf();else{c.push(&quot;{&quot;);f=&quot;&quot;;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&amp;&amp;(e=b[d],&quot;function&quot;!=typeof e&amp;&amp;(c.push(f),U(d,c),c.push(&quot;:&quot;),S(a,a.o?a.o.call(b,d,e):e,c),f=&quot;,&quot;));c.push(&quot;}&quot;);return}}switch(typeof b){case &quot;string&quot;:U(b,c);break;case &quot;number&quot;:c.push(isFinite(b)&amp;&amp;!isNaN(b)?String(b):&quot;null&quot;);break;case &quot;boolean&quot;:c.push(String(b));break;case &quot;function&quot;:c.push(&quot;null&quot;);break;default:throw Error(&quot;Unknown type: &quot;+typeof b);}}},sa={&#39;&quot;&#39;:&#39;\\&quot;&#39;,&quot;\\&quot;:&quot;\\\\&quot;,&quot;/&quot;:&quot;\\/&quot;,&quot;\b&quot;:&quot;\\b&quot;,&quot;\f&quot;:&quot;\\f&quot;,&quot;\n&quot;:&quot;\\n&quot;,&quot;\r&quot;:&quot;\\r&quot;,&quot;\t&quot;:&quot;\\t&quot;,&quot;\x0B&quot;:&quot;\\u000b&quot;},ta=/\uffff/.test(&quot;\uffff&quot;)?/[\\\&quot;\x00-\x1f\x7f-\uffff]/g:/[\\\&quot;\x00-\x1f\x7f-\xff]/g,U=function(a,b){b.push(&#39;&quot;&#39;,a.replace(ta,function(a){var b=sa[a];b||(b=&quot;\\u&quot;+(a.charCodeAt(0)|65536).toString(16).substr(1),sa[a]=b);return b}),&#39;&quot;&#39;)};var ua=function(){var a=document.body,b=a&amp;&amp;a.ownerDocument,c=b&amp;&amp;(b.defaultView||b.parentWindow),d;if(d=c){var e;d=c.top;try{var f;if(f=!!d&amp;&amp;null!=d.location.href)b:{try{w(d.foo);f=!0;break b}catch(m){}f=!1}e=f}catch(m){e=!1}d=e?c.top:null}c=d;this.O=!!c;this.h=null;try{this.h=a&amp;&amp;a.getBoundingClientRect()}catch(m){}e=a;f=0;for(d=this.h;e;)try{d&amp;&amp;(f+=d.top);var h=e.ownerDocument;e=(h.defaultView||h.parentWindow).frameElement;d=e.getBoundingClientRect()}catch(m){break}this.P=f;c=c||g;this.$=(&quot;CSS1Compat&quot;==c.document.compatMode?c.document.documentElement:c.document.body).clientHeight;b=b&amp;&amp;({visible:1,hidden:2,prerender:3,preview:4}[b.webkitVisibilityState||b.mozVisibilityState||b.visibilityState||&quot;&quot;]||0);this.aa=!!a&amp;&amp;!(2==b||3==b)&amp;&amp;!(this.h.top&gt;=this.h.bottom&amp;&amp;this.h.left&gt;=this.h.right)},va=function(){var a=new ua;return a.O&amp;&amp;(!a.aa||a.P&gt;=a.$)};var V=function(a,b,c,d){this.G=a;this.R=b;this.T=c;this.m=0;this.l=document.getElementById(&quot;mtadmas&quot;);this.M=document.getElementById(&quot;mtadmaundo&quot;);this.C=document.getElementById(&quot;mtadmac&quot;);this.D=document.getElementById(&quot;mtadmback&quot;);this.J=document.getElementById(&quot;mtadmpc&quot;);this.N=document.getElementById(&quot;mtadmpundo&quot;);this.A=document.getElementById(&quot;mtadmpunclose&quot;);this.L=this.u=this.H=this.F=null;this.v=0;this.i=null;this.j=!1;this.s=null;this.W=d?d.getAdsLength():1;(this.g=d)&amp;&amp;this.g.registerWidget(this,0);this.I=0},wa=function(a){for(var b=document.getElementsByName(&quot;surveyOptions&quot;),c=0;c&lt;b.length;c++)Q(b[c],l(a.X,a,b[c].value));a.M&amp;&amp;Q(a.M,l(a.B,a,&quot;1&quot;));a.N&amp;&amp;Q(a.N,l(a.B,a,&quot;3&quot;));a.A&amp;&amp;Q(a.A,l(a.Y,a));a.D&amp;&amp;Q(a.D,l(a.back,a));a.g&amp;&amp;(a.g.listenOnObject(&quot;mute_option_selected&quot;,l(a.K,a)),a.g.forEachAd(l(function(a){a.listenOnObject(&quot;multislot_mute_collapse&quot;,l(this.V,this));a.listenOnObject(&quot;multislot_mute_collapse_undo&quot;,l(this.U,this))},a)))};V.prototype.K=function(a){this.F=a.close_button_token;this.H=a.creative_conversion_url;this.u=a.ablation_config;this.L=a.undo_callback;this.v=a.creative_index||0;this.g&amp;&amp;(this.s=this.g.getAd(this.v));if(1===a.type){a=L(&quot;survey&quot;);for(var b=&quot;survey_&quot;+this.v,c=0;c&lt;a.length;c++)a[c].style.display=a[c].id==b?&quot;block&quot;:&quot;none&quot;;a=document.getElementsByName(&quot;surveyOptions&quot;);for(b=0;b&lt;a.length;b++)a[b].checked=!1;this.l.style.display=&quot;block&quot;;W(this);X(this)}else 0===a.type&amp;&amp;(this.J.style.display=&quot;block&quot;,this.l.style.display=&quot;none&quot;,W(this),xa(this,document.getElementById(&quot;pub-feedback-closing&quot;),this.u))};var Y=function(a){a.i&amp;&amp;(window.clearInterval(a.i),a.i=null,a.j=!1);K(&quot;pub-feedback-closing&quot;).style.display=&quot;none&quot;;K(&quot;ad-feedback-closing&quot;).style.display=&quot;none&quot;};V.prototype.B=function(a){this.j||(Y(this),R(Z(this,&quot;user_feedback_undo&quot;,a)),this.L())};V.prototype.Y=function(){var a={msg_type:&quot;resize-me&quot;};a.key_value=[{key:&quot;r_nh&quot;,value:String(this.I)},{key:&quot;r_str&quot;,value:&quot;animate&quot;}];a=T(a);window.top.postMessage(a,&quot;*&quot;);this.j=!1;this.B(&quot;3&quot;)};V.prototype.back=function(){this.j||(Y(this),this.l.style.display=&quot;block&quot;,W(this),X(this))};V.prototype.X=function(a){this.C.style.display=&quot;block&quot;;this.l.style.display=&quot;none&quot;;X(this);R(Z(this,&quot;mute_survey_option&quot;,a));a=document.getElementById(&quot;ad-feedback-closing&quot;);this.m&lt;this.W-1&amp;&amp;this.g&amp;&amp;this.R?ya(this,a):xa(this,a,this.u)};var Z=function(a,b,c){return a.H+&quot;&amp;label=&quot;+b+&quot;&amp;cbt=&quot;+a.F+&quot;&amp;label_instance=&quot;+c},W=function(a){a.C.style.display=&quot;none&quot;},X=function(a){a.J.style.display=&quot;none&quot;},za=function(a,b,c,d,e,f){var h=c+d;if(!(0&gt;e||e&gt;h||a.i)){var m=na();c=l(function(){var a=&quot;&quot;;h&lt;=d&amp;&amp;0&lt;h&amp;&amp;(a=m.replace(&quot;%1$d&quot;,String(h)));b.style.display=a?&quot;inline&quot;:&quot;none&quot;;if(&quot;textContent&quot;in b)b.textContent=a;else if(3==b.nodeType)b.data=a;else if(b.firstChild&amp;&amp;3==b.firstChild.nodeType){for(;b.lastChild!=b.firstChild;)b.removeChild(b.lastChild);b.firstChild.data=a}else{for(var c;c=b.firstChild;)b.removeChild(c);b.appendChild((9==b.nodeType?b:b.ownerDocument||b.document).createTextNode(String(a)))}if(h==e)try{this.j=!0,f()}catch(q){}0&gt;=h&amp;&amp;Y(this);h--},a);c();0&lt;=h&amp;&amp;(a.i=window.setInterval(c,1E3))}},xa=function(a,b,c){if(c&amp;&amp;window.top&amp;&amp;window.top.postMessage){var d=qa(c),e=pa(d),f=&quot;resize-me&quot;==d.msg_type&amp;&amp;&quot;animate&quot;==e.r_str;if(&quot;ablate-me&quot;==d.msg_type&amp;&amp;e[&quot;collapse-after-close&quot;]||f&amp;&amp;!va())a.A&amp;&amp;(a.I=window.innerHeight,f=document.getElementById(&quot;cbtf&quot;),f=oa(p||(p=new O),f)[1],f=Aa(a.S,f),c=Ba(d,f)),za(a,b,n(e[&quot;secs-to-countdown&quot;],1),n(e.countdown,0),n(e[&quot;message-tick&quot;],1),function(){window.top.postMessage(c,&quot;*&quot;)})}},Ba=function(a,b){if(!isNaN(b)&amp;&amp;isFinite(b)){var c=!1;if(a.key_value){for(var d=a.key_value,e=0;e&lt;d.length;e++){var f=d[e];if(&quot;key&quot;in f&amp;&amp;&quot;value&quot;in f&amp;&amp;&quot;r_nh&quot;==f.key){c=!0;f.value=b.toString();break}}c||d.push({key:&quot;r_nh&quot;,value:b.toString()})}}return T(a)};V.prototype.S=function(a){var b=P(a);a=P(a.parentNode.parentNode);return parseInt(b.height,10)+parseInt(b.marginTop,10)+parseInt(a.marginTop,10)};var Aa=function(a,b){for(var c=[],d=b;d&amp;&amp;&quot;BODY&quot;!=d.tagName;d=d.parentNode)d.style&amp;&amp;&quot;block&quot;!=d.style.display&amp;&amp;(c.push({el:d,val:d.style.display}),d.style.display=&quot;block&quot;);for(var d=a(b),e;e=c.pop();)void 0!==e.Z&amp;&amp;(e.ba.style.display=e.Z);return d},ya=function(a,b){za(a,b,1,a.T,0,l(function(){var a={creative_index:this.s.getIndex(),undo_pingback_url:Z(this,&quot;user_feedback_undo&quot;,&quot;1&quot;)};this.s.fireOnObject(&quot;multislot_mute_collapse&quot;,a)},a))};V.prototype.V=function(){this.m++;this.g.resetAll()};V.prototype.U=function(){0&lt;this.m&amp;&amp;this.m--};V.prototype.show=function(){this.G.style.display=&quot;block&quot;};V.prototype.hide=function(){this.G.style.display=&quot;none&quot;};V.prototype.reset=function(){this.hide()};V.prototype.show=V.prototype.show;V.prototype.hide=V.prototype.hide;V.prototype.reset=V.prototype.reset;V.prototype.setupSurveyPage=V.prototype.K;k(&quot;cmtads&quot;,function(a,b){var c=null,d=document.getElementById(&quot;cbtf&quot;);d&amp;&amp;(c=new V(d,!!a,b||0,window.adSlot),wa(c));c&amp;&amp;k(&quot;muteSurvey&quot;,c);return c});}).call(this);cmtads(true,0);&lt;/script&gt;&lt;script&gt;adSlot.finalize(&#39;ads&#39;);registerAdLocationExtensionRedirectPing(adSlot);&lt;/script&gt;   &lt;/body&gt;&lt;/html&gt;{&quot;uid&quot;:1,&quot;hostPeerName&quot;:&quot;http://www.iteye.com&quot;,&quot;initialGeometry&quot;:&quot;{\&quot;windowCoords_t\&quot;:8,\&quot;windowCoords_r\&quot;:1342,\&quot;windowCoords_b\&quot;:705,\&quot;windowCoords_l\&quot;:8,\&quot;frameCoords_t\&quot;:27,\&quot;frameCoords_r\&quot;:1149.5,\&quot;frameCoords_b\&quot;:117,\&quot;frameCoords_l\&quot;:421.5,\&quot;styleZIndex\&quot;:\&quot;auto\&quot;,\&quot;allowedExpansion_t\&quot;:27,\&quot;allowedExpansion_r\&quot;:199.5,\&quot;allowedExpansion_b\&quot;:462,\&quot;allowedExpansion_l\&quot;:421.5,\&quot;xInView\&quot;:1,\&quot;yInView\&quot;:1}&quot;,&quot;permissions&quot;:&quot;{\&quot;expandByOverlay\&quot;:false,\&quot;expandByPush\&quot;:false,\&quot;readCookie\&quot;:false,\&quot;writeCookie\&quot;:false}&quot;,&quot;metadata&quot;:&quot;{\&quot;shared\&quot;:{\&quot;sf_ver\&quot;:\&quot;1-0-2\&quot;,\&quot;ck_on\&quot;:1,\&quot;flash_ver\&quot;:\&quot;18.0.0\&quot;}}&quot;,&quot;reportCreativeGeometry&quot;:false}" scrolling="no" marginwidth="0" marginheight="0" width="728" height="90" data-is-safeframe="true" style="border: 0px; vertical-align: bottom;"></iframe></div><iframe id="google_ads_iframe_/8456/IDG.CN_B2B_iteye.com_0__hidden__" name="google_ads_iframe_/8456/IDG.CN_B2B_iteye.com_0__hidden__" width="0" height="0" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:"<html><body style='background:transparent'></body></html>"" style="border: 0px; vertical-align: bottom; visibility: hidden; display: none;"></iframe></div><script type="text/javascript" data-belong="allyes" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/delay.min.js"></script><script type="text/javascript" data-belong="allyes" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/delay.min.js"></script><script type="text/javascript" data-belong="allyes" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/delay.min.js"></script><script type="text/javascript" data-belong="allyes" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/delay.min.js"></script><script type="text/javascript" data-belong="allyes" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/delay.min.js"></script></div></div>
        </div>
      </div>

      <div id="content" class="clearfix">
        <div id="main">
          



          

<div class="h-entry" style="display:none">
  <a href="http://lujh99.iteye.com/" class="p-author" target="_blank">lujh99</a>
</div>


<div class="clearfix">
  <div class="crumbs">
    <a href="http://www.iteye.com/forums">论坛首页</a> <span class="arrow">→</span>
    <a href="http://www.iteye.com/forums/board/Java">Java企业应用论坛</a> <span class="arrow">→</span>
    <h1>正确理解ThreadLocal</h1>
  </div>
</div>


  <div id="forum_tag_list">
    <a href="http://www.iteye.com/forums/board/Java">全部</a>
          <a href="http://www.iteye.com/forums/tag/Hibernate">Hibernate</a>
          <a href="http://www.iteye.com/forums/tag/Spring">Spring</a>
          <a href="http://www.iteye.com/forums/tag/Struts">Struts</a>
          <a href="http://www.iteye.com/forums/tag/iBATIS">iBATIS</a>
          <a href="http://www.iteye.com/forums/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8">企业应用</a>
          <a href="http://www.iteye.com/forums/tag/Lucene">Lucene</a>
          <a href="http://www.iteye.com/forums/tag/SOA">SOA</a>
              <a href="http://www.iteye.com/forums/tag/Java%E7%BB%BC%E5%90%88">Java综合</a>
          <a href="http://www.iteye.com/forums/tag/Tomcat">Tomcat</a>
          <a href="http://www.iteye.com/forums/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">设计模式</a>
          <a href="http://www.iteye.com/forums/tag/OO">OO</a>
          <a href="http://www.iteye.com/forums/tag/JBoss">JBoss</a>
      </div>


<div class="actions">
  <div class="buttons"></div>
  <div class="wrapper">
    <div id="forum_recommended_f4"></div>
    <div class="pagination"><span class="disabled prev_page">« 上一页</span> <span class="current">1</span> <a href="http://www.iteye.com/topic/103804?page=2" rel="next">2</a> <a href="http://www.iteye.com/topic/103804?page=2" class="next_page" rel="next">下一页 »</a></div>
    <div class="info">浏览 224780 次</div>
  </div>
</div>



<table id="forum_main" cellspacing="1">
  <thead>
    <tr>
      <th colspan="2" class="topic_title">
        <div class="wrapper"><span class="locked">锁定老帖子</span> <a href="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/正确理解ThreadLocal - 设计模式 - Java - ITeye论坛.htm">主题：正确理解ThreadLocal</a></div>
        <div id="topic_rate_box"><strong class="highlight">该帖已经被评为良好帖</strong></div>
      </th>
    </tr>
    <tr>
      <td class="first_col">作者</td>
      <td class="last_col">正文
      
      </td>
    </tr>
  </thead>
  <tbody id="posts">
    <tr id="338877">
  <td class="postauthor">
    <ul>
      <li class="name">lujh99</li>
      <li>等级: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/star2.gif" alt="二星会员" title="二星会员"></li>
      <li><a href="http://lujh99.iteye.com/" target="_blank"><img alt="lujh99的博客" class="logo" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/user-logo.gif" title="lujh99的博客: lujh99" width=""></a></li>
            <li>文章: 74</li>
      <li>积分: 165</li>
      <li>来自: ...</li>
      <li><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/offline.gif"></li>
    </ul>
  </td>
  <td class="postcontent">
    <div class="postactions">
      <div class="description">
        &nbsp;&nbsp;
        发表时间：2007-07-21&nbsp;&nbsp;
        
      </div>
      <div class="links">
        
        
          
          
        
      </div>
    </div>
    <div class="postbody clearfix">
      
        
              <script type="text/javascript">
      var hunters = ["\u003Ca href='/jobs/2509' target='_blank' style='color:#000;'\u003E\u003Cspan style='font-weight:bold;'\u003E\u4e0a\u6d77: \u003C/span\u003E Junior Product Manager\u003C/a\u003E","\u003Ca href='/jobs/2508' target='_blank' style='color:#000;'\u003E\u003Cspan style='font-weight:bold;'\u003E\u4e0a\u6d77: \u003C/span\u003E Senior Software Engineer\u003C/a\u003E"]
      var hunter_id = Math.ceil(Math.random() * hunters.length) - 1;
      if(hunter_id == -1) hunter_id = 0;
    </script>
    <div id="hunter_recommended" style="background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); padding: 4px; margin-bottom: 10px; float: left; width: 557px; background-position: initial initial; background-repeat: initial initial;">
      <span id="hunters_nav" style="margin-right:5px;">
        <a href="http://www.iteye.com/topic/103804#" onclick="hunter_id &lt;= 0 ? hunter_id = hunters.length - 1 : hunter_id--; $(&#39;hunters&#39;).update(hunters[hunter_id]);return false;" style="border:1px solid #ccc;padding: 0 3px;size: 13px;text-decoration: none;">&lt;</a>
        <a href="http://www.iteye.com/topic/103804#" onclick="hunter_id &gt;= hunters.length - 1 ? hunter_id = 0 : hunter_id++; $(&#39;hunters&#39;).update(hunters[hunter_id]);return false;" style="border:1px solid #ccc;padding: 0 3px;size :13px;text-decoration: none;">&gt;</a>
      </span>
      猎头职位: <span id="hunters"><a href="http://www.iteye.com/jobs/2508" target="_blank" style="color:#000;"><span style="font-weight:bold;">上海: </span> Senior Software Engineer</a></span>
      <script type="text/javascript">$('hunters').update(hunters[hunter_id]);</script>
    </div>

        
      
                                            <div id="related_topics" style="position: relative;">相关文章: <span class="close"><a href="http://www.iteye.com/topic/103804#" onclick="$(&#39;related_topics&#39;).hide();if($(&#39;hunter_recommended&#39;)){$(&#39;hunter_recommended&#39;).style.width=&#39;780px&#39;};if($(&#39;topic_tags&#39;)){$(&#39;topic_tags&#39;).style.width=&#39;790px&#39;};return false;" title="关闭">&nbsp;</a></span>
              <ul>
                                  <li><a href="http://www.iteye.com/topic/777716" title="ThreadLocal-分析-总结" target="_blank">ThreadLocal-分析-总结</a></li>
                                  <li><a href="http://www.iteye.com/topic/757478" title="深入浅出ThreadLocal" target="_blank">深入浅出ThreadLocal</a></li>
                                  <li><a href="http://www.iteye.com/topic/82984" title="ThreadLocal and synchronized 补充" target="_blank">ThreadLocal and synchronized 补充</a></li>
                              </ul>
              <br><span>推荐群组: <a href="http://hibernate.group.iteye.com/" target="_blank">Hibernate</a></span>
              <br><a href="http://www.iteye.com/wiki/topic/103804" target="_blank">更多相关推荐</a>
            </div>
            <script type="text/javascript">
              document.observe("dom:loaded", function() {
                if($('hunter_recommended')) {
                  $('hunter_recommended').setStyle({cssFloat: 'left', width: '557px'})
                }
                if($('topic_tags')) {
                  $('topic_tags').setStyle({width: '567px'})
                }
                new Draggable("related_topics");
              });
            </script>
                          
          <div id="topic_tags" class="news_tag" style="width: 567px;">
                          <a href="http://www.iteye.com/forums/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">设计模式</a>
                      </div>
        
      
      <strong>首先，ThreadLocal 不是用来解决共享对象的多线程访问问题的，一般情况下，通过ThreadLocal.set() 到线程中的对象是该线程自己使用的对象，其他线程是不需要访问的，也访问不到的。</strong>各个线程中访问的是不同的对象。
<br>
<br><strong>另外，说ThreadLocal使得各线程能够保持各自独立的一个对象，并不是通过ThreadLocal.set()来实现的，而是通过每个线程中的new 对象 的操作来创建的对象，每个线程创建一个，不是什么对象的拷贝或副本。</strong>通过ThreadLocal.set()将这个新创建的对象的引用保存到各线程的自己的一个map中，每个线程都有这样一个map，执行ThreadLocal.get()时，各线程从自己的map中取出放进去的对象，因此取出来的是各自自己线程中的对象，ThreadLocal实例是作为map的key来使用的。
<br>
<br>如果ThreadLocal.set()进去的东西本来就是多个线程共享的同一个对象，那么多个线程的ThreadLocal.get()取得的还是这个共享对象本身，还是有并发访问问题。
<br>
<br>下面来看一个hibernate中典型的ThreadLocal的应用：
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%20%20%20%20private%20static%20final%20ThreadLocal%20threadSession%20%3D%20new%20ThreadLocal()%3B%0A%0A%20%20%20%20public%20static%20Session%20getSession()%20throws%20InfrastructureException%20%7B%0A%20%20%20%20%20%20%20%20Session%20s%20%3D%20(Session)%20threadSession.get()%3B%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(s%20%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s%20%3D%20getSessionFactory().openSession()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20threadSession.set(s)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20catch%20(HibernateException%20ex)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20InfrastructureException(ex)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20s%3B%0A%20%20%20%20%7D%0A" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;ThreadLocal&nbsp;threadSession&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;ThreadLocal();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;Session&nbsp;getSession()&nbsp;</span><span class="keyword">throws</span><span>&nbsp;InfrastructureException&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;Session&nbsp;s&nbsp;=&nbsp;(Session)&nbsp;threadSession.get();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(s&nbsp;==&nbsp;</span><span class="keyword">null</span><span>)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;getSessionFactory().openSession();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threadSession.set(s);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">catch</span><span>&nbsp;(HibernateException&nbsp;ex)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">throw</span><span>&nbsp;</span><span class="keyword">new</span><span>&nbsp;InfrastructureException(ex);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;s;&nbsp;&nbsp;</span></span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre class="java" name="code" codeable_type="Post" codeable_id="338877" source_url="http://www.iteye.com/topic/103804#338877" pre_index="0" title="正确理解ThreadLocal" style="display: none;">    private static final ThreadLocal threadSession = new ThreadLocal();

    public static Session getSession() throws InfrastructureException {
        Session s = (Session) threadSession.get();
        try {
            if (s == null) {
                s = getSessionFactory().openSession();
                threadSession.set(s);
            }
        } catch (HibernateException ex) {
            throw new InfrastructureException(ex);
        }
        return s;
    }
</pre>
<br>可以看到在getSession()方法中，首先判断当前线程中有没有放进去session，如果还没有，那么通过sessionFactory().openSession()来创建一个session，再将session set到线程中，实际是放到当前线程的ThreadLocalMap这个map中，这时，对于这个session的唯一引用就是当前线程中的那个ThreadLocalMap（下面会讲到），而threadSession作为这个值的key，要取得这个session可以通过threadSession.get()来得到，里面执行的操作实际是先取得当前线程中的ThreadLocalMap，然后将threadSession作为key将对应的值取出。这个session相当于线程的私有变量，而不是public的。
<br>显然，其他线程中是取不到这个session的，他们也只能取到自己的ThreadLocalMap中的东西。要是session是多个线程共享使用的，那还不乱套了。
<br>试想如果不用ThreadLocal怎么来实现呢？可能就要在action中创建session，然后把session一个个传到service和dao中，这可够麻烦的。或者可以自己定义一个静态的map，将当前thread作为key，创建的session作为值，put到map中，应该也行，这也是一般人的想法，但事实上，ThreadLocal的实现刚好相反，它是在每个线程中有一个map，而将ThreadLocal实例作为key，这样每个map中的项数很少，而且当线程销毁时相应的东西也一起销毁了，不知道除了这些还有什么其他的好处。
<br>
<br><span style="color: red;">总之，ThreadLocal不是用来解决对象共享访问问题的，而主要是提供了保持对象的方法和避免参数传递的方便的对象访问方式。归纳了两点：
<br>1。每个线程中都有一个自己的ThreadLocalMap类对象，可以将线程自己的对象保持到其中，各管各的，线程可以正确的访问到自己的对象。
<br>2。将一个共用的ThreadLocal静态实例作为key，将不同对象的引用保存到不同线程的ThreadLocalMap中，然后在线程执行的各处通过这个静态ThreadLocal实例的get()方法取得自己线程保存的那个对象，避免了将这个对象作为参数传递的麻烦。</span>
<br>
<br>当然如果要把本来线程共享的对象通过ThreadLocal.set()放到线程中也可以，可以实现避免参数传递的访问方式，但是要注意get()到的是那同一个共享对象，并发访问问题要靠其他手段来解决。但一般来说线程共享的对象通过设置为某类的静态变量就可以实现方便的访问了，似乎没必要放到线程中。
<br>
<br><span style="color: red;">ThreadLocal的应用场合，我觉得最适合的是按线程多实例（每个线程对应一个实例）的对象的访问，并且这个对象很多地方都要用到。</span>
<br>
<br>下面来看看ThreadLocal的实现原理（jdk1.5源码）
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=public%20class%20ThreadLocal%3CT%3E%20%7B%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20ThreadLocals%20rely%20on%20per-thread%20hash%20maps%20attached%20to%20each%20thread%0A%20%20%20%20%20*%20(Thread.threadLocals%20and%20inheritableThreadLocals).%20%20The%20ThreadLocal%0A%20%20%20%20%20*%20objects%20act%20as%20keys%2C%20searched%20via%20threadLocalHashCode.%20%20This%20is%20a%0A%20%20%20%20%20*%20custom%20hash%20code%20(useful%20only%20within%20ThreadLocalMaps)%20that%20eliminates%0A%20%20%20%20%20*%20collisions%20in%20the%20common%20case%20where%20consecutively%20constructed%0A%20%20%20%20%20*%20ThreadLocals%20are%20used%20by%20the%20same%20threads%2C%20while%20remaining%20well-behaved%0A%20%20%20%20%20*%20in%20less%20common%20cases.%0A%20%20%20%20%20*%2F%0A%20%20%20%20private%20final%20int%20threadLocalHashCode%20%3D%20nextHashCode()%3B%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20The%20next%20hash%20code%20to%20be%20given%20out.%20Accessed%20only%20by%20like-named%20method.%0A%20%20%20%20%20*%2F%0A%20%20%20%20private%20static%20int%20nextHashCode%20%3D%200%3B%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20The%20difference%20between%20successively%20generated%20hash%20codes%20-%20turns%0A%20%20%20%20%20*%20implicit%20sequential%20thread-local%20IDs%20into%20near-optimally%20spread%0A%20%20%20%20%20*%20multiplicative%20hash%20values%20for%20power-of-two-sized%20tables.%0A%20%20%20%20%20*%2F%0A%20%20%20%20private%20static%20final%20int%20HASH_INCREMENT%20%3D%200x61c88647%3B%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Compute%20the%20next%20hash%20code.%20The%20static%20synchronization%20used%20here%0A%20%20%20%20%20*%20should%20not%20be%20a%20performance%20bottleneck.%20When%20ThreadLocals%20are%0A%20%20%20%20%20*%20generated%20in%20different%20threads%20at%20a%20fast%20enough%20rate%20to%20regularly%0A%20%20%20%20%20*%20contend%20on%20this%20lock%2C%20memory%20contention%20is%20by%20far%20a%20more%20serious%0A%20%20%20%20%20*%20problem%20than%20lock%20contention.%0A%20%20%20%20%20*%2F%0A%20%20%20%20private%20static%20synchronized%20int%20nextHashCode()%20%7B%0A%20%20%20%20%20%20%20%20int%20h%20%3D%20nextHashCode%3B%0A%20%20%20%20%20%20%20%20nextHashCode%20%3D%20h%20%2B%20HASH_INCREMENT%3B%0A%20%20%20%20%20%20%20%20return%20h%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Creates%20a%20thread%20local%20variable.%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20ThreadLocal()%20%7B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Returns%20the%20value%20in%20the%20current%20thread&#39;s%20copy%20of%20this%20thread-local%0A%20%20%20%20%20*%20variable.%20%20Creates%20and%20initializes%20the%20copy%20if%20this%20is%20the%20first%20time%0A%20%20%20%20%20*%20the%20thread%20has%20called%20this%20method.%0A%20%20%20%20%20*%0A%20%20%20%20%20*%20%40return%20the%20current%20thread&#39;s%20value%20of%20this%20thread-local%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20T%20get()%20%7B%0A%20%20%20%20%20%20%20%20Thread%20t%20%3D%20Thread.currentThread()%3B%0A%20%20%20%20%20%20%20%20ThreadLocalMap%20map%20%3D%20getMap(t)%3B%0A%20%20%20%20%20%20%20%20if%20(map%20!%3D%20null)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20(T)map.get(this)%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20Maps%20are%20constructed%20lazily.%20%20if%20the%20map%20for%20this%20thread%0A%20%20%20%20%20%20%20%20%2F%2F%20doesn&#39;t%20exist%2C%20create%20it%2C%20with%20this%20ThreadLocal%20and%20its%0A%20%20%20%20%20%20%20%20%2F%2F%20initial%20value%20as%20its%20only%20entry.%0A%20%20%20%20%20%20%20%20T%20value%20%3D%20initialValue()%3B%0A%20%20%20%20%20%20%20%20createMap(t%2C%20value)%3B%0A%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Sets%20the%20current%20thread&#39;s%20copy%20of%20this%20thread-local%20variable%0A%20%20%20%20%20*%20to%20the%20specified%20value.%20%20Many%20applications%20will%20have%20no%20need%20for%0A%20%20%20%20%20*%20this%20functionality%2C%20relying%20solely%20on%20the%20%7B%40link%20%23initialValue%7D%0A%20%20%20%20%20*%20method%20to%20set%20the%20values%20of%20thread-locals.%0A%20%20%20%20%20*%0A%20%20%20%20%20*%20%40param%20value%20the%20value%20to%20be%20stored%20in%20the%20current%20threads&#39;%20copy%20of%0A%20%20%20%20%20*%20%20%20%20%20%20%20%20this%20thread-local.%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20void%20set(T%20value)%20%7B%0A%20%20%20%20%20%20%20%20Thread%20t%20%3D%20Thread.currentThread()%3B%0A%20%20%20%20%20%20%20%20ThreadLocalMap%20map%20%3D%20getMap(t)%3B%0A%20%20%20%20%20%20%20%20if%20(map%20!%3D%20null)%0A%20%20%20%20%20%20%20%20%20%20%20%20map.set(this%2C%20value)%3B%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20createMap(t%2C%20value)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Get%20the%20map%20associated%20with%20a%20ThreadLocal.%20Overridden%20in%0A%20%20%20%20%20*%20InheritableThreadLocal.%0A%20%20%20%20%20*%0A%20%20%20%20%20*%20%40param%20%20t%20the%20current%20thread%0A%20%20%20%20%20*%20%40return%20the%20map%0A%20%20%20%20%20*%2F%0A%20%20%20%20ThreadLocalMap%20getMap(Thread%20t)%20%7B%0A%20%20%20%20%20%20%20%20return%20t.threadLocals%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Create%20the%20map%20associated%20with%20a%20ThreadLocal.%20Overridden%20in%0A%20%20%20%20%20*%20InheritableThreadLocal.%0A%20%20%20%20%20*%0A%20%20%20%20%20*%20%40param%20t%20the%20current%20thread%0A%20%20%20%20%20*%20%40param%20firstValue%20value%20for%20the%20initial%20entry%20of%20the%20map%0A%20%20%20%20%20*%20%40param%20map%20the%20map%20to%20store.%0A%20%20%20%20%20*%2F%0A%20%20%20%20void%20createMap(Thread%20t%2C%20T%20firstValue)%20%7B%0A%20%20%20%20%20%20%20%20t.threadLocals%20%3D%20new%20ThreadLocalMap(this%2C%20firstValue)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20.......%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20ThreadLocalMap%20is%20a%20customized%20hash%20map%20suitable%20only%20for%0A%20%20%20%20%20*%20maintaining%20thread%20local%20values.%20No%20operations%20are%20exported%0A%20%20%20%20%20*%20outside%20of%20the%20ThreadLocal%20class.%20The%20class%20is%20package%20private%20to%0A%20%20%20%20%20*%20allow%20declaration%20of%20fields%20in%20class%20Thread.%20%20To%20help%20deal%20with%0A%20%20%20%20%20*%20very%20large%20and%20long-lived%20usages%2C%20the%20hash%20table%20entries%20use%0A%20%20%20%20%20*%20WeakReferences%20for%20keys.%20However%2C%20since%20reference%20queues%20are%20not%0A%20%20%20%20%20*%20used%2C%20stale%20entries%20are%20guaranteed%20to%20be%20removed%20only%20when%0A%20%20%20%20%20*%20the%20table%20starts%20running%20out%20of%20space.%0A%20%20%20%20%20*%2F%0A%20%20%20%20static%20class%20ThreadLocalMap%20%7B%0A%0A%20%20%20%20........%0A%0A%20%20%20%20%7D%0A%0A%7D" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;ThreadLocal&lt;T&gt;&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;ThreadLocals&nbsp;rely&nbsp;on&nbsp;per-thread&nbsp;hash&nbsp;maps&nbsp;attached&nbsp;to&nbsp;each&nbsp;thread</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(Thread.threadLocals&nbsp;and&nbsp;inheritableThreadLocals).&nbsp;&nbsp;The&nbsp;ThreadLocal</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;objects&nbsp;act&nbsp;as&nbsp;keys,&nbsp;searched&nbsp;via&nbsp;threadLocalHashCode.&nbsp;&nbsp;This&nbsp;is&nbsp;a</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;custom&nbsp;hash&nbsp;code&nbsp;(useful&nbsp;only&nbsp;within&nbsp;ThreadLocalMaps)&nbsp;that&nbsp;eliminates</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;collisions&nbsp;in&nbsp;the&nbsp;common&nbsp;case&nbsp;where&nbsp;consecutively&nbsp;constructed</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;ThreadLocals&nbsp;are&nbsp;used&nbsp;by&nbsp;the&nbsp;same&nbsp;threads,&nbsp;while&nbsp;remaining&nbsp;well-behaved</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;in&nbsp;less&nbsp;common&nbsp;cases.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;threadLocalHashCode&nbsp;=&nbsp;nextHashCode();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;next&nbsp;hash&nbsp;code&nbsp;to&nbsp;be&nbsp;given&nbsp;out.&nbsp;Accessed&nbsp;only&nbsp;by&nbsp;like-named&nbsp;method.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;nextHashCode&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;difference&nbsp;between&nbsp;successively&nbsp;generated&nbsp;hash&nbsp;codes&nbsp;-&nbsp;turns</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;implicit&nbsp;sequential&nbsp;thread-local&nbsp;IDs&nbsp;into&nbsp;near-optimally&nbsp;spread</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;multiplicative&nbsp;hash&nbsp;values&nbsp;for&nbsp;power-of-two-sized&nbsp;tables.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;HASH_INCREMENT&nbsp;=&nbsp;</span><span class="number">0x61c88647</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Compute&nbsp;the&nbsp;next&nbsp;hash&nbsp;code.&nbsp;The&nbsp;static&nbsp;synchronization&nbsp;used&nbsp;here</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;should&nbsp;not&nbsp;be&nbsp;a&nbsp;performance&nbsp;bottleneck.&nbsp;When&nbsp;ThreadLocals&nbsp;are</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;generated&nbsp;in&nbsp;different&nbsp;threads&nbsp;at&nbsp;a&nbsp;fast&nbsp;enough&nbsp;rate&nbsp;to&nbsp;regularly</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;contend&nbsp;on&nbsp;this&nbsp;lock,&nbsp;memory&nbsp;contention&nbsp;is&nbsp;by&nbsp;far&nbsp;a&nbsp;more&nbsp;serious</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;problem&nbsp;than&nbsp;lock&nbsp;contention.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">synchronized</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;nextHashCode()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;h&nbsp;=&nbsp;nextHashCode;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nextHashCode&nbsp;=&nbsp;h&nbsp;+&nbsp;HASH_INCREMENT;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;h;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;thread&nbsp;local&nbsp;variable.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;ThreadLocal()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;current&nbsp;thread's&nbsp;copy&nbsp;of&nbsp;this&nbsp;thread-local</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;variable.&nbsp;&nbsp;Creates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;copy&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;first&nbsp;time</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;thread&nbsp;has&nbsp;called&nbsp;this&nbsp;method.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;current&nbsp;thread's&nbsp;value&nbsp;of&nbsp;this&nbsp;thread-local</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;T&nbsp;get()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread&nbsp;t&nbsp;=&nbsp;Thread.currentThread();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadLocalMap&nbsp;map&nbsp;=&nbsp;getMap(t);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(map&nbsp;!=&nbsp;</span><span class="keyword">null</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;(T)map.get(</span><span class="keyword">this</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;Maps&nbsp;are&nbsp;constructed&nbsp;lazily.&nbsp;&nbsp;if&nbsp;the&nbsp;map&nbsp;for&nbsp;this&nbsp;thread</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;doesn't&nbsp;exist,&nbsp;create&nbsp;it,&nbsp;with&nbsp;this&nbsp;ThreadLocal&nbsp;and&nbsp;its</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;initial&nbsp;value&nbsp;as&nbsp;its&nbsp;only&nbsp;entry.</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;value&nbsp;=&nbsp;initialValue();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;createMap(t,&nbsp;value);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;value;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;current&nbsp;thread's&nbsp;copy&nbsp;of&nbsp;this&nbsp;thread-local&nbsp;variable</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;to&nbsp;the&nbsp;specified&nbsp;value.&nbsp;&nbsp;Many&nbsp;applications&nbsp;will&nbsp;have&nbsp;no&nbsp;need&nbsp;for</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;this&nbsp;functionality,&nbsp;relying&nbsp;solely&nbsp;on&nbsp;the&nbsp;{@link&nbsp;#initialValue}</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;method&nbsp;to&nbsp;set&nbsp;the&nbsp;values&nbsp;of&nbsp;thread-locals.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;value&nbsp;the&nbsp;value&nbsp;to&nbsp;be&nbsp;stored&nbsp;in&nbsp;the&nbsp;current&nbsp;threads'&nbsp;copy&nbsp;of</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;thread-local.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;set(T&nbsp;value)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread&nbsp;t&nbsp;=&nbsp;Thread.currentThread();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadLocalMap&nbsp;map&nbsp;=&nbsp;getMap(t);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(map&nbsp;!=&nbsp;</span><span class="keyword">null</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.set(<span class="keyword">this</span><span>,&nbsp;value);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;createMap(t,&nbsp;value);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Get&nbsp;the&nbsp;map&nbsp;associated&nbsp;with&nbsp;a&nbsp;ThreadLocal.&nbsp;Overridden&nbsp;in</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;InheritableThreadLocal.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;t&nbsp;the&nbsp;current&nbsp;thread</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;map</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;ThreadLocalMap&nbsp;getMap(Thread&nbsp;t)&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;t.threadLocals;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Create&nbsp;the&nbsp;map&nbsp;associated&nbsp;with&nbsp;a&nbsp;ThreadLocal.&nbsp;Overridden&nbsp;in</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;InheritableThreadLocal.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;t&nbsp;the&nbsp;current&nbsp;thread</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;firstValue&nbsp;value&nbsp;for&nbsp;the&nbsp;initial&nbsp;entry&nbsp;of&nbsp;the&nbsp;map</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;map&nbsp;the&nbsp;map&nbsp;to&nbsp;store.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">void</span><span>&nbsp;createMap(Thread&nbsp;t,&nbsp;T&nbsp;firstValue)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.threadLocals&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;ThreadLocalMap(</span><span class="keyword">this</span><span>,&nbsp;firstValue);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;.......&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;ThreadLocalMap&nbsp;is&nbsp;a&nbsp;customized&nbsp;hash&nbsp;map&nbsp;suitable&nbsp;only&nbsp;for</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;maintaining&nbsp;thread&nbsp;local&nbsp;values.&nbsp;No&nbsp;operations&nbsp;are&nbsp;exported</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;outside&nbsp;of&nbsp;the&nbsp;ThreadLocal&nbsp;class.&nbsp;The&nbsp;class&nbsp;is&nbsp;package&nbsp;private&nbsp;to</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;allow&nbsp;declaration&nbsp;of&nbsp;fields&nbsp;in&nbsp;class&nbsp;Thread.&nbsp;&nbsp;To&nbsp;help&nbsp;deal&nbsp;with</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;very&nbsp;large&nbsp;and&nbsp;long-lived&nbsp;usages,&nbsp;the&nbsp;hash&nbsp;table&nbsp;entries&nbsp;use</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;WeakReferences&nbsp;for&nbsp;keys.&nbsp;However,&nbsp;since&nbsp;reference&nbsp;queues&nbsp;are&nbsp;not</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;used,&nbsp;stale&nbsp;entries&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;removed&nbsp;only&nbsp;when</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;table&nbsp;starts&nbsp;running&nbsp;out&nbsp;of&nbsp;space.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;ThreadLocalMap&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;........&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre class="java" name="code" codeable_type="Post" codeable_id="338877" source_url="http://www.iteye.com/topic/103804#338877" pre_index="1" title="正确理解ThreadLocal" style="display: none;">public class ThreadLocal&lt;T&gt; {
    /**
     * ThreadLocals rely on per-thread hash maps attached to each thread
     * (Thread.threadLocals and inheritableThreadLocals).  The ThreadLocal
     * objects act as keys, searched via threadLocalHashCode.  This is a
     * custom hash code (useful only within ThreadLocalMaps) that eliminates
     * collisions in the common case where consecutively constructed
     * ThreadLocals are used by the same threads, while remaining well-behaved
     * in less common cases.
     */
    private final int threadLocalHashCode = nextHashCode();

    /**
     * The next hash code to be given out. Accessed only by like-named method.
     */
    private static int nextHashCode = 0;

    /**
     * The difference between successively generated hash codes - turns
     * implicit sequential thread-local IDs into near-optimally spread
     * multiplicative hash values for power-of-two-sized tables.
     */
    private static final int HASH_INCREMENT = 0x61c88647;

    /**
     * Compute the next hash code. The static synchronization used here
     * should not be a performance bottleneck. When ThreadLocals are
     * generated in different threads at a fast enough rate to regularly
     * contend on this lock, memory contention is by far a more serious
     * problem than lock contention.
     */
    private static synchronized int nextHashCode() {
        int h = nextHashCode;
        nextHashCode = h + HASH_INCREMENT;
        return h;
    }

    /**
     * Creates a thread local variable.
     */
    public ThreadLocal() {
    }

    /**
     * Returns the value in the current thread's copy of this thread-local
     * variable.  Creates and initializes the copy if this is the first time
     * the thread has called this method.
     *
     * @return the current thread's value of this thread-local
     */
    public T get() {
        Thread t = Thread.currentThread();
        ThreadLocalMap map = getMap(t);
        if (map != null)
            return (T)map.get(this);

        // Maps are constructed lazily.  if the map for this thread
        // doesn't exist, create it, with this ThreadLocal and its
        // initial value as its only entry.
        T value = initialValue();
        createMap(t, value);
        return value;
    }

    /**
     * Sets the current thread's copy of this thread-local variable
     * to the specified value.  Many applications will have no need for
     * this functionality, relying solely on the {@link #initialValue}
     * method to set the values of thread-locals.
     *
     * @param value the value to be stored in the current threads' copy of
     *        this thread-local.
     */
    public void set(T value) {
        Thread t = Thread.currentThread();
        ThreadLocalMap map = getMap(t);
        if (map != null)
            map.set(this, value);
        else
            createMap(t, value);
    }

    /**
     * Get the map associated with a ThreadLocal. Overridden in
     * InheritableThreadLocal.
     *
     * @param  t the current thread
     * @return the map
     */
    ThreadLocalMap getMap(Thread t) {
        return t.threadLocals;
    }

    /**
     * Create the map associated with a ThreadLocal. Overridden in
     * InheritableThreadLocal.
     *
     * @param t the current thread
     * @param firstValue value for the initial entry of the map
     * @param map the map to store.
     */
    void createMap(Thread t, T firstValue) {
        t.threadLocals = new ThreadLocalMap(this, firstValue);
    }

    .......

    /**
     * ThreadLocalMap is a customized hash map suitable only for
     * maintaining thread local values. No operations are exported
     * outside of the ThreadLocal class. The class is package private to
     * allow declaration of fields in class Thread.  To help deal with
     * very large and long-lived usages, the hash table entries use
     * WeakReferences for keys. However, since reference queues are not
     * used, stale entries are guaranteed to be removed only when
     * the table starts running out of space.
     */
    static class ThreadLocalMap {

    ........

    }

}</pre>
<br>
<br>可以看到ThreadLocal类中的变量只有这3个int型：
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%20%20%20%20private%20final%20int%20threadLocalHashCode%20%3D%20nextHashCode()%3B%0A%20%20%20%20private%20static%20int%20nextHashCode%20%3D%200%3B%0A%20%20%20%20private%20static%20final%20int%20HASH_INCREMENT%20%3D%200x61c88647%3B" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="keyword">private</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;threadLocalHashCode&nbsp;=&nbsp;nextHashCode();&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;nextHashCode&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;HASH_INCREMENT&nbsp;=&nbsp;</span><span class="number">0x61c88647</span><span>;&nbsp;&nbsp;</span></span></li></ol></div><pre class="java" name="code" codeable_type="Post" codeable_id="338877" source_url="http://www.iteye.com/topic/103804#338877" pre_index="2" title="正确理解ThreadLocal" style="display: none;">    private final int threadLocalHashCode = nextHashCode();
    private static int nextHashCode = 0;
    private static final int HASH_INCREMENT = 0x61c88647;</pre>
<br>而作为ThreadLocal实例的变量只有 threadLocalHashCode 这一个，nextHashCode 和HASH_INCREMENT 是ThreadLocal类的静态变量，实际上HASH_INCREMENT是一个常量，表示了连续分配的两个ThreadLocal实例的threadLocalHashCode值的增量，而nextHashCode 的表示了即将分配的下一个ThreadLocal实例的threadLocalHashCode 的值。
<br>
<br>可以来看一下创建一个ThreadLocal实例即new ThreadLocal()时做了哪些操作，从上面看到构造函数ThreadLocal()里什么操作都没有，唯一的操作是这句：
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%20%20%20%20private%20final%20int%20threadLocalHashCode%20%3D%20nextHashCode()%3B" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="keyword">private</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;threadLocalHashCode&nbsp;=&nbsp;nextHashCode();&nbsp;&nbsp;</span></span></li></ol></div><pre class="java" name="code" codeable_type="Post" codeable_id="338877" source_url="http://www.iteye.com/topic/103804#338877" pre_index="3" title="正确理解ThreadLocal" style="display: none;">    private final int threadLocalHashCode = nextHashCode();</pre>
<br>那么nextHashCode()做了什么呢：
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%20%20%20%20private%20static%20synchronized%20int%20nextHashCode()%20%7B%0A%20%20%20%20%20%20%20%20int%20h%20%3D%20nextHashCode%3B%0A%20%20%20%20%20%20%20%20nextHashCode%20%3D%20h%20%2B%20HASH_INCREMENT%3B%0A%20%20%20%20%20%20%20%20return%20h%3B%0A%20%20%20%20%7D" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">synchronized</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;nextHashCode()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;h&nbsp;=&nbsp;nextHashCode;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;nextHashCode&nbsp;=&nbsp;h&nbsp;+&nbsp;HASH_INCREMENT;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;h;&nbsp;&nbsp;</span></span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre class="java" name="code" codeable_type="Post" codeable_id="338877" source_url="http://www.iteye.com/topic/103804#338877" pre_index="4" title="正确理解ThreadLocal" style="display: none;">    private static synchronized int nextHashCode() {
        int h = nextHashCode;
        nextHashCode = h + HASH_INCREMENT;
        return h;
    }</pre>就是将ThreadLocal类的下一个hashCode值即nextHashCode的值赋给实例的threadLocalHashCode，然后nextHashCode的值增加HASH_INCREMENT这个值。
<br>
<br>因此ThreadLocal实例的变量只有这个threadLocalHashCode，而且是final的，用来区分不同的ThreadLocal实例，ThreadLocal类主要是作为工具类来使用，那么ThreadLocal.set()进去的对象是放在哪儿的呢？
<br>
<br>看一下上面的set()方法，两句合并一下成为
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%20%20%20%20%20%20%20%20ThreadLocalMap%20map%20%3D%20Thread.currentThread().threadLocals%3B" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span>ThreadLocalMap&nbsp;map&nbsp;=&nbsp;Thread.currentThread().threadLocals;&nbsp;&nbsp;</span></span></li></ol></div><pre class="java" name="code" codeable_type="Post" codeable_id="338877" source_url="http://www.iteye.com/topic/103804#338877" pre_index="5" title="正确理解ThreadLocal" style="display: none;">        ThreadLocalMap map = Thread.currentThread().threadLocals;</pre>
<br>这个ThreadLocalMap 类是ThreadLocal中定义的内部类，但是它的实例却用在Thread类中：
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=public%20class%20Thread%20implements%20Runnable%20%7B%0A%20%20%20%20......%0A%0A%20%20%20%20%2F*%20ThreadLocal%20values%20pertaining%20to%20this%20thread.%20This%20map%20is%20maintained%0A%20%20%20%20%20*%20by%20the%20ThreadLocal%20class.%20*%2F%0A%20%20%20%20ThreadLocal.ThreadLocalMap%20threadLocals%20%3D%20null%3B%20%20%0A%20%20%20%20......%0A%7D" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;Thread&nbsp;</span><span class="keyword">implements</span><span>&nbsp;Runnable&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;......&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/*&nbsp;ThreadLocal&nbsp;values&nbsp;pertaining&nbsp;to&nbsp;this&nbsp;thread.&nbsp;This&nbsp;map&nbsp;is&nbsp;maintained</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;by&nbsp;the&nbsp;ThreadLocal&nbsp;class.&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;ThreadLocal.ThreadLocalMap&nbsp;threadLocals&nbsp;=&nbsp;<span class="keyword">null</span><span>;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;......&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre class="java" name="code" codeable_type="Post" codeable_id="338877" source_url="http://www.iteye.com/topic/103804#338877" pre_index="6" title="正确理解ThreadLocal" style="display: none;">public class Thread implements Runnable {
    ......

    /* ThreadLocal values pertaining to this thread. This map is maintained
     * by the ThreadLocal class. */
    ThreadLocal.ThreadLocalMap threadLocals = null;  
    ......
}</pre>
<br>
<br>再看这句：
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%20%20%20%20%20%20%20%20if%20(map%20!%3D%20null)%0A%20%20%20%20%20%20%20%20%20%20%20%20map.set(this%2C%20value)%3B" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="keyword">if</span><span>&nbsp;(map&nbsp;!=&nbsp;</span><span class="keyword">null</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;map.set(<span class="keyword">this</span><span>,&nbsp;value);&nbsp;&nbsp;</span></span></li></ol></div><pre class="java" name="code" codeable_type="Post" codeable_id="338877" source_url="http://www.iteye.com/topic/103804#338877" pre_index="7" title="正确理解ThreadLocal" style="display: none;">        if (map != null)
            map.set(this, value);</pre>
<br>也就是将该ThreadLocal实例作为key，要保持的对象作为值，设置到当前线程的ThreadLocalMap 中，get()方法同样大家看了代码也就明白了，ThreadLocalMap 类的代码太多了，我就不帖了，自己去看源码吧。
<br>
<br>写了这么多，也不知讲明白了没有，有什么不当的地方还请大家指出来。
    </div>
    

          <div id="topic_copyright">声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。 </div>
      <div id="forum_recommended_f5"><span>推荐链接</span><ul></ul></div>
              <div id="forum_recommended_f0"></div>
        </td>
  </tr>
  <tr>
    <td class="postauthor"><a href="http://www.iteye.com/topic/103804#">返回顶楼</a></td>
    <td class="postcontent">
      <div class="icons">
        <a href="http://lujh99.iteye.com/" class="icon_www" title="浏览作者的博客">&nbsp;</a>
        <a href="http://lujh99.iteye.com/blog/profile" class="icon_profile" title="浏览作者资料">&nbsp;</a>
        <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=lujh99" class="icon_pm" title="发送站内短信">&nbsp;</a>
        <a href="http://lujh99.iteye.com/blog/guest_book" class="icon_guestbook" title="给作者留言">&nbsp;</a>
        <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=lujh99" class="icon_rss" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk=&#39;); f.appendChild(s);f.submit();return false;" title="关注作者">&nbsp;</a>
              </div>
                    </td>
</tr>
<tr class="sep2"><td colspan="2"></td></tr>
<tr id="339651">
  <td class="postauthor">
    <ul>
      <li class="name">liangguanhui</li>
      <li>等级: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/star3.gif" alt="三星会员" title="三星会员"></li>
      <li><a href="http://liangguanhui.iteye.com/" target="_blank"><img alt="liangguanhui的博客" class="logo" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/f24a1160-9f09-4cb5-8cdc-a0a61f09b51e.jpg" title="liangguanhui的博客: liangguanhui" width=""></a></li>
      <li>性别: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_minigender_1.gif" title="男"></li>      <li>文章: 242</li>
      <li>积分: 308</li>
      
      <li><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/offline.gif"></li>
    </ul>
  </td>
  <td class="postcontent">
    <div class="postactions">
      <div class="description">
        &nbsp;&nbsp;
        发表时间：2007-07-23&nbsp;&nbsp;
        
      </div>
      <div class="links">
        
        
          
          
          
        
      </div>
    </div>
    <div class="postbody clearfix">
      
      
      <div class="quote_title">引用</div><div class="quote_div">或者可以自己定义一个静态的map，将当前thread作为key，创建的session作为值，put到map中，应该也行，这也是一般人的想法，但事实上，ThreadLocal的实现刚好相反，它是在每个线程中有一个map，而将ThreadLocal实例作为key，这样每个map中的项数很少，而且当线程销毁时相应的东西也一起销毁了，不知道除了这些还有什么其他的好处。</div>
<br>其实在jdk1.4之前的ThreadLocal的实现就是类似第一种情况的实现，jdk1.4就改成后面那种实现。
<br>至于好处，除了可以自动释放外，还有一个很重要的好处：速度快了很多。
    </div>
    

            </td>
  </tr>
  <tr>
    <td class="postauthor"><a href="http://www.iteye.com/topic/103804#">返回顶楼</a></td>
    <td class="postcontent">
      <div class="icons">
        <a href="http://liangguanhui.iteye.com/" class="icon_www" title="浏览作者的博客">&nbsp;</a>
        <a href="http://liangguanhui.iteye.com/blog/profile" class="icon_profile" title="浏览作者资料">&nbsp;</a>
        <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=liangguanhui" class="icon_pm" title="发送站内短信">&nbsp;</a>
        <a href="http://liangguanhui.iteye.com/blog/guest_book" class="icon_guestbook" title="给作者留言">&nbsp;</a>
        <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=liangguanhui" class="icon_rss" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk=&#39;); f.appendChild(s);f.submit();return false;" title="关注作者">&nbsp;</a>
                  <a href="http://www.iteye.com/topic/103804#339651" title="liangguanhui回帖:正确理解ThreadLocal">回帖地址</a>
              </div>
                        <div id="post_rate_box_339651" class="post_rate_box"><a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="good" title="好">0</a> <a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="hidden" title="差">0</a> 请登录后投票</div>              </td>
</tr>
<tr class="sep2"><td colspan="2"></td></tr>
<tr id="339964">
  <td class="postauthor">
    <ul>
      <li class="name">lujh99</li>
      <li>等级: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/star2.gif" alt="二星会员" title="二星会员"></li>
      <li><a href="http://lujh99.iteye.com/" target="_blank"><img alt="lujh99的博客" class="logo" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/user-logo.gif" title="lujh99的博客: lujh99" width=""></a></li>
            <li>文章: 74</li>
      <li>积分: 165</li>
      <li>来自: ...</li>
      <li><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/offline.gif"></li>
    </ul>
  </td>
  <td class="postcontent">
    <div class="postactions">
      <div class="description">
        &nbsp;&nbsp;
        发表时间：2007-07-23&nbsp;&nbsp;
        
      </div>
      <div class="links">
        
        
          
          
          
        
      </div>
    </div>
    <div class="postbody clearfix">
      
      
      <div class="quote_title">liangguanhui 写道</div><div class="quote_div"><div class="quote_title">引用</div><div class="quote_div">或者可以自己定义一个静态的map，将当前thread作为key，创建的session作为值，put到map中，应该也行，这也是一般人的想法，但事实上，ThreadLocal的实现刚好相反，它是在每个线程中有一个map，而将ThreadLocal实例作为key，这样每个map中的项数很少，而且当线程销毁时相应的东西也一起销毁了，不知道除了这些还有什么其他的好处。</div>
<br>其实在jdk1.4之前的ThreadLocal的实现就是类似第一种情况的实现，jdk1.4就改成后面那种实现。
<br>至于好处，除了可以自动释放外，还有一个很重要的好处：速度快了很多。</div>
<br>
<br>不是啊，我看了一下jdk1.3的源码，这一点上和1.4、1.5是一样的，map都是放在每个线程中的，以threadLocal为key，所不同的是，在1.3中这个map是个普通的HashMap，而1.4和1.5中是个ThreadLocalMap类，一个明显的特征是其中的Entry用到了弱引用WeakReference 类，但我感觉这个WeakReference的用法在这里并不能起到应有的作用。
<br>
<br>另外想到一个把map放到各自线程中带来的好处是 因为各线程访问的map是各自不同的map，所以不需要同步，速度会快些；而如果把所有线程要用的对象都放到一个静态map中的话 多线程并发访问需要进行同步。
    </div>
    

            </td>
  </tr>
  <tr>
    <td class="postauthor"><a href="http://www.iteye.com/topic/103804#">返回顶楼</a></td>
    <td class="postcontent">
      <div class="icons">
        <a href="http://lujh99.iteye.com/" class="icon_www" title="浏览作者的博客">&nbsp;</a>
        <a href="http://lujh99.iteye.com/blog/profile" class="icon_profile" title="浏览作者资料">&nbsp;</a>
        <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=lujh99" class="icon_pm" title="发送站内短信">&nbsp;</a>
        <a href="http://lujh99.iteye.com/blog/guest_book" class="icon_guestbook" title="给作者留言">&nbsp;</a>
        <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=lujh99" class="icon_rss" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk=&#39;); f.appendChild(s);f.submit();return false;" title="关注作者">&nbsp;</a>
                  <a href="http://www.iteye.com/topic/103804#339964" title="lujh99回帖:正确理解ThreadLocal">回帖地址</a>
              </div>
                        <div id="post_rate_box_339964" class="post_rate_box"><a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="good" title="好">1</a> <a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="hidden" title="差">0</a> 请登录后投票</div>              </td>
</tr>
<tr class="sep2"><td colspan="2"></td></tr>
<tr id="359155">
  <td class="postauthor">
    <ul>
      <li class="name">liangguanhui</li>
      <li>等级: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/star3.gif" alt="三星会员" title="三星会员"></li>
      <li><a href="http://liangguanhui.iteye.com/" target="_blank"><img alt="liangguanhui的博客" class="logo" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/f24a1160-9f09-4cb5-8cdc-a0a61f09b51e.jpg" title="liangguanhui的博客: liangguanhui" width=""></a></li>
      <li>性别: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_minigender_1.gif" title="男"></li>      <li>文章: 242</li>
      <li>积分: 308</li>
      
      <li><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/offline.gif"></li>
    </ul>
  </td>
  <td class="postcontent">
    <div class="postactions">
      <div class="description">
        &nbsp;&nbsp;
        发表时间：2007-08-21&nbsp;&nbsp;
        
      </div>
      <div class="links">
        
        
          
          
          
        
      </div>
    </div>
    <div class="postbody clearfix">
      
      
      可能是我搞错了，是1.3的时候改写的<img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_redface.gif"> 
    </div>
    

            </td>
  </tr>
  <tr>
    <td class="postauthor"><a href="http://www.iteye.com/topic/103804#">返回顶楼</a></td>
    <td class="postcontent">
      <div class="icons">
        <a href="http://liangguanhui.iteye.com/" class="icon_www" title="浏览作者的博客">&nbsp;</a>
        <a href="http://liangguanhui.iteye.com/blog/profile" class="icon_profile" title="浏览作者资料">&nbsp;</a>
        <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=liangguanhui" class="icon_pm" title="发送站内短信">&nbsp;</a>
        <a href="http://liangguanhui.iteye.com/blog/guest_book" class="icon_guestbook" title="给作者留言">&nbsp;</a>
        <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=liangguanhui" class="icon_rss" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk=&#39;); f.appendChild(s);f.submit();return false;" title="关注作者">&nbsp;</a>
                  <a href="http://www.iteye.com/topic/103804#359155" title="liangguanhui回帖:正确理解ThreadLocal">回帖地址</a>
              </div>
                        <div id="post_rate_box_359155" class="post_rate_box"><a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="good" title="好">0</a> <a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="hidden" title="差">0</a> 请登录后投票</div>              </td>
</tr>
<tr class="sep2"><td colspan="2"></td></tr>
<tr id="359544">
  <td class="postauthor">
    <ul>
      <li class="name">hax</li>
      <li>等级: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/dimd4.gif" alt="四钻会员" title="四钻会员"></li>
      <li><a href="http://hax.iteye.com/" target="_blank"><img alt="hax的博客" class="logo" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/f59a79c1-9358-3ec2-ae54-1a8b09289e48.gif" title="hax的博客: hax的技术部落格" width=""></a></li>
      <li>性别: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_minigender_1.gif" title="男"></li>      <li>文章: 1544</li>
      <li>积分: 1795</li>
      <li>来自: 上海</li>
      <li><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/offline.gif"></li>
    </ul>
  </td>
  <td class="postcontent">
    <div class="postactions">
      <div class="description">
        &nbsp;&nbsp;
        发表时间：2007-08-21&nbsp;&nbsp;
        
      </div>
      <div class="links">
        
        
          
          
          
        
      </div>
    </div>
    <div class="postbody clearfix">
      
      
      <div class="quote_title">lujh99 写道</div><div class="quote_div">另外想到一个把map放到各自线程中带来的好处是 因为各线程访问的map是各自不同的map，所以不需要同步，速度会快些；而如果把所有线程要用的对象都放到一个静态map中的话 多线程并发访问需要进行同步。</div>
<br>
<br>不是快一点两点的，jdk 1.3之前的实现是非常之慢的！
    </div>
    

            </td>
  </tr>
  <tr>
    <td class="postauthor"><a href="http://www.iteye.com/topic/103804#">返回顶楼</a></td>
    <td class="postcontent">
      <div class="icons">
        <a href="http://hax.iteye.com/" class="icon_www" title="浏览作者的博客">&nbsp;</a>
        <a href="http://hax.iteye.com/blog/profile" class="icon_profile" title="浏览作者资料">&nbsp;</a>
        <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=hax" class="icon_pm" title="发送站内短信">&nbsp;</a>
        <a href="http://hax.iteye.com/blog/guest_book" class="icon_guestbook" title="给作者留言">&nbsp;</a>
        <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=hax" class="icon_rss" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk=&#39;); f.appendChild(s);f.submit();return false;" title="关注作者">&nbsp;</a>
                  <a href="http://www.iteye.com/topic/103804#359544" title="hax回帖:正确理解ThreadLocal">回帖地址</a>
              </div>
                        <div id="post_rate_box_359544" class="post_rate_box"><a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="good" title="好">0</a> <a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="hidden" title="差">0</a> 请登录后投票</div>              </td>
</tr>
<tr class="sep2"><td colspan="2"></td></tr>
<tr id="413719">
  <td class="postauthor">
    <ul>
      <li class="name">SINCE1978</li>
      <li>等级: 初级会员</li>
      <li><a href="http://since1978.iteye.com/" target="_blank"><img alt="SINCE1978的博客" class="logo" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/a466cf02-5580-326b-8923-1fb672781130.jpg" title="SINCE1978的博客: SINCE1978SEQUOIA" width=""></a></li>
      <li>性别: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_minigender_1.gif" title="男"></li>      <li>文章: 55</li>
      <li>积分: 40</li>
      <li>来自: 济南</li>
      <li><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/offline.gif"></li>
    </ul>
  </td>
  <td class="postcontent">
    <div class="postactions">
      <div class="description">
        &nbsp;&nbsp;
        发表时间：2007-11-16&nbsp;&nbsp;
        
      </div>
      <div class="links">
        
        
          
          
          
        
      </div>
    </div>
    <div class="postbody clearfix">
      
      
      我想知道如果多次new ThreadLocal并且调用其set方法的话、是否就和普通hashmap一样后set进去的会覆盖先set进去的？这样的话ThreadLocal只能植入一个资源喽？这肯定不对，否则还用ThreadLocalMap这个自定义哈希表干什么，那么如何区分一个线程当中不同方法或不同类set进去的资源？并正确set和get？？
    </div>
    

            </td>
  </tr>
  <tr>
    <td class="postauthor"><a href="http://www.iteye.com/topic/103804#">返回顶楼</a></td>
    <td class="postcontent">
      <div class="icons">
        <a href="http://since1978.iteye.com/" class="icon_www" title="浏览作者的博客">&nbsp;</a>
        <a href="http://since1978.iteye.com/blog/profile" class="icon_profile" title="浏览作者资料">&nbsp;</a>
        <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=SINCE1978" class="icon_pm" title="发送站内短信">&nbsp;</a>
        <a href="http://since1978.iteye.com/blog/guest_book" class="icon_guestbook" title="给作者留言">&nbsp;</a>
        <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=SINCE1978" class="icon_rss" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk=&#39;); f.appendChild(s);f.submit();return false;" title="关注作者">&nbsp;</a>
                  <a href="http://www.iteye.com/topic/103804#413719" title="SINCE1978回帖:正确理解ThreadLocal">回帖地址</a>
              </div>
                        <div id="post_rate_box_413719" class="post_rate_box"><a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="good" title="好">0</a> <a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="hidden" title="差">2</a> 请登录后投票</div>              </td>
</tr>
<tr class="sep2"><td colspan="2"></td></tr>
<tr id="504793">
  <td class="postauthor">
    <ul>
      <li class="name">jieyuan_cg</li>
      <li>等级: 初级会员</li>
      <li><a href="http://jieyuan-cg.iteye.com/" target="_blank"><img alt="jieyuan_cg的博客" class="logo" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/f86fc490-a5f1-3a88-8392-f52137eef934.png" title="jieyuan_cg的博客: jieyuan_cg" width=""></a></li>
      <li>性别: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_minigender_1.gif" title="男"></li>      <li>文章: 111</li>
      <li>积分: 50</li>
      <li>来自: 北京</li>
      <li><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/offline.gif"></li>
    </ul>
  </td>
  <td class="postcontent">
    <div class="postactions">
      <div class="description">
        &nbsp;&nbsp;
        发表时间：2008-04-02&nbsp;&nbsp;
        
      </div>
      <div class="links">
        
        
          
          
          
        
      </div>
    </div>
    <div class="postbody clearfix">
      
      
      <div class="quote_title">SINCE1978 写道</div><div class="quote_div">我想知道如果多次new ThreadLocal并且调用其set方法的话、是否就和普通hashmap一样后set进去的会覆盖先set进去的？这样的话ThreadLocal只能植入一个资源喽？这肯定不对，否则还用ThreadLocalMap这个自定义哈希表干什么，那么如何区分一个线程当中不同方法或不同类set进去的资源？并正确set和get？？</div>
<br>
<br>每个ThreadLocal当然只能放一个对象。要是需要放其他的对象，就再new 一个新的ThreadLocal出来，这个新的ThreadLocal作为key,需要放的对象作为value，放在ThreadLocalMap中。。。。
    </div>
    

            </td>
  </tr>
  <tr>
    <td class="postauthor"><a href="http://www.iteye.com/topic/103804#">返回顶楼</a></td>
    <td class="postcontent">
      <div class="icons">
        <a href="http://jieyuan-cg.iteye.com/" class="icon_www" title="浏览作者的博客">&nbsp;</a>
        <a href="http://jieyuan-cg.iteye.com/blog/profile" class="icon_profile" title="浏览作者资料">&nbsp;</a>
        <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=jieyuan_cg" class="icon_pm" title="发送站内短信">&nbsp;</a>
        <a href="http://jieyuan-cg.iteye.com/blog/guest_book" class="icon_guestbook" title="给作者留言">&nbsp;</a>
        <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=jieyuan_cg" class="icon_rss" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk=&#39;); f.appendChild(s);f.submit();return false;" title="关注作者">&nbsp;</a>
                  <a href="http://www.iteye.com/topic/103804#504793" title="jieyuan_cg回帖:正确理解ThreadLocal">回帖地址</a>
              </div>
                        <div id="post_rate_box_504793" class="post_rate_box"><a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="good" title="好">0</a> <a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="hidden" title="差">0</a> 请登录后投票</div>              </td>
</tr>
<tr class="sep2"><td colspan="2"></td></tr>
<tr id="504798">
  <td class="postauthor">
    <ul>
      <li class="name">jieyuan_cg</li>
      <li>等级: 初级会员</li>
      <li><a href="http://jieyuan-cg.iteye.com/" target="_blank"><img alt="jieyuan_cg的博客" class="logo" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/f86fc490-a5f1-3a88-8392-f52137eef934.png" title="jieyuan_cg的博客: jieyuan_cg" width=""></a></li>
      <li>性别: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_minigender_1.gif" title="男"></li>      <li>文章: 111</li>
      <li>积分: 50</li>
      <li>来自: 北京</li>
      <li><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/offline.gif"></li>
    </ul>
  </td>
  <td class="postcontent">
    <div class="postactions">
      <div class="description">
        &nbsp;&nbsp;
        发表时间：2008-04-02&nbsp;&nbsp;
        
      </div>
      <div class="links">
        
        
          
          
          
        
      </div>
    </div>
    <div class="postbody clearfix">
      
      
      LZ的这篇对ThreadLocal的解释真到位。。。多谢！
<br>坛子里面有几篇对ThreadLocal的解释好像都有些误解。。。看得晕晕乎乎。
<br>
    </div>
    

            </td>
  </tr>
  <tr>
    <td class="postauthor"><a href="http://www.iteye.com/topic/103804#">返回顶楼</a></td>
    <td class="postcontent">
      <div class="icons">
        <a href="http://jieyuan-cg.iteye.com/" class="icon_www" title="浏览作者的博客">&nbsp;</a>
        <a href="http://jieyuan-cg.iteye.com/blog/profile" class="icon_profile" title="浏览作者资料">&nbsp;</a>
        <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=jieyuan_cg" class="icon_pm" title="发送站内短信">&nbsp;</a>
        <a href="http://jieyuan-cg.iteye.com/blog/guest_book" class="icon_guestbook" title="给作者留言">&nbsp;</a>
        <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=jieyuan_cg" class="icon_rss" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk=&#39;); f.appendChild(s);f.submit();return false;" title="关注作者">&nbsp;</a>
                  <a href="http://www.iteye.com/topic/103804#504798" title="jieyuan_cg回帖:正确理解ThreadLocal">回帖地址</a>
              </div>
                        <div id="post_rate_box_504798" class="post_rate_box"><a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="good" title="好">0</a> <a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="hidden" title="差">0</a> 请登录后投票</div>              </td>
</tr>
<tr class="sep2"><td colspan="2"></td></tr>
<tr id="553495">
  <td class="postauthor">
    <ul>
      <li class="name">elice</li>
      <li>等级: 初级会员</li>
      <li><a href="http://elice.iteye.com/" target="_blank"><img alt="elice的博客" class="logo" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/0308ba52-49a8-37c7-8e8c-041ab14d0077.jpg" title="elice的博客: ORACLE" width=""></a></li>
      <li>性别: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_minigender_1.gif" title="男"></li>      <li>文章: 21</li>
      <li>积分: 0</li>
      <li>来自: 武汉</li>
      <li><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/offline.gif"></li>
    </ul>
  </td>
  <td class="postcontent">
    <div class="postactions">
      <div class="description">
        &nbsp;&nbsp;
        发表时间：2008-05-22&nbsp;&nbsp;
        
      </div>
      <div class="links">
        
        
          
          
          
        
      </div>
    </div>
    <div class="postbody clearfix">
      
      
      主要是提供了保持对象的方法和避免参数传递的方便的对象访问方式
    </div>
    

            </td>
  </tr>
  <tr>
    <td class="postauthor"><a href="http://www.iteye.com/topic/103804#">返回顶楼</a></td>
    <td class="postcontent">
      <div class="icons">
        <a href="http://elice.iteye.com/" class="icon_www" title="浏览作者的博客">&nbsp;</a>
        <a href="http://elice.iteye.com/blog/profile" class="icon_profile" title="浏览作者资料">&nbsp;</a>
        <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=elice" class="icon_pm" title="发送站内短信">&nbsp;</a>
        <a href="http://elice.iteye.com/blog/guest_book" class="icon_guestbook" title="给作者留言">&nbsp;</a>
        <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=elice" class="icon_rss" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk=&#39;); f.appendChild(s);f.submit();return false;" title="关注作者">&nbsp;</a>
                  <a href="http://www.iteye.com/topic/103804#553495" title="elice回帖:正确理解ThreadLocal">回帖地址</a>
              </div>
                        <div id="post_rate_box_553495" class="post_rate_box"><a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="good" title="好">0</a> <a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="hidden" title="差">0</a> 请登录后投票</div>              </td>
</tr>
<tr class="sep2"><td colspan="2"></td></tr>
<tr id="553517">
  <td class="postauthor">
    <ul>
      <li class="name">csrcom</li>
      <li>等级: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/star5.gif" alt="五星会员" title="五星会员"></li>
      <li><a href="http://csrcom.iteye.com/" target="_blank"><img alt="csrcom的博客" class="logo" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/user-logo.gif" title="csrcom的博客: csrcom" width=""></a></li>
      <li>性别: <img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_minigender_1.gif" title="男"></li>      <li>文章: 75</li>
      <li>积分: 610</li>
      <li>来自: 杭州</li>
      <li><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/offline.gif"></li>
    </ul>
  </td>
  <td class="postcontent">
    <div class="postactions">
      <div class="description">
        &nbsp;&nbsp;
        发表时间：2008-05-22&nbsp;&nbsp;
        
      </div>
      <div class="links">
        
        
          
          
          
        
      </div>
    </div>
    <div class="postbody clearfix">
      
      
      其实可以在thread local存放更丰富的对象比如Map，那么就不用实例化那么thread local了
<br>
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=package%20com.meidusa.amoeba.util%3B%0A%0Aimport%20java.util.HashMap%3B%0Aimport%20java.util.Map%3B%0A%0Aimport%20org.apache.log4j.Logger%3B%0A%2F**%0A%20*%20ThreadLocal%20Context%0A%20*%20%40author%20%3Ca%20href%3Dmailto%3Apiratebase%40sina.com%3EStruct%20chen%3C%2Fa%3E%0A%20*%20%40version%20%24Id%3A%20ThreadLocalContext.java%203597%202006-11-23%2008%3A11%3A58Z%20struct%20%24%0A%20*%2F%0Apublic%20class%20ThreadLocalMap%7B%0A%09private%20static%20Logger%20logger%20%3D%20Logger.getLogger(ThreadLocalMap.class)%3B%0A%09%0A%09protected%20final%20static%20ThreadLocal%3CMap%3CString%2CObject%3E%3E%20threadContext%20%3D%20new%20MapThreadLocal()%3B%0A%09%0A%09private%20ThreadLocalMap()%7B%7D%3B%0A%09%0A%09public%20static%20void%20put(String%20key%2CObject%20value)%7B%0A%09%09getContextMap().put(key%2Cvalue)%3B%0A%09%7D%0A%09%0A%09public%20static%20Object%20remove(String%20key)%7B%0A%09%09return%20getContextMap().remove(key)%3B%0A%09%7D%0A%09%0A%09public%20static%20Object%20get(String%20key)%7B%0A%09%09return%20getContextMap().get(key)%3B%0A%09%7D%0A%09%0A%09private%20static%20class%20MapThreadLocal%20extends%20ThreadLocal%3CMap%3CString%2CObject%3E%3E%20%7B%0A%20%20%20%20%20%20%20%20protected%20Map%3CString%2CObject%3E%20initialValue()%20%7B%0A%20%20%20%20%20%20%20%20%09return%20new%20HashMap%3CString%2CObject%3E()%20%7B%0A%09%09%09%09%0A%20%20%20%20%20%20%20%20%09%09private%20static%20final%20long%20serialVersionUID%20%3D%203637958959138295593L%3B%0A%09%09%09%09%0A%09%09%09%09public%20Object%20put(String%20key%2C%20Object%20value)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(logger.isDebugEnabled())%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(containsKey(key))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09logger.debug(%22Overwritten%20attribute%20to%20thread%20context%3A%20%22%20%2B%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20%22%20%3D%20%22%20%2B%20value)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09logger.debug(%22Added%20attribute%20to%20thread%20context%3A%20%22%20%2B%20key%20%2B%20%22%20%3D%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20value)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20super.put(key%2C%20value)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%09%0A%09%2F**%0A%20%20%20%20%20*%20%E5%8F%96%E5%BE%97thread%20context%20Map%E7%9A%84%E5%AE%9E%E4%BE%8B%E3%80%82%0A%20%20%20%20%20*%0A%20%20%20%20%20*%20%40return%20thread%20context%20Map%E7%9A%84%E5%AE%9E%E4%BE%8B%0A%20%20%20%20%20*%2F%0A%20%20%20%20protected%20static%20Map%3CString%2CObject%3E%20getContextMap()%20%7B%0A%20%20%20%20%20%20%20%20return%20(Map%3CString%2CObject%3E)%20threadContext.get()%3B%0A%20%20%20%20%7D%0A%09%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%E6%B8%85%E7%90%86%E7%BA%BF%E7%A8%8B%E6%89%80%E6%9C%89%E8%A2%ABhold%E4%BD%8F%E7%9A%84%E5%AF%B9%E8%B1%A1%E3%80%82%E4%BB%A5%E4%BE%BF%E9%87%8D%E7%94%A8%EF%BC%81%0A%20%20%20%20%20*%2F%0A%20%20%20%20%0A%20%20%20%20public%20static%20void%20reset()%7B%0A%20%20%20%20%09getContextMap().clear()%3B%0A%20%20%20%20%7D%0A%7D%0A%0A%0A" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="keyword">package</span><span>&nbsp;com.meidusa.amoeba.util;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;java.util.HashMap;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;java.util.Map;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;org.apache.log4j.Logger;&nbsp;&nbsp;</span></span></li><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;ThreadLocal&nbsp;Context</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@author&nbsp;&lt;a&nbsp;href=mailto:piratebase@sina.com&gt;Struct&nbsp;chen&lt;/a&gt;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@version&nbsp;$Id:&nbsp;ThreadLocalContext.java&nbsp;3597&nbsp;2006-11-23&nbsp;08:11:58Z&nbsp;struct&nbsp;$</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;ThreadLocalMap{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;Logger&nbsp;logger&nbsp;=&nbsp;Logger.getLogger(ThreadLocalMap.</span><span class="keyword">class</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">protected</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;ThreadLocal&lt;Map&lt;String,Object&gt;&gt;&nbsp;threadContext&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;MapThreadLocal();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;ThreadLocalMap(){};&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;put(String&nbsp;key,Object&nbsp;value){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getContextMap().put(key,value);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;Object&nbsp;remove(String&nbsp;key){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;getContextMap().remove(key);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;Object&nbsp;get(String&nbsp;key){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;getContextMap().get(key);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;MapThreadLocal&nbsp;</span><span class="keyword">extends</span><span>&nbsp;ThreadLocal&lt;Map&lt;String,Object&gt;&gt;&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">protected</span><span>&nbsp;Map&lt;String,Object&gt;&nbsp;initialValue()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;</span><span class="keyword">new</span><span>&nbsp;HashMap&lt;String,Object&gt;()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">long</span><span>&nbsp;serialVersionUID&nbsp;=&nbsp;3637958959138295593L;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;Object&nbsp;put(String&nbsp;key,&nbsp;Object&nbsp;value)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(logger.isDebugEnabled())&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(containsKey(key))&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.debug(<span class="string">"Overwritten&nbsp;attribute&nbsp;to&nbsp;thread&nbsp;context:&nbsp;"</span><span>&nbsp;+&nbsp;key&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span class="string">"&nbsp;=&nbsp;"</span><span>&nbsp;+&nbsp;value);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.debug(<span class="string">"Added&nbsp;attribute&nbsp;to&nbsp;thread&nbsp;context:&nbsp;"</span><span>&nbsp;+&nbsp;key&nbsp;+&nbsp;</span><span class="string">"&nbsp;=&nbsp;"</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;value);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;</span><span class="keyword">super</span><span>.put(key,&nbsp;value);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;取得thread&nbsp;context&nbsp;Map的实例。</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;thread&nbsp;context&nbsp;Map的实例</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">protected</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;Map&lt;String,Object&gt;&nbsp;getContextMap()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;(Map&lt;String,Object&gt;)&nbsp;threadContext.get();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;清理线程所有被hold住的对象。以便重用！</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;reset(){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getContextMap().clear();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre class="java" name="code" codeable_type="Post" codeable_id="553517" source_url="http://www.iteye.com/topic/103804#553517" pre_index="0" title="正确理解ThreadLocal" style="display: none;">package com.meidusa.amoeba.util;

import java.util.HashMap;
import java.util.Map;

import org.apache.log4j.Logger;
/**
 * ThreadLocal Context
 * @author &lt;a href=mailto:piratebase@sina.com&gt;Struct chen&lt;/a&gt;
 * @version $Id: ThreadLocalContext.java 3597 2006-11-23 08:11:58Z struct $
 */
public class ThreadLocalMap{
	private static Logger logger = Logger.getLogger(ThreadLocalMap.class);
	
	protected final static ThreadLocal&lt;Map&lt;String,Object&gt;&gt; threadContext = new MapThreadLocal();
	
	private ThreadLocalMap(){};
	
	public static void put(String key,Object value){
		getContextMap().put(key,value);
	}
	
	public static Object remove(String key){
		return getContextMap().remove(key);
	}
	
	public static Object get(String key){
		return getContextMap().get(key);
	}
	
	private static class MapThreadLocal extends ThreadLocal&lt;Map&lt;String,Object&gt;&gt; {
        protected Map&lt;String,Object&gt; initialValue() {
        	return new HashMap&lt;String,Object&gt;() {
				
        		private static final long serialVersionUID = 3637958959138295593L;
				
				public Object put(String key, Object value) {
                    if (logger.isDebugEnabled()) {
                        if (containsKey(key)) {
                        	logger.debug("Overwritten attribute to thread context: " + key
                                + " = " + value);
                        } else {
                        	logger.debug("Added attribute to thread context: " + key + " = "
                                + value);
                        }
                    }

                    return super.put(key, value);
                }
            };
        }
    }
	
	/**
     * 取得thread context Map的实例。
     *
     * @return thread context Map的实例
     */
    protected static Map&lt;String,Object&gt; getContextMap() {
        return (Map&lt;String,Object&gt;) threadContext.get();
    }
	
    
    /**
     * 清理线程所有被hold住的对象。以便重用！
     */
    
    public static void reset(){
    	getContextMap().clear();
    }
}


</pre>
    </div>
    

            </td>
  </tr>
  <tr>
    <td class="postauthor"><a href="http://www.iteye.com/topic/103804#">返回顶楼</a></td>
    <td class="postcontent">
      <div class="icons">
        <a href="http://csrcom.iteye.com/" class="icon_www" title="浏览作者的博客">&nbsp;</a>
        <a href="http://csrcom.iteye.com/blog/profile" class="icon_profile" title="浏览作者资料">&nbsp;</a>
        <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=csrcom" class="icon_pm" title="发送站内短信">&nbsp;</a>
        <a href="http://csrcom.iteye.com/blog/guest_book" class="icon_guestbook" title="给作者留言">&nbsp;</a>
        <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=csrcom" class="icon_rss" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk=&#39;); f.appendChild(s);f.submit();return false;" title="关注作者">&nbsp;</a>
                  <a href="http://www.iteye.com/topic/103804#553517" title="csrcom回帖:正确理解ThreadLocal">回帖地址</a>
              </div>
                        <div id="post_rate_box_553517" class="post_rate_box"><a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="good" title="好">1</a> <a href="http://www.iteye.com/topic/103804#" onclick="return false;" class="hidden" title="差">0</a> 请登录后投票</div>              </td>
</tr>
<tr class="sep2"><td colspan="2"></td></tr>

  </tbody>
</table>


<div class="actions">
  <div class="buttons"></div>
  <div class="wrapper"><div class="pagination"><span class="disabled prev_page">« 上一页</span> <span class="current">1</span> <a href="http://www.iteye.com/topic/103804?page=2" rel="next">2</a> <a href="http://www.iteye.com/topic/103804?page=2" class="next_page" rel="next">下一页 »</a></div></div>
</div>

<div>
  <div class="crumbs">
    <a href="http://www.iteye.com/forums">论坛首页</a> <span class="arrow">→</span>
    <a href="http://www.iteye.com/forums/board/Java">Java企业应用版</a>
    <br><br>跳转论坛:<select id="forum_urlname" name="forum[urlname]" onchange="window.location=&#39;/forums/board/&#39;+this.value"><option value="mobile">移动开发技术</option>
<option value="web">Web前端技术</option>
<option value="Java" selected="selected">Java企业应用</option>
<option value="language">编程语言技术</option>
<option value="Tech">综合技术</option>
<option value="New">入门技术</option>
<option value="Job">招聘求职</option>
<option value="Life">海阔天空</option></select>
    
  </div>

  
</div>

<div style="display:none">
  <form action="http://www.iteye.com/posts/rate" id="post_rate_form" method="post" onsubmit="new Ajax.Request(&#39;/posts/rate&#39;, {asynchronous:true, evalScripts:true, parameters:Form.serialize(this)}); return false;"><div style="margin:0;padding:0;display:inline"><input name="authenticity_token" type="hidden" value="YZ1wY0mQ+bS+dk6270xL1C78B5UL38lPHcVjLOaBFdk="></div>
    <input type="hidden" id="post_rate_id" name="id">
    <input type="hidden" id="post_rate_type" name="type">
  </form></div>

<script type="text/javascript">
  function processComment() {
    fix_image_size($$('div.postbody img'), 760);
    
    $$('#forum_main > #posts > tr[id]').each(function(tr){
      var post_id = tr.id;
      $$("#"+post_id+" pre[name=code]").each(function(pre, index){
        var location = window.location;
        source_url = location.protocol + "//" + location.host + location.pathname + location.search;
        source_url += "#" + post_id;
        pre.writeAttribute('codeable_type', 'Post');
        pre.writeAttribute('codeable_id', post_id);
        pre.writeAttribute('source_url', source_url);
        pre.writeAttribute('pre_index', index);
        pre.writeAttribute('title', '正确理解ThreadLocal');
      });
    });
  }

  dp.SyntaxHighlighter.HighlightAll('code', true, true);
  processComment();
  code_favorites_init();

  function rate_post(id, type) {
    Element.update('post_rate_box_' + id, '提交中...');
    new Ajax.Request('/posts/rate', {asynchronous:true, evalScripts:true, parameters:{"id":id, "type":type}});
  }

  function rate_topic(type) {
    Element.update('topic_rate_box', '提交中...');
    new Ajax.Request('/topics/rate', {asynchronous:true, evalScripts:true, parameters:{"id":103804, "type":type}});
  }
</script>



        </div>
        <div id="nav">
  <div class="wrapper">
    <ul>
            <li><a href="http://www.iteye.com/">首页</a></li>
      <li><a href="http://www.iteye.com/news">资讯</a></li>
      <li><a href="http://www.iteye.com/magazines">精华</a></li>
      <li><a href="http://www.iteye.com/forums" class="selected">论坛</a></li>
      <li><a href="http://www.iteye.com/ask">问答</a></li>
      <li><a href="http://www.iteye.com/blogs">博客</a></li>
      <li><a href="http://www.iteye.com/blogs/subjects">专栏</a></li>
      <li><a href="http://www.iteye.com/groups">群组</a></li>
      <!-- <li><a target="_blank" href="http://job.iteye.com/iteye">招聘</a></li>-->
      <li><a target="_blank" href="http://job.csdn.net/">招聘</a></li>
      <li class="last"><a href="http://www.iteye.com/search">搜索</a></li>
    </ul>
  </div>
</div>
      </div>
      <div id="footer">
  <div id="site_nav">
    <ul>
      <li><a href="http://www.iteye.com/index/service">广告服务</a></li>
      <li><a href="http://webmaster.iteye.com/">ITeye黑板报</a></li>
      <li><a href="http://www.iteye.com/index/contactus">联系我们</a></li>
      <li class="last"><a href="http://www.iteye.com/index/friend_links">友情链接</a></li>
    </ul>
  </div>
  <div id="copyright">
    © 2003-2016 ITeye.com.    [ <a href="http://www.miibeian.gov.cn/">京ICP证070598号</a>  京公网安备11010502027441 ]<br>
    北京创新乐知信息技术有限公司 版权所有<br>
  </div>
</div>

    </div>
    <script type="text/javascript">
  document.write("<img src='http://stat.iteye.com/?url="+ encodeURIComponent(document.location.href) + "&referrer=" + encodeURIComponent(document.referrer) + "&user_id=' width='0' height='0' />");
</script><img src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/saved_resource" width="0" height="0">

<script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/tracking.js" type="text/javascript"></script>

  



<script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/hm(1).js"></script><script src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/alliance.js"></script><iframe src="./正确理解ThreadLocal - 设计模式 - Java - ITeye论坛_files/container.htm" style="visibility: hidden; display: none;"></iframe><iframe id="google_osd_static_frame_9840377611108" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;"></iframe></body></html>